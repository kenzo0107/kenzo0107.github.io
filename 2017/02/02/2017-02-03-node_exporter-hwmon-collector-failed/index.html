<div class="card"><div class="card-image"><span class="image is-7by3"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170203/20170203141542.png" alt="node_expoter error occured ! hwmon collector failed"></span></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-02-02T15:00:00.000Z" title="2017-02-02T15:00:00.000Z">2017-02-03</time><span class="level-item">4分 read (About 584 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">node_expoter error occured ! hwmon collector failed</h1><div class="content"><h2><span id="概要">概要</span></h2><p>Amazon Linux に node_exporter をインストールし起動した所以下のエラーが発生し、起動停止してしまいました。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERRO[0007] ERROR: hwmon collector failed after 0.000011s: open /proc/class/hwmon: no such file or directory  <span class="built_in">source</span>=<span class="string">"node_exporter.go:92"</span></span><br></pre></td></tr></table></figure>

<h3><span id="hwmon-とは">hwmon とは？</span></h3><blockquote>
<p>Hard Ware MONitoring. Linux カーネルのセンサーチップから Hard Ware の温度やファン回転数や電圧を取得できる。</p>
</blockquote>
<p>環境情報は以下の通りです。</p>
<ul>
<li>Amazon Linux AMI release 2016.09</li>
<li>node_exporter version 0.14.0-rc.1 (branch: master, revision:5a07f4173d97fa0dd307db5bd3c2e6da26a4b16e)</li>
</ul>
<p>上記エラーですが issue として上がっていました。<br>そして解決されてました！</p>
<a href="https://github.com/prometheus/node_exporter/pull/427" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://avatars3.githubusercontent.com/u/3380462?s=400&v=4"></div><div class="descriptions"><div class="og-title">Allow graceful failure in hwmon collector by mdlayher · Pull Request #427 · prometheus/node_exporter</div><div class="og-description">$ ./node_exporter -web.listen-address 192.168.1.1:9100 -collectors.enabled hwmon -log.level debug
INFO[0000] Starting node_exporter (version…</div></div></div></a>

<p>タイミングが悪かったのかマージされる前の release を取得していた為<br>このエラーに遭遇していました。</p>
<p>最新のソースは master ブランチしてビルドするのが良さそうです。</p>
<p>以下に Amazon Linux で実施したインストール手順をまとめました。</p>
<h2><span id="手順">手順</span></h2><h3><span id="golang-インストール">Golang インストール</span></h3><p>以下Golangオフィシャルサイトにある標準的なインストール方法です。参考にしてください。</p>
<a href="http://kenzo0107.hatenablog.com/entry/2017/02/03/124808" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170203/20170203124749.png"></div><div class="descriptions"><div class="og-title">標準的な Golang インストール方法 - 長生村本郷Engineers&#39;Blog</div><div class="og-description">概要 Golang オフィシャルサイトに書かれているそのままです。 Getting Started - The Go Programming Language 他 Golang 関連記事説明の為に、また、備忘録として記述します。 環境 CentOS Linux release 7…</div></div></div></a>

<h3><span id="node_exporter-をソースからインストールしビルド">node_exporter をソースからインストールしビルド</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p $GOPATH&#x2F;src&#x2F;github.com&#x2F;prometheus</span><br><span class="line">$ cd $GOPATH&#x2F;src&#x2F;github.com&#x2F;prometheus</span><br><span class="line">$ git clone https:&#x2F;&#x2F;github.com&#x2F;prometheus&#x2F;node_exporter</span><br><span class="line">$ cd node_exporter</span><br><span class="line">$ make build</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; version 確認</span><br><span class="line">$ .&#x2F;node_exporter --version</span><br><span class="line">node_exporter, version 0.14.0-rc.1 (branch: master, revision: 428bc92b1c9b38f6de96bceb67bc5d9b3bdcf6e7)</span><br></pre></td></tr></table></figure>

<h3><span id="ついでに起動スクリプト">ついでに起動スクリプト</span></h3><ul>
<li>事前準備</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; pid ファイル置き場 作成</span><br><span class="line">$ sudo mkdir -p &#x2F;var&#x2F;run&#x2F;prometheus</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; log ファイル置き場 作成</span><br><span class="line">$ sudo mkdir -p &#x2F;var&#x2F;log&#x2F;prometheus</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; daemonize インストール</span><br><span class="line">$ cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class="line">$ sudo git clone https:&#x2F;&#x2F;github.com&#x2F;bmc&#x2F;daemonize</span><br><span class="line">$ cd daemonize</span><br><span class="line">$ sudo .&#x2F;configure</span><br><span class="line">$ sudo make</span><br><span class="line">$ sudo make install</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; PATHが通ってなかったらPATHに乗せる</span><br><span class="line">$ sudo cp daemonize &#x2F;bin&#x2F;</span><br><span class="line"></span><br><span class="line">$ which daemonize</span><br><span class="line">&#x2F;bin&#x2F;daemonize</span><br></pre></td></tr></table></figure>

<ul>
<li>起動スクリプト作成</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cd &#x2F;etc&#x2F;init.d</span><br><span class="line">$ sudo git clone https:&#x2F;&#x2F;gist.github.com&#x2F;kenzo0107&#x2F;eebb6c1c06ba04b7073c171580cec445</span><br><span class="line">$ sudo cp eebb6c1c06ba04b7073c171580cec445&#x2F;node_exporter.init .&#x2F;node_exporter</span><br><span class="line">$ sudo chmod 0755 node_exporter</span><br></pre></td></tr></table></figure>

<ul>
<li>起動</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo &#x2F;etc&#x2F;init.d&#x2F;node_exporter start</span><br></pre></td></tr></table></figure>

<p>無事エラーなく起動するようになりました♪</p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Monitoring/">Monitoring</a><a class="link-muted mr-2" rel="tag" href="/tags/Prometheus/">Prometheus</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Gefällt Ihnen der Artikel? Unterstützen Sie den Autor mit</h3><div class="buttons is-centered"><a class="button is-danger donate" href="https://www.patreon.com/kenzo0107" target="_blank" rel="noopener"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2017/02/02/2017-02-03-standard-instalation-golang/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">標準的な Golang インストール方法</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2017/02/01/2017-02-02-prometheus-alertmanager/"><span class="level-item">Alertmanager 構築手順</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!-->