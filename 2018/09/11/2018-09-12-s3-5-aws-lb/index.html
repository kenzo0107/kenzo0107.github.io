<div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-09-11T15:00:00.000Z" title="2018-09-11T15:00:00.000Z">2018-09-12</time><span class="level-item">2分 read (About 314 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">S3 に5分毎に出力される AWS LB ログファイルを時間帯を指定してまとめてダウンロード</h1><div class="content"><h2><span id="概要">概要</span></h2><p>AWS で LB のログを S3 に保存設定をしている場合に、
インシデントがあった時間帯のログがまとめて欲しいという時に
awscli でまとめてログ取得しています。</p>

<p>その時の手順を備忘録としてまとめました。</p>

<a id="more"></a>

<h2><span id="事前準備">事前準備</span></h2><ul>
<li>awscli インストール</li>
</ul>


<p>本件の実行環境は以下になります。</p>

<pre class="code" data-lang data-unlink>macOS%$ sw_vers
ProductName:    Mac OS X
ProductVersion: 10.12.6
BuildVersion:   16G1036

macOS%$ aws --version
aws-cli/1.15.50 Python/3.7.0 Darwin/16.7.0 botocore/1.10.49</pre>


<h2><span id="ログファイルダウンロード">ログファイルダウンロード</span></h2><p>例) 2018年9月12日 14時台の ALB ログファイルをダウンロード</p>

<pre class="code" data-lang data-unlink>// 2018年9月12日 14時台のログファイルをダウンロード
macOS%$ aws s3 --profile &lt;profile&gt; cp s3://&lt;log bucket name&gt;/&lt;lb name&gt;/AWSLogs/123456789012/elasticloadbalancing/ap-northeast-1/2018/09/12/ . --recursive --exclude &#34;*&#34; --include &#34;*20180912T05*&#34;

// ログファイル解凍
gunzip *.gz

// log を1ファイルにまとめ
cat *.log &gt; all.log

// HTTP コードが 50x のものを 50x.log にまとめる
awk '{if($9 ~ 50) print $0}' all.log &gt; 50x.log</pre>


<p>`--profile &lt;profile&gt;` は `aws configure --profile &lt;profile&gt;` で設定した場合の設定です。<br>
default を利用する場合は `--profile &lt;profile&gt;` の指定は不要です。</p>

<p>以上です。</p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/AWS/">AWS</a><a class="link-muted mr-2" rel="tag" href="/tags/S3/">S3</a><a class="link-muted mr-2" rel="tag" href="/tags/ALB/">ALB</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Gefällt Ihnen der Artikel? Unterstützen Sie den Autor mit</h3><div class="buttons is-centered"><a class="button is-danger donate" href="https://www.patreon.com/kenzo0107" target="_blank" rel="noopener"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2018/09/13/2018-09-14-aws-ec2-t2-t3-step-by-step/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">AWS EC2 t2 から t3 へ移行する為の step by step</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2018/09/07/2018-09-08-cpu/"><span class="level-item">プロセスの起動経過時間・CPU使用時間</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!-->