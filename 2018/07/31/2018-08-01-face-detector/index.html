<div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-07-31T15:00:00.000Z" title="2018-07-31T15:00:00.000Z">2018-08-01</time><span class="level-item">3分 read (About 474 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">顔検出 3分クッキング on MacOSX</h1><div class="content"><h2><span id="概要">概要</span></h2><p>ラズパイ使って家族と判断したら<br>「こんにちはご主人様」<br>家族以外なら<br>「通報しまーす」<br>と話してくれるおもちゃを<br>作ろうと思ってます。</p>
<p>その前段の前段として<br>静止画で顔検出してみます。</p>
<p>ちなみに顔検出と顔認識は意味が全く異なります。</p>
<ul>
<li>顔検出 … 顔部分を検出すること。</li>
<li>顔認識 … 特定の人物の顔と判断すること。</li>
</ul>
<p>環境構築は前回記事を参照してください。</p>
<a href="https://kenzo0107.hatenablog.com/entry/2016/07/28/143429" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160728/20160728142804.jpg"></div><div class="descriptions"><div class="og-title">MacOSX に Python2, Python3 仮想環境構築 - 長生村本郷Engineers&#39;Blog</div><div class="og-description">経緯 MacOSX デフォルトでは python 2系。 python 2.7 は 2020年までのサポート なので python 3 系 に慣れておこうということで 3 系環境を構築しようと思いました。 ですが dlib など Python 2系でないとうまく設定ができなかった…</div></div></div></a>





<h2><span id="環境">環境</span></h2><ul>
<li>MacOSX 10.11.5</li>
<li>Python 3</li>
</ul>
<h2><span id="cv2-インストール">CV2 インストール</span></h2><ul>
<li>homebrew で cv2 インストール</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew tap homebrew/science</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> brew install opencv3 --with-python3</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Python 3 を利用する</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ source ~&#x2F;py3env&#x2F;bin&#x2F;active</span><br><span class="line">(py3env)$</span><br></pre></td></tr></table></figure>

<ul>
<li>cv2.so を pip の site-package へコピー</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(py3env)$ cd ~&#x2F;py3env&#x2F;lib&#x2F;python3.4&#x2F;site-packages</span><br><span class="line">(py3env)$ cp &#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;opencv3&#x2F;3.1.0_3&#x2F;lib&#x2F;python3.4&#x2F;site-packages&#x2F;cv2.so .</span><br></pre></td></tr></table></figure>

<ul>
<li>cv2 import 確認</li>
</ul>
<p>Version が表示されれば成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(py3env)$ python -c &#39;import cv2; print(cv2.__version__)&#39;</span><br><span class="line">3.1.0</span><br></pre></td></tr></table></figure>

<h2><span id="スクリプトインストール">スクリプトインストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(py3env)$ cd ~&#x2F;py3env</span><br><span class="line">(py3env)$ git clone https:&#x2F;&#x2F;gist.github.com&#x2F;kenzo0107&#x2F;5d174797a5a222295b5a39f6fa435777</span><br><span class="line">(py3env)$ cp .&#x2F;5d174797a5a222295b5a39f6fa435777&#x2F;trimming.py .</span><br></pre></td></tr></table></figure>

<h2><span id="スクリプト実行">スクリプト実行</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(py3env)$ python trimming.py &lt;img_path&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Before</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160801/20160801143015.png" width="100%">
</div>
</li>
<li><p>After</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160801/20160801143033.png" width="100%">
</div>


</li>
</ul>
<p>革パンも顔認識されてしまう…</p>
<p>が、一応まずできました。</p>
<h2><span id="今回のスクリプト要点">今回のスクリプト要点</span></h2><ul>
<li>正確な検知数を向上させるべく、スクリプト上の以下 detectMultiScale メソッドのパラメータを調整します。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">facerect &#x3D; cascade.detectMultiScale(image_gray, scaleFactor&#x3D;1.02, minNeighbors&#x3D;3, minSize&#x3D;(7,7))</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><em>Item</em></th>
<th><em>Value</em></th>
</tr>
</thead>
<tbody><tr>
<td>scaleFactor</td>
<td>画像解析する際に随時縮小し解析するその尺度</td>
</tr>
<tr>
<td>minNeighbors</td>
<td>最小<a href="http://opencv.jp/opencv-2.2/py/objdetect_cascade_classification.html" target="_blank">近傍矩形</a>数</td>
</tr>
<tr>
<td>minSize</td>
<td>顔部分を認識するためのサイズ (縦,横)</td>
</tr>
</tbody></table>
<p>まず最初の第一歩ができました♪</p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/MachineLearning/">MachineLearning</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Gefällt Ihnen der Artikel? Unterstützen Sie den Autor mit</h3><div class="buttons is-centered"><a class="button is-danger donate" href="https://www.patreon.com/kenzo0107" target="_blank" rel="noopener"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2018/08/13/2018-08-14-flask-service-worker-on-heroku-pwa/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Flask+Service Worker on Heroku で PWA チュートリアル</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2018/07/29/2018-07-30-datadog_ntp_alert/"><span class="level-item">Datadog NTP 監視でアラート鳴りまくり対応</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!-->