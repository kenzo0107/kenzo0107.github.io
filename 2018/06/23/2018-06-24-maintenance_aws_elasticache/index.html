<div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-06-23T15:00:00.000Z" title="2018-06-23T15:00:00.000Z">2018-06-24</time><span class="level-item">4分 read (About 604 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">ElastiCache メンテナンス対応 ~2018年梅雨~</h1><div class="content"><p>2018年6月頃 AWS ElastiCache のメンテナンス通知が大量発生した時の備忘録です。</p>
<div class="twitter-wrapper"><blockquote class="twitter-tweet"><a href="https://twitter.com/fujiwara/status/1008956888086503425"></a></blockquote></div><script async defer src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<a id="more"></a>

<h2><span id="メンテ時に参照したリンク">メンテ時に参照したリンク</span></h2><p><a href="https://docs.aws.amazon.com/ja_jp/AmazonElastiCache/latest/red-ug/CacheNodes.html#ReplaceStandalone">Redis 用 Amazon ElastiCache</a></p>
<p>基本、ノードのリプレイスが必要です。</p>
<p>以下、手動実行する時の手順です。</p>
<h3><span id="node-1-の場合">node = 1 の場合</span></h3><p>スタンドアローンな ElastiCache の場合、</p>
<ol>
<li>バックアップをとる</li>
<li>リードレプリカを追加</li>
<li>レプリカを昇格しプライマリにする</li>
<li>レプリカとなった元ノードを削除</li>
</ol>
<p>これでノードのリプレイスが完了しました。</p>
<h3><span id="node-n-gt2">node = N (&gt;=2)</span></h3><p>複数ノードある場合、</p>
<ol>
<li>バックアップをとる</li>
<li>フェールオーバー実施</li>
</ol>
<p>AWS Support 曰く、</p>
<blockquote>
<p>フェールオーバー API は障害をシミュレートするので、フェイルオーバー後にノードの置き換えも行われます。</p>
</blockquote>
<p>とのこと</p>
<h2><span id="メンテナンス完了の確認方法">メンテナンス完了の確認方法</span></h2><p><b>正確にステータス確認するにはサポートに確認する</b>以外はないかなと思います。</p>
<p>イベントには操作ログが残りメンテが実施されたというログは一切残りません。</p>
<p>また、アラートもすぐさま消えません。正確にはわかりませんが、数時間程度経過したら消えていました。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20180624/20180624213819.png" width="100%">
</div>

<h2><span id="手動実行せず放っておいた場合">手動実行せず放っておいた場合</span></h2><p>メンテナンスはメンテナンスウィンドウで指定した時間帯に実施されました。</p>
<p>ちなみに、放っておいた時のイベントログは以下のようになっていました。</p>
<p>n = 1</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20180624/20180624220417.png" width="100%">
</div>

<p>n = 2</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20180624/20180624220358.png" width="100%">
</div>

<p>n= 2 でフェールオーバーが自動実行されているのがわかります。</p>
<p>メンテナンス自体の経過時間はデータ量にもよるので一概には言えませんので<br>本番前に一度リハーサルして概算とっておくのが良いかなと思います。</p>
<p>以上<br>ご参考になれば幸いです。</p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/AWS/">AWS</a><a class="link-muted mr-2" rel="tag" href="/tags/ElastiCache/">ElastiCache</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Gefällt Ihnen der Artikel? Unterstützen Sie den Autor mit</h3><div class="buttons is-centered"><a class="button is-danger donate" href="https://www.patreon.com/kenzo0107" target="_blank" rel="noopener"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2018/07/10/2018-07-11-cleanup_docker_no_required_resource/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Docker 不要リソースお掃除 compose</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2018/06/05/2018-06-06-rails-redis-threadsafe/"><span class="level-item">Rails × Redis でスレッドセーフなアクセス数ランキング実装</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!-->