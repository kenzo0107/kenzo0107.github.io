<div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">タグ</a></li><li class="is-active"><a href="#" aria-current="page">Security</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-02-22T15:00:00.000Z" title="2016-02-22T15:00:00.000Z">2016-02-23</time><span class="level-item">3分 read (About 449 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/02/22/2016-02-22-clam-antivirus/">Clam AntiVirus 導入</a></h1><div class="content"><h2><span id="clam-antivirus">Clam Antivirus</span></h2><p>略称ClamAV はUnix系OSで動作するウィルススキャンOSSです。</p>
<p><a href="http://www.clamav.net">http://www.clamav.net</a></p>
<p><a href="https://ja.wikipedia.org/wiki/Clam_AntiVirus">wiki - Clam_AntiVirus</a></p>
<p>個人的にさくらVPSを借りて<br>ミドルウェア入れて動作確認していたら<br>気づくとDos攻撃を受けて「サーバ停止します」と連絡が来て<br>焦ったことがあり、導入した経緯があります。</p>
<h2><span id="導入手順">導入手順</span></h2><p>以下2つの方法どちらでも良いです。<br>yum 経由の方が起動スクリプト付きで<br>パスに配置してくれるので導入が安易です。</p>
<ul>
<li>yum 経由</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install clamav clamav-update</span><br></pre></td></tr></table></figure>

<ul>
<li>ソースからbuild</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class="line"># wget http:&#x2F;&#x2F;www.clamav.net&#x2F;downloads&#x2F;production&#x2F;clamav-0.99.tar.gz</span><br><span class="line"># tar zxf clamav-0.99.tar.gz</span><br><span class="line"># cd clamav-0.99</span><br><span class="line"># .&#x2F;configure --enable-milter</span><br><span class="line"># make</span><br><span class="line"># make install</span><br></pre></td></tr></table></figure>

<h2><span id="設定ファイル更新">設定ファイル更新</span></h2><p>/etc/clamd.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 定義ファイル更新 User clalmのコメントアウトを外す</span><br><span class="line"># sed -i &#39;s&#x2F;^User\s\+clam$&#x2F;#\0&#x2F;&#39; &#x2F;etc&#x2F;clamd.conf</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 設定更新</span><br><span class="line"># freshclam</span><br></pre></td></tr></table></figure>

<h2><span id="起動設定">起動設定</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 起動</span><br><span class="line"># service clamd start</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 自動起動設定</span><br><span class="line"># chkconfig clamd on</span><br></pre></td></tr></table></figure>

<h2><span id="実行確認">実行確認</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># clamscan --infected --remove --recursive</span><br><span class="line"></span><br><span class="line">----------- SCAN SUMMARY -----------</span><br><span class="line">Known viruses: 4269611</span><br><span class="line">Engine version: 0.99</span><br><span class="line">Scanned directories: 2</span><br><span class="line">Scanned files: 8</span><br><span class="line">Infected files: 0</span><br><span class="line">Data scanned: 0.20 MB</span><br><span class="line">Data read: 0.10 MB (ratio 1.92:1)</span><br><span class="line">Time: 10.934 sec (0 m 10 s)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><em>Option</em></th>
<th><em>Explain</em></th>
</tr>
</thead>
<tbody><tr>
<td>–infected</td>
<td>ウィルス感染されたファイルのみ表示</td>
</tr>
<tr>
<td>–remove</td>
<td>ウィルス感染されたファイルを削除</td>
</tr>
<tr>
<td>–recursive</td>
<td>サブディレクトリを再帰的に検査</td>
</tr>
</tbody></table>
<p>各option は <code>clamscan -h</code> で確認できます。</p>
<h2><span id="但し">但し</span></h2><p>あくまでウィルススキャンツールを導入しただけであって<br>日進月歩の技術で侵入されないとは限らない為<br>セキュリティは常に動向に注意しましょう。</p>
</div></article></div>