<div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">タグ</a></li><li class="is-active"><a href="#" aria-current="page">Python</a></li></ul></nav></div></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2018/12/05/2018-12-06-boto3-assumerole-credentials-mfa/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20181206/20181206121637.png" alt="boto3 の AssumeRole をしたアカウントスイッチ credentials 利用時の MFA 突破対応"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-12-05T15:00:00.000Z" title="2018-12-05T15:00:00.000Z">2018-12-06</time><span class="level-item">1分 read (About 196 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/12/05/2018-12-06-boto3-assumerole-credentials-mfa/">boto3 の AssumeRole をしたアカウントスイッチ credentials 利用時の MFA 突破対応</a></h1><div class="content"><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>備忘録です。</p>
<p>AssumeRole でのアカウントスイッチで credentials 情報を持っている場合に対応した boto3.Session での認証の仕方です。</p>
<p>MFA 設定してる場合も付けときました。</p></div><a class="article-more button is-small size-small" href="/2018/12/05/2018-12-06-boto3-assumerole-credentials-mfa/#more">Read More</a></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2018/08/13/2018-08-14-flask-service-worker-on-heroku-pwa/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20180814/20180814131355.png" alt="Flask+Service Worker on Heroku で PWA チュートリアル"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-08-13T15:00:00.000Z" title="2018-08-13T15:00:00.000Z">2018-08-14</time><span class="level-item">9分 read (About 1416 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/08/13/2018-08-14-flask-service-worker-on-heroku-pwa/">Flask+Service Worker on Heroku で PWA チュートリアル</a></h1><div class="content"><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>自分にとっては <a href="https://dev.to/">dev.to</a> でバズった Service Worker。<br>その概要と機能性をなぞってみようとチュートリアル的に学んだ内容をまとめました。</p>
<p>掲題の通り、Flask + Service Worker を Heroku で動作させ、PWA(Progressive Web Apps) してみました。</p></div><a class="article-more button is-small size-small" href="/2018/08/13/2018-08-14-flask-service-worker-on-heroku-pwa/#more">Read More</a></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2017/10/28/2017-10-29-toda-tocochan-bus-flask-on-ibm-bluemix/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20171029/20171029095513.png" alt="toda-tocochan-bus flask on IBM Bluemix へ引っ越し"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-10-28T15:00:00.000Z" title="2017-10-28T15:00:00.000Z">2017-10-29</time><span class="level-item">3分 read (About 497 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/10/28/2017-10-29-toda-tocochan-bus-flask-on-ibm-bluemix/">toda-tocochan-bus flask on IBM Bluemix へ引っ越し</a></h1><div class="content"><p>GCP から IBM Bluemix へ引っ越しました！</p>
<p><a href="https://toda-tocochan-bus.mybluemix.net/">toco ちゃんバス あと何分？</a></p>
<h2><span id="概要">概要</span></h2><p>さくらVPS から GCP、<br>そして今度は GCP から IBM Bluemix に引越ししました。</p>
<p>以前 GCP 運用時の話はコチラ</p>
<a href="https://kenzo0107.github.io/2017/08/03/2017-08-03-tutorial-of-gke" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://kenzo0107.github.io/images/og_image.png"></div><div class="descriptions"><div class="og-title">GKEチュートリアルでサイト構築・運用</div><div class="og-description">概要以前さくらVPS上で tocoちゃんバスアプリを作成しました。 Flask Python3 で 戸田市 tocoちゃんバスあと何分？ Webアプリ作成♪ - 長生村本郷Engineers&#39;BlogFlask(フラスク) とは Flask Official Site を参照する…</div></div></div></a>


<p>GCP は GKE に LB かましたら価格がバコッと上がってしまい<br>無料枠を逸脱してしまいました (&gt;_&lt;)</p>
<p>なんとか低価格で運用したいという目論見です。</p>
<h2><span id="何故-heroku-でなく-ibm-bluemix">何故 Heroku でなく IBM Bluemix ？</span></h2><p>IBM Bluemix の良い所は機能が充実している所です。<br>無料・デフォルトで kibana が見れます。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20171029/20171029101148.png" width="100%">
</div>

<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20171029/20171029101853.png" width="100%">
</div>

<p>その他 Git との連携も可です。</p>
<p>以下 Mac で作業することを前提に手順まとめました。</p>
<h2><span id="事前準備">事前準備</span></h2><ul>
<li>IBM Bluemix に Sign Up しときます</li>
</ul>
<p><a href="https://console.bluemix.net/registration/">Signup IBM Bluemix</a></p>
<ul>
<li>clone</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ git <span class="built_in">clone</span> https://github.com/kenzo0107/toda-tocochan-bus-on-ibmbluemix</span><br><span class="line">macOS%$ <span class="built_in">cd</span> toda-tocochan-bus-on-ibmbluemix</span><br></pre></td></tr></table></figure>

<ul>
<li>cloudfoundry の CLI インストール</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ brew tap cloudfoundry/tap</span><br><span class="line">macOS%$ brew install cf-cli</span><br></pre></td></tr></table></figure>

<h2><span id="デプロイ">デプロイ</span></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ cf api https://api.ng.bluemix.net</span><br><span class="line">macOS%$ cf login</span><br><span class="line">macOS%$ cf push &lt;application name&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>API は Region によって変わります。</li>
</ul>
<table>
<thead>
<tr>
<th>Region</th>
<th>API URL</th>
</tr>
</thead>
<tbody><tr>
<td>米国南部</td>
<td><a href="https://api.ng.bluemix.net">https://api.ng.bluemix.net</a></td>
</tr>
<tr>
<td>英国</td>
<td><a href="https://api.eu-gb.bluemix.net">https://api.eu-gb.bluemix.net</a></td>
</tr>
</tbody></table>
<h2><span id="総評">総評</span></h2><p>Cloudfoundry の CLI のお陰で引っ越しも簡単でした♪</p>
<p>セキュリティとして特定 IP やドメインからアクセスさせないとか出来たら<br>商用のメソッドとして利用出来そうかなと思いました。</p>
<p>その点質問してみましたが2週間ほど連絡がないので再度連絡してみます。<br>↑質問は英語限定でした！</p>
<p>サポートが強化されると有難いなと思いました。</p>
<p>以上<br>ご参考になれば幸いです。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2017/07/06/2017-07-07-flask/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170707/20170707233203.png" alt="Flask Python3 で 戸田市 tocoちゃんバスあと何分？ Webアプリ作成♪"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-07-06T15:00:00.000Z" title="2017-07-06T15:00:00.000Z">2017-07-07</time><span class="level-item">7分 read (About 1043 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/07/06/2017-07-07-flask/">Flask Python3 で 戸田市 tocoちゃんバスあと何分？ Webアプリ作成♪</a></h1><div class="content"><h2><span id="flaskフラスク-とは">Flask(フラスク) とは</span></h2><p><a href="http://flask.pocoo.org/">Flask Official Site</a> を参照すると冒頭に以下の文章があります。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Flask is a microframework for Python based on Werkzeug, Jinja 2 and good intentions</span><br></pre></td></tr></table></figure>

<p>Flask は Python の小規模なフレームワークで、 Werkzug や Jinja 2 をベースとしています。</p>
<ul>
<li>Made by Armin Ronacher (Australian)</li>
<li>Bottle（ボトル）に対する言葉遊びで命名。（Flask: フラスコ）</li>
<li>2010年のエイプリルフールのジョークが始まり</li>
<li><a href="http://www.sejuku.net/blog/3713">2017年大注目のPython！WEBフレームワーク3つを徹底比較</a> を見ると次第に人気が高まっている（給与も良さそう？）</li>
</ul>
<h2><span id="何がいいの">何がいいの？</span></h2><p>最小限の構成で簡単な Web アプリケーションが作成できることです。<br>django, Rails でも簡単に出来なくもないですが、さらに手順は短く容易です。</p>
<h3><span id="チュートリアル">チュートリアル</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello World!"</span></span><br></pre></td></tr></table></figure>

<h2><span id="flaskを利用する判断基準">Flaskを利用する判断基準</span></h2><ul>
<li>大規模なプロジェクトでない。（ファイル構成は自分 or チームで決定する必要がある為）</li>
<li>DB を使わない。使うにしても複雑なDB設計でない。</li>
<li>利用するライブラリが Python 製でそのgatewayとして利用したい。</li>
</ul>
<h2><span id="手始めに">手始めに！</span></h2><p>初心者向け記事は多数あるので割愛し<br>学習がてら Web アプリケーション作ったのでそちらをどうぞ♪</p>
<p>実際動くものとそのソースを見た方がイメージ湧くと思います。</p>
<p><a href="http://toda-tocochan-bus.tk">tocoちゃんバス あと何分？</a></p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170707/20170707232036.png" width="100%">
</div>

<p>戸田市のローカルバス toco ちゃんバスの停留所を指定しあと何分で来るかをカウントダウンするアプリです。<br>自分が使うので作ったら割と広まってきて嬉しい限り♪</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">※ちなみに戸田市役所に確認し非公式ではありますが公開許可をいただいております。</span><br><span class="line">※戸田市役所ご担当者様より「可能であれば最新の迂回情報なども載せていただけたら〜」という要望も頂きました♪</span><br></pre></td></tr></table></figure>

<h2><span id="ソースはこちら">ソースはこちら♪</span></h2><a href="https://github.com/kenzo0107/toda-tocochan-bus" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://avatars0.githubusercontent.com/u/6197906?s=400&v=4"></div><div class="descriptions"><div class="og-title">kenzo0107/toda-tocochan-bus</div><div class="og-description">Contribute to kenzo0107/toda-tocochan-bus development by creating an account on GitHub.</div></div></div></a>

<p>ソースを参照頂けるとやってみたことがわかりやすいと思います。</p>
<h3><span id="やってみたこと">やってみたこと</span></h3><ul>
<li>docker で flask ローカル開発環境作成</li>
<li>config ファイルからデータ呼び出し (config.py)</li>
<li>session 機能</li>
<li>Bootstrap 適用</li>
<li>superagent.js で非同期通信</li>
<li>flickity.js でフリッカブルに</li>
</ul>
<h3><span id="本番動作環境">本番動作環境</span></h3><ul>
<li>さくらVPS CentOS 6</li>
<li>httpd2.4 + wsgi + virtualenv + python3</li>
</ul>
<p>さくらVPSには CakePHP や SpringBoot のプロジェクトが乗っかっていたりとやりたい放題の環境として所持しています。</p>
<h3><span id="開発期間">開発期間</span></h3><p>ほぼほぼ 1週間。仕事の昼休みと日曜大工で 10時間足らずで公開出来ました。<br>どちらかというと js 側の学習コストが掛かった感じ。</p>
<h2><span id="総評">総評</span></h2><p>今回作成したユーザ情報を管理しない、<br>DBを持たないアプリにはうってつけでした。<br>構成が複雑になりすぎず丁度良かったです。</p>
<p>やはり大きな規模のプロジェクトには django が適しています。</p>
<p>個人的に戸田市役所に電話してWebアプリ公開の許可を頂く、<br>という承認申請が出来、地域貢献できる喜びが非常に大きかったです。</p>
<p>今後、バージョンアップしたいと思います。</p>
<p>Flask 利用に際して参考になれば何よりです。</p>
<p>以上です。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-11-29T15:00:00.000Z" title="2016-11-29T15:00:00.000Z">2016-11-30</time><span class="level-item">2分 read (About 324 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/11/29/2016-11-28-detect-diff-between-local-and-remote-in-python/">Python ローカルとリモートサーバ上のファイル差分抽出ツール</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>これまで数社経験してきましたが<br>必ずといっていいほど存在する、<br>現状のステータスがわからないサーバ。。</p>
<p>Git 上の master とも差分が激しく生じている状態。。</p>
<p>そんなサーバとローカルの workspace との差分を確認すべく<br>ツールを作成しました。</p>
<a href="https://github.com/kenzo0107/DiffTool" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://avatars0.githubusercontent.com/u/6197906?s=400&v=4"></div><div class="descriptions"><div class="og-title">kenzo0107/DiffTool</div><div class="og-description">ローカルとリモートサーバ上のファイル差分確認をします。. Contribute to kenzo0107/DiffTool development by creating an account on GitHub.</div></div></div></a>


<h2><span id="今後">今後</span></h2><p>今の所、<br>リモートからファイルをダウンロードする度に SSH のコネクションを張ってしまいパフォーマンス悪い(&gt;_&lt;)</p>
<p>はじめ pysftp で ssh コネクション張ってた方がパフォーマンスよかった気がする。<br>でも、手軽さを考えたら hostname 指定の方が良かったので<br>hostname 指定の方向でパフォーマンスを上げていくことを考えます。</p>
<p>ところが<br>pysftp で実装してみましたが 多段 ssh アクセスの場合がうまくいかず。。<br>随時解消させていきます。</p>
<p>golang で並行処理を試してパフォーマンスを上げるのも検討します。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/07/27/2016-07-28-setup-python2-python3-on-macos/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160728/20160728142804.jpg" alt="MacOSX に Python2, Python3 仮想環境構築"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-07-27T15:00:00.000Z" title="2016-07-27T15:00:00.000Z">2016-07-28</time><span class="level-item">2分 read (About 364 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/07/27/2016-07-28-setup-python2-python3-on-macos/">MacOSX に Python2, Python3 仮想環境構築</a></h1><div class="content"><h2><span id="経緯">経緯</span></h2><p>MacOSX デフォルトでは python 2系。</p>
<p>python 2.7 は 2020年までのサポート なので<br>python 3 系 に慣れておこうということで<br>3 系環境を構築しようと思いました。</p>
<p>ですが<br><a href="http://dlib.net/">dlib</a> など Python 2系でないとうまく設定ができなかった経緯があり<br>(※自分の不手際の可能性もありますが)<br>両方残そうということで両仮想環境を構築します。</p>
<h2><span id="環境">環境</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sw_vers</span><br><span class="line"></span><br><span class="line">ProductName:    Mac OS X</span><br><span class="line">ProductVersion: 10.11.5</span><br><span class="line">BuildVersion:   15F34</span><br></pre></td></tr></table></figure>

<h2><span id="homebrew-インストール">Homebrew インストール</span></h2><p>以下オフィシャルサイト参照してください。</p>
<p><a href="http://brew.sh/index_ja.html">Homebrew Ja</a></p>
<h2><span id="python2-3-インストール">Python2, 3 インストール</span></h2><p>2016/07/28 現在、 python = 2.7.10, python3 = 3.4.3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install python python3 pyenv</span><br></pre></td></tr></table></figure>

<h2><span id="設定ファイル">設定ファイル</span></h2><p>.bashrc もしくは .zshrc に追記します。</p>
<p>以下仮に .bashrc とします。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vi ~/.bashrc</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export PYENV_ROOT="$HOME/.pyenv"</span><br><span class="line">export PATH="$PYENV_ROOT/bin:$PATH"</span><br><span class="line">eval "$(pyenv init -)"</span><br></pre></td></tr></table></figure>

<ul>
<li>設定読み込み</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ source ~&#x2F;.bashrc</span><br></pre></td></tr></table></figure>

<h2><span id="virtualenv-インストール">virtualenv インストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo easy_install virtualenv</span><br></pre></td></tr></table></figure>

<h2><span id="仮想環境構築">仮想環境構築</span></h2><ul>
<li>python2 での仮想環境構築</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ which python</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;python2.7</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ virtualenv -p &#x2F;usr&#x2F;local&#x2F;bin&#x2F;python2.7 ~&#x2F;py2env</span><br></pre></td></tr></table></figure>

<ul>
<li>python3 での仮想環境構築</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ which python3</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;python3</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ virtualenv -p &#x2F;usr&#x2F;local&#x2F;bin&#x2F;python3 ~&#x2F;py3env</span><br></pre></td></tr></table></figure>



<h2><span id="仮想環境切り替え">仮想環境切り替え</span></h2><ul>
<li>Python 2.7 仮想環境へ切り替え</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ source ~&#x2F;py2env&#x2F;bin&#x2F;active</span><br></pre></td></tr></table></figure>

<ul>
<li>Python 3.4 仮想環境へ切り替え</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ source ~&#x2F;py3env&#x2F;bin&#x2F;active</span><br></pre></td></tr></table></figure>

<p>今更ですが備忘録的まとめでした。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/07/10/2016-07-11-install-pip-on-centos5/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711114558.jpg" alt="CentOS5 系 に pip インストール"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-07-10T15:00:00.000Z" title="2016-07-10T15:00:00.000Z">2016-07-11</time><span class="level-item">2分 read (About 280 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/07/10/2016-07-11-install-pip-on-centos5/">CentOS5 系 に pip インストール</a></h1><div class="content"><p>2017年3月にサポート終了する CentOS5 ですが<br>今なお利用されているサーバは多々あるかと思います。</p>
<h2><span id="今回の目的">今回の目的</span></h2><p>デフォルトインストールされている Python 2.4.3 を残した状態で<br>Python 2.6 をインストールし、pip の上位バージョンを利用できるようにする、<br>ことを目的とします。</p>
<h2><span id="epel-リポジトリ追加">EPEL リポジトリ追加</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rpm -Uvh http:&#x2F;&#x2F;ftp.iij.ad.jp&#x2F;pub&#x2F;linux&#x2F;fedora&#x2F;epel&#x2F;5&#x2F;x86_64&#x2F;epel-release-5-4.noarch.rpm</span><br></pre></td></tr></table></figure>

<h2><span id="通常アップデートで-epel-からアップグレードするのを避ける様設定">通常アップデートで EPEL からアップグレードするのを避ける様設定</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi &#x2F;etc&#x2F;yum.repos.d&#x2F;epel.repo</span><br><span class="line"></span><br><span class="line">[epel]</span><br><span class="line">...</span><br><span class="line">enabled&#x3D;0</span><br></pre></td></tr></table></figure>

<h2><span id="epel-リポジトリから-python26-インストール">EPEL リポジトリから python26 インストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install python26 -y --enablerepo&#x3D;epel</span><br></pre></td></tr></table></figure>

<h2><span id="バージョン確認">バージョン確認</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python26 -V</span></span><br><span class="line">Python 2.6.8</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> python -V</span></span><br><span class="line">Python 2.4.3</span><br></pre></td></tr></table></figure>

<p>あくまで python26 は pip を利用するようにする為に共存させています。</p>
<h2><span id="pip-インストール">pip インストール</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wget --no-check-certificate https://bootstrap.pypa.io/ez_setup.py</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo python26 ez_setup.py --insecure</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo easy_install-2.6 pip</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pip --version</span><br><span class="line">pip 8.1.2 from &#x2F;usr&#x2F;lib&#x2F;python2.6&#x2F;site-packages&#x2F;pip-8.1.2-py2.6.egg (python 2.6)</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-02-18T15:00:00.000Z" title="2016-02-18T15:00:00.000Z">2016-02-19</time><span class="level-item">3分 read (About 401 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/02/18/2016-02-19-install-python343-on-macos/">MacOSX python 3.4.3 インストール</a></h1><div class="content"><h2><span id="概要">概要</span></h2><a href="https://www.amazon.co.jp/exec/obidos/ASIN/4774176311/kenzo0107-22/" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img></div><div class="descriptions"><div class="og-title">データサイエンティスト養成読本 機械学習入門編 (Software Design plus) | 比戸 将平, 馬場 雪乃, 里 洋平, 戸嶋 龍哉, 得居 誠也, 福島 真太朗, 加藤 公一, 関 喜史, 阿部 厳, 熊崎 宏樹 |本 | 通販 | Amazon</div><div class="og-description">Amazonで比戸 将平, 馬場 雪乃, 里 洋平, 戸嶋 龍哉, 得居 誠也, 福島 真太朗, 加藤 公一, 関 喜史, 阿部 厳, 熊崎 宏樹のデータサイエンティスト養成読本 機械学習入門編 (Software Design plus)。アマゾンならポイント還元本が多数。比戸…</div></div></div></a>

<p>機械学習養成読本という素晴らしい本を頂き早速学習を深めています。</p>
<p>115ページ 第2部 第1章<br>「Pythonのインストール」がすんなりいかなかったのでメモです。</p>
<p><code>pyenv install 3.4.3</code> を実行すると以下のようなエラー出ませんでしたか？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Downloading Python-3.4.3.tgz...</span><br><span class="line">-&gt; https:&#x2F;&#x2F;www.python.org&#x2F;ftp&#x2F;python&#x2F;3.4.3&#x2F;Python-3.4.3.tgz</span><br><span class="line">Installing Python-3.4.3...</span><br><span class="line">ERROR: The Python ssl extension was not compiled. Missing the OpenSSL lib?</span><br><span class="line"></span><br><span class="line">Please consult to the Wiki page to fix the problem.</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;yyuu&#x2F;pyenv&#x2F;wiki&#x2F;Common-build-problems</span><br><span class="line"></span><br><span class="line">BUILD FAILED (OS X 10.11.2 using python-build 20150519)</span><br></pre></td></tr></table></figure>

<h2><span id="環境">環境</span></h2><ul>
<li>MacOSX ElCapitan 10.11.2（15C50）</li>
<li>Homebrew 0.9.5</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ brew install sqlite3</span><br><span class="line">$ brew install readline</span><br><span class="line">$ brew install openssl</span><br><span class="line">$ brew install pyenv</span><br><span class="line">$ export CFLAGS&#x3D;&quot;-I$(brew --prefix openssl)&#x2F;include&quot;</span><br><span class="line">$ export LDFLAGS&#x3D;&quot;-L$(brew --prefix openssl)&#x2F;lib -L$(brew --prefix sqlite3)&#x2F;lib&quot;</span><br><span class="line">$ export CPPFLAGS&#x3D;&quot;-I$(brew --prefix sqlite3)&#x2F;include&quot;</span><br><span class="line">$ pyenv install 3.4.3</span><br></pre></td></tr></table></figure>

<p>以下コンパイラに渡す変数の設定が肝でした。</p>
<ul>
<li>CFLAGS</li>
<li>LDFLAGS</li>
<li>CPPFLAGS</li>
</ul>
<p><a href="https://www.gnu.org/software/make/manual/html_node/Implicit-Variables.html">10.3 Variables Used by Implicit Rules</a></p>
<p>気をつければいけないのはMacにデフォルトでインストールされているPython<br>Python のPATH(/usr/local/bin)から外す</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ which python</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;python</span><br><span class="line"></span><br><span class="line">$ mv &#x2F;usr&#x2F;local&#x2F;bin&#x2F;python &#x2F;usr&#x2F;local&#x2F;bin&#x2F;python2.7.10</span><br></pre></td></tr></table></figure>

<p>pip もインストール済みであるならば同様にパスから外す。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ which pip</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;pip</span><br><span class="line"></span><br><span class="line">$ mv &#x2F;usr&#x2F;local&#x2F;bin&#x2F;pip &#x2F;usr&#x2F;local&#x2F;bin&#x2F;pip2.7</span><br></pre></td></tr></table></figure>

<p>他にPythonのPATHをexportしていなければ<br>pyenv でインストールしたPythonにパスが通るはずです。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ which python</span><br><span class="line">&#x2F;Users&#x2F;kenzo&#x2F;.pyenv&#x2F;shims&#x2F;python ←このように表示されればOK♪</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-02-15T15:00:00.000Z" title="2016-02-15T15:00:00.000Z">2016-02-16</time><span class="level-item">2分 read (About 288 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/02/15/2016-02-16-python-error-unicodeencodeerror-ascii-codec-cant-encode-characters/">Pythonエラー対応: UnicodeEncodeError: &#039;ascii&#039; codec can&#039;t encode characters</a></h1><div class="content"><h2><span id="結論">結論</span></h2><p>Pythonの文字コードを utf-8 に設定する。</p>
<h2><span id="概要">概要</span></h2><p>python で以下のような画像URLから画像をダウンロードする処理を実装した所<br>掲題のエラーが発生しました。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> HTMLParser <span class="keyword">import</span> HTMLParser</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span><span class="params">(url)</span>:</span></span><br><span class="line">    img = urllib.urlopen(url)</span><br><span class="line">    localfile = open(os.path.basename(url),<span class="string">'wb'</span>)</span><br><span class="line">    localfile.write(img.read())</span><br><span class="line">    img.close()</span><br><span class="line">    localfile.close()</span><br></pre></td></tr></table></figure>

<ul>
<li>具体的にはここでこけてました。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localfile.write(img.read())</span><br></pre></td></tr></table></figure>


<h2><span id="環境">環境</span></h2><ul>
<li>CentOS Linux release 7.0.1406 (Core)</li>
<li>Python 2.7.5</li>
</ul>
<hr>
<h2><span id="文字コード確認">文字コード確認</span></h2><p>以下対話式で確認してみると ascii と表示されました。<br>これを utf-8 に変更します。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python</span><br><span class="line">&gt;&gt;&gt; import sys</span><br><span class="line">&gt;&gt;&gt; sys.getdefaultencoding()</span><br><span class="line"><span class="string">'ascii'</span></span><br></pre></td></tr></table></figure>

<h2><span id="pip-パス確認">pip パス確認</span></h2><p>バージョン確認時にパスが出力されます。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pip --version</span><br><span class="line">pip 7.1.0 from /usr/lib/python2.7/site-packages (python 2.7)</span><br></pre></td></tr></table></figure>

<h2><span id="site-packages配下に-sitecustomizepy-を作成">site-packages配下に sitecustomize.py を作成</span></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/lib/python2.7/site-packages/sitecustomize.py</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.setdefaultencoding(<span class="string">'utf-8'</span>)</span><br></pre></td></tr></table></figure>

<p>上記内容で保存。</p>
<h2><span id="再度文字コード確認">再度文字コード確認</span></h2><p>utf-8 になりました。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ python</span><br><span class="line">&gt;&gt;&gt; import sys</span><br><span class="line">&gt;&gt;&gt; sys.getdefaultencoding()</span><br><span class="line"><span class="string">'utf-8'</span></span><br></pre></td></tr></table></figure>

<p>これで掲題のエラーが解決されました。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-11-09T15:00:00.000Z" title="2015-11-09T15:00:00.000Z">2015-11-10</time><span class="level-item">1分 read (About 123 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/11/09/2015-11-10-redis-python/">Use Redis via Python</a></h1><div class="content"><h2><span id="memorandum">Memorandum</span></h2><p>The below codes is how to use redis via Python.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding: UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">r = redis.StrictRedis(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># set/get string.</span></span><br><span class="line">r.set(<span class="string">'test1'</span>, <span class="string">'aiueo'</span>)</span><br><span class="line">r.expire(<span class="string">'test1'</span>, <span class="number">1000</span>)</span><br><span class="line"><span class="keyword">print</span> r.get(<span class="string">'test1'</span>)     <span class="comment"># aiueo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set/get integer.</span></span><br><span class="line">r.set(<span class="string">'test2'</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">print</span> r.get(<span class="string">'test2'</span>)    <span class="comment"># 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check key exit.</span></span><br><span class="line"><span class="keyword">print</span> r.exists(<span class="string">'test1'</span>) <span class="comment"># True</span></span><br><span class="line"><span class="keyword">print</span> r.exists(<span class="string">'test0'</span>) <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pattern match</span></span><br><span class="line">keys = r.keys(<span class="string">'test*'</span>)</span><br><span class="line"><span class="keyword">if</span> len(keys) &gt; <span class="number">0</span> :</span><br><span class="line">	<span class="keyword">for</span> key <span class="keyword">in</span> keys:</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'--------------------------------------------'</span></span><br><span class="line">		<span class="keyword">print</span> key			<span class="comment"># test1, test2</span></span><br><span class="line">		<span class="keyword">print</span> r.get(key) 	<span class="comment"># aiueo, 2</span></span><br><span class="line">		<span class="keyword">print</span> r.type(key)	<span class="comment"># Type : string, string</span></span><br><span class="line">		<span class="keyword">print</span> r.ttl(key)    <span class="comment"># Expire : if not set, set "-1"</span></span><br><span class="line"></span><br><span class="line">r.append(<span class="string">'test1'</span>, <span class="string">'_kkkkkkk'</span>)</span><br><span class="line"><span class="keyword">print</span> r.get(<span class="string">'test1'</span>)   <span class="comment"># aiueo_kkkkkkk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># delete cache.</span></span><br><span class="line">r.delete(<span class="string">'test1'</span>)</span><br><span class="line"><span class="keyword">print</span> r.exists(<span class="string">'test1'</span>) <span class="comment"># False</span></span><br></pre></td></tr></table></figure>

<p>Thanks.</p>
</div></article></div>