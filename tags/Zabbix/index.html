<div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">タグ</a></li><li class="is-active"><a href="#" aria-current="page">Zabbix</a></li></ul></nav></div></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/10/10/2016-10-11-line-notify/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20161011/20161011142249.png" alt="LINE Notify で Zabbix Alert 通知"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-10-10T15:00:00.000Z" title="2016-10-10T15:00:00.000Z">2016-10-11</time><span class="level-item">3分 read (About 388 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/10/10/2016-10-11-line-notify/">LINE Notify で Zabbix Alert 通知</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>Zabbix アラート を LINE Notify を利用して<br>LINEにメッセージを送るように設定しました。</p>
<h2><span id="手順">手順</span></h2><h3><span id="line-notify-アクセス">LINE Notify アクセス</span></h3><p>[<a href="https://notify-bot.line.me/ja/]">https://notify-bot.line.me/ja/]</a></p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20161011/20161011140750.png" width="100%">
</div>


<h3><span id="登録してログイン">登録してログイン</span></h3><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20161011/20161011140920.png" width="100%">
</div>

<h3><span id="サービス登録">サービス登録</span></h3><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20161011/20161011141015.png" width="100%">
</div>

<p>この情報が審査されるということは特になかったですが<br>ある程度精度の高い情報を入力して登録しときました</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20161011/20161011141027.png" width="100%">
</div>


<h3><span id="トークルーム選択しトークン発行">トークルーム選択しトークン発行</span></h3><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20161011/20161011141314.png" width="100%">
</div>

<h3><span id="発行したトークンコピー">発行したトークンコピー</span></h3><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20161011/20161011141349.png" width="100%">
</div>


<h3><span id="zabbix-スクリプト設定">Zabbix スクリプト設定</span></h3><a href="https://github.com/kenzo0107/Zabbix3-LineNotify" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://avatars0.githubusercontent.com/u/6197906?s=400&v=4"></div><div class="descriptions"><div class="og-title">kenzo0107/Zabbix3-LineNotify</div><div class="og-description">Zabbix3 + LineNotify. Contribute to kenzo0107/Zabbix3-LineNotify development by creating an account on GitHub.</div></div></div></a>

<h2><span id="env">Env</span></h2><ul>
<li>Zabbix 3.0</li>
<li>CentOS Linux release 7.2.1511 (Core)</li>
</ul>
<h2><span id="install-steps">Install Steps</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Zabbix-Server]$ cd &#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;alertscripts    # AlertScriptsPath</span><br><span class="line">[Zabbix-Server]$ git clone https:&#x2F;&#x2F;github.com&#x2F;kenzo0107&#x2F;zabbix3-linenotify</span><br><span class="line">[Zabbix-Server]$ mv zabbix3-slack&#x2F;line_notify.sh .</span><br><span class="line">[Zabbix-Server]$ rm -r zabbix3-linenotify</span><br><span class="line">[Zabbix-Server]$ chmod 755 line_notify.sh</span><br></pre></td></tr></table></figure>

<h3><span id="media-types-設定">Media Types 設定</span></h3><div style="text-align:center;">
<img src="http://i.imgur.com/mE5dEXI.png" width="100%">
</div>

<h3><span id="users-gt-media-設定">Users &gt; Media 設定</span></h3><div style="text-align:center;">
<img src="http://i.imgur.com/ovDFnTq.png" width="100%">
</div>


<h3><span id="通知テスト">通知テスト</span></h3><p>テスト環境などで<br>Nginx の process が1つ以上になったらアラート出すように設定してみた結果</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/6B554NX.png" width="100%">
</div>


<h2><span id="所感">所感</span></h2><p>トークルームに参加するにも<br>LINE アカウントはプライベートアカウントなので<br>ちょっと知られたくないわ〜という時は<br>何とも言えない気持ちになる方もいることがわかりました。</p>
<p>ご利用は計画的に。</p>
<h2><span id="今後の期待">今後の期待</span></h2><p>個人的に<br>Twilio みたいに LINE Notify で電話通知出来たら嬉しいです。</p>
<p>まずは障害がない世界を♪</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20161011/20161011213827.jpg" width="100%">
</div>

<p>以上です。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/07/13/2016-07-14-zabbix-reactio/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160728/20160728142804.jpg" alt="Zabbix + Reactio 連携"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-07-13T15:00:00.000Z" title="2016-07-13T15:00:00.000Z">2016-07-14</time><span class="level-item">7分 read (About 1107 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/07/13/2016-07-14-zabbix-reactio/">Zabbix + Reactio 連携</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>Reactio の無料化によりその機能が解放され、様々な監視・アラートツールとの連携が可能になりました。<br>これを機に Zabbix + Reactio 連携したのでまとめました。</p>
<p><a href="http://blog.reactio.jp/entry/2016/07/04/090000">Reactioが無料になります</a></p>
<h2><span id="環境">環境</span></h2><ul>
<li>Zabbix 3.0</li>
<li>CentOS Linux release 7.2.1511 (Core)</li>
</ul>
<p>Zabbix 3.0 がインストールされ起動されていることを前提とします。</p>
<h2><span id="zabbix-管理画面で-host-設定">Zabbix 管理画面で Host 設定</span></h2><p><span style="color:#A9E2F3">※既に設定されている場合はスキップしてください。</span></p>
<p>Configuration &gt; Hosts &gt; create</p>
<ul>
<li>Host name: Project1</li>
</ul>
<img src="http://i.imgur.com/12vbmdE.png" width="400px">

<h2><span id="reactio-プロジェクト作成">Reactio プロジェクト作成</span></h2><p>プロジェクト毎にインシデントを管理します。</p>
<p>https://<code>&lt;Organization ID&gt;</code>.reactio.jp/settings/project</p>
<p>Zabbix 管理画面で設定している Host 名を Project 名とします。</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/f9YS11z.png" width="100%">
</div>

<h2><span id="reactio-api-発行">Reactio API 発行</span></h2><p>プロジェクト作成ページと同ページ内にある API 項目の 「+」ボタンクリックし API KEY 発行します。</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/knN5mkT.png" width="100%">
</div>

<div style="text-align:center;">
<img src="http://i.imgur.com/HvjKrvQ.png" width="100%">
</div>

<h2><span id="zabbix-reactio-インストール">zabbix-reactio インストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd &#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;alertscripts</span><br><span class="line">$ git clone http:&#x2F;&#x2F;github.com&#x2F;zabbix-reactio</span><br></pre></td></tr></table></figure>

<h2><span id="zabbix-db情報-と-reactio-で作成した-project-と-発行した-api-key-を設定ファイルに設定">Zabbix DB情報 と Reactio で作成した Project と 発行した API KEY を設定ファイルに設定</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd &#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;alertscripts&#x2F;zabbix-reactio</span><br><span class="line">$ vi config.inc</span><br></pre></td></tr></table></figure>
<ul>
<li>db_info に DB 情報設定</li>
<li><code>&lt;Organization ID&gt;</code> 設定</li>
<li>Project = API KEY 設定</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[db_info]</span><br><span class="line">host &#x3D; &lt;DB Host&gt;</span><br><span class="line">user &#x3D; &lt;DB user&gt;</span><br><span class="line">pass &#x3D; &lt;DB pass&gt;</span><br><span class="line">db   &#x3D; &lt;DB name&gt;</span><br><span class="line"></span><br><span class="line">[reactio_url]</span><br><span class="line">default &#x3D; https:&#x2F;&#x2F;&lt;Organization ID&gt;.reactio.jp&#x2F;api&#x2F;v1&#x2F;incidents</span><br><span class="line"></span><br><span class="line">[api_key]</span><br><span class="line">Project1 &#x3D; &lt;Project1&#39;s API KEY&gt;</span><br><span class="line">Project2 &#x3D; &lt;Project2&#39;s API KEY&gt;</span><br><span class="line">Project3 &#x3D; &lt;Project3&#39;s API KEY&gt;</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2><span id="db-カラム追加">DB カラム追加</span></h2><ul>
<li>Zabbix alerts テーブルに Reactio Incident ID カラムを追加します。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ cd &#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;alertscripts&#x2F;zabbix-reactio</span><br><span class="line">$ mysql -h &lt;DB Host&gt; -u &lt;DB user&gt; -p&lt;DB pass&gt; &lt;DB name&gt; -e &quot;&#96;cat add_reactioincidentid.sql&#96;&quot;</span><br><span class="line">$ mysql -h &lt;DB Host&gt; -u &lt;DB user&gt; -p&lt;DB pass&gt; &lt;DB name&gt; -e &quot;SHOW COLUMNS FROM alerts&quot;</span><br><span class="line"></span><br><span class="line">+---------------------+---------------------+------+-----+---------+-------+</span><br><span class="line">| Field               | Type                | Null | Key | Default | Extra |</span><br><span class="line">+---------------------+---------------------+------+-----+---------+-------+</span><br><span class="line">| alertid             | bigint(20) unsigned | NO   | PRI | NULL    |       |</span><br><span class="line">| actionid            | bigint(20) unsigned | NO   | MUL | NULL    |       |</span><br><span class="line">| eventid             | bigint(20) unsigned | NO   | MUL | NULL    |       |</span><br><span class="line">| userid              | bigint(20) unsigned | YES  | MUL | NULL    |       |</span><br><span class="line">| clock               | int(11)             | NO   | MUL | 0       |       |</span><br><span class="line">| mediatypeid         | bigint(20) unsigned | YES  | MUL | NULL    |       |</span><br><span class="line">| sendto              | varchar(100)        | NO   |     |         |       |</span><br><span class="line">| subject             | varchar(255)        | NO   |     |         |       |</span><br><span class="line">| message             | text                | NO   |     | NULL    |       |</span><br><span class="line">| status              | int(11)             | NO   | MUL | 0       |       |</span><br><span class="line">| retries             | int(11)             | NO   |     | 0       |       |</span><br><span class="line">| error               | varchar(128)        | NO   |     |         |       |</span><br><span class="line">| esc_step            | int(11)             | NO   |     | 0       |       |</span><br><span class="line">| alerttype           | int(11)             | NO   |     | 0       |       |</span><br><span class="line">| reactio_incident_id | int(11)             | NO   |     | 0       |       |    ← 追加されているのが確認できます</span><br><span class="line">+---------------------+---------------------+------+-----+---------+-------+</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Reacito では全てのインシデントは ID で管理されています。<br>Zabbix で障害アラート通知時に Reactio インシデント作成API をコールし インシデントID を保存します。</p>
<p>このインシデントIDは Zabbix で障害回復アラート通知時に Reatio インシデントステータス更新API をコールする際に利用します。</p>
</blockquote>
<h2><span id="zabbix-media-types-reactio-作成">Zabbix Media types: Reactio 作成</span></h2><p>Administration &gt; Media types <code>Create media type</code> ボタンクリック</p>
<img src="http://i.imgur.com/iSOhzpP.png" width="400px">

<img src="http://i.imgur.com/0OXYfbW.png" width="400px">

<p>以下値を入力し <code>Add</code> ボタンクリック</p>
<table>
<thead>
<tr>
<th><em>Item</em></th>
<th><em>Value</em></th>
</tr>
</thead>
<tbody><tr>
<td>Name</td>
<td>Reactio</td>
</tr>
<tr>
<td>Type</td>
<td>Script</td>
</tr>
<tr>
<td>Script name</td>
<td>zabbix-reactio/reactio.php</td>
</tr>
<tr>
<td>Script Parameters 1</td>
<td>{ALERT.SUBJECT}</td>
</tr>
<tr>
<td>Script Parameters 2</td>
<td>{ALERT.MESSAGE}</td>
</tr>
</tbody></table>
<h2><span id="zabbix-users-reactio-作成">Zabbix Users: Reactio 作成</span></h2><p>Administration &gt; Users <code>Create media type</code> ボタンクリック</p>
<img src="http://i.imgur.com/Bf5bqkc.png" width="400px">

<ul>
<li>Reactio ユーザ作成</li>
</ul>
<img src="http://i.imgur.com/n8aZiyV.png" width="400px">

<ul>
<li>Media タブをクリックし Media 情報入力</li>
</ul>
<img src="http://i.imgur.com/6yAyEe5.png" width="400px">

<img src="http://i.imgur.com/VOKOpZI.png" width="400px">

<ul>
<li>Permission タブをクリックし Zabbix Super Admin 選択</li>
</ul>
<img src="http://i.imgur.com/cpZkPUT.png" width="200px">

<ul>
<li>Addボタン クリックし一覧に表示されることを確認</li>
</ul>
<img src="http://i.imgur.com/5ubxAKL.png" width="800px">

<h2><span id="zabbix-actions-reactio-notification-作成">Zabbix Actions: Reactio Notification 作成</span></h2><p>Configuration &gt; Actions Create ボタンクリック</p>
<img src="http://i.imgur.com/DDQcmrG.png" width="400px">

<ul>
<li>Action タブ選択し Action 情報入力</li>
</ul>
<img src="http://i.imgur.com/6hi0LPf.png" width="400px">

<table>
<thead>
<tr>
<th><em>Item</em></th>
<th><em>Value</em></th>
</tr>
</thead>
<tbody><tr>
<td>Name</td>
<td>Reactio Notification</td>
</tr>
<tr>
<td>Default subject</td>
<td>PROBLEM alert - {TRIGGER.NAME} is {TRIGGER.STATUS}</td>
</tr>
<tr>
<td>Default message</td>
<td>HOST: {HOST.NAME}<br>TRIGGER_NAME: {TRIGGER.NAME}<br>TRIGGER_STATUS: {TRIGGER.STATUS}<br><b>TRIGGER_SEVERITY: {TRIGGER.SEVERITY}<br>DATETIME: {DATE} / {TIME}<br>ITEM_ID: {ITEM.ID1}<br>ITEM_NAME: {ITEM.NAME1}<br>ITEM_KEY: {ITEM.KEY1}<br>ITEM_VALUE: {ITEM.VALUE1}<br>EVENT_ID: {EVENT.ID}<br>TRIGGER_URL: {TRIGGER.URL}</b></td>
</tr>
<tr>
<td>Recovery message</td>
<td>チェック</td>
</tr>
<tr>
<td>Recovery subject</td>
<td>RECOVERY alert - {TRIGGER.NAME} is {TRIGGER.STATUS}</td>
</tr>
<tr>
<td>Recovery message</td>
<td>HOST: {HOST.NAME}<br>TRIGGER_NAME: {TRIGGER.NAME}<br>TRIGGER_STATUS: {TRIGGER.STATUS}<br>TRIGGER_SEVERITY: {TRIGGER.SEVERITY}<br>DATETIME: {DATE} / {TIME}<br>ITEM_ID: {ITEM.ID1}<br>ITEM_NAME: {ITEM.NAME1}<br>ITEM_KEY: {ITEM.KEY1}<br>ITEM_VALUE: {ITEM.VALUE1}<br>EVENT_ID: {EVENT.ID}<br>TRIGGER_URL: {TRIGGER.URL}</td>
</tr>
<tr>
<td>Enabled</td>
<td>チェック</td>
</tr>
</tbody></table>
<p>以下項目から判断して Reactio API を叩いてます。</p>
<ul>
<li>subject の PROBLEM/RECOVERY</li>
<li>HOST: {HOST.NAME}</li>
<li>EVENT_ID: {EVENT.ID}</li>
</ul>
<p><span style="color:red">メッセージを整形する場合でも、 上記項目は残しておくようにしてください。</span></p>
<ul>
<li>Operations タブ選択し Operations 情報入力</li>
</ul>
<img src="https://i.imgur.com/r7MXmVg.png" width="300px">

<img src="https://i.imgur.com/Sx36MPZ.png" width="400px">

<img src="https://i.imgur.com/bv5hcoM.png" width="400px">

<p>以上 Zabbix で Reactio 連携設定完了しました。</p>
<h2><span id="実行結果">実行結果</span></h2><ul>
<li>インシデント作成できた！</li>
<li>作成したインシデントのステータスが更新された！</li>
</ul>
<div style="text-align:center;">
<img src="https://i.imgur.com/zWJpmAi.png" width="100%">
</div>


<h2><span id="今後">今後</span></h2><p>当方、運用し始めです。<br>障害レベルによってメッセージを変更したりと今後更新検討致します。</p>
<p>是非以下も合わせて Zabbix-Slack 連携もご利用ください。</p>
<p><a href="https://github.com/kenzo0107/zabbix3-slack">zabbix3-slack</a></p>
<p>以上<br>ご清聴ありがとうございました。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/05/06/2016-05-07-zabbix2slack/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160507/20160507002257.png" alt="sftpをシェル化してファイルアップロード"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-05-06T15:00:00.000Z" title="2016-05-06T15:00:00.000Z">2016-05-07</time><span class="level-item">数秒 read (About 106 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/05/06/2016-05-07-zabbix2slack/">sftpをシェル化してファイルアップロード</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>Zabbix3.x系でのSlackへの障害内容通知方法をまとめました。</p>
<p>簡単なメッセージの通知でなく<br>ある程度見やすく、状況判断しやすい様にしました。</p>
<p>↓まずざっくりとこんな感じです。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160507/20160507002056.png" width="100%">
</div>


<h2><span id="手順">手順</span></h2><p>Gitに上げてます。ご参照ください。</p>
<a href="https://github.com/kenzo0107/zabbix3-slack" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://avatars0.githubusercontent.com/u/6197906?s=400&v=4"></div><div class="descriptions"><div class="og-title">kenzo0107/Zabbix3-Slack</div><div class="og-description">slack notification from zabbix3. Contribute to kenzo0107/Zabbix3-Slack development by creating an account on GitHub.</div></div></div></a>
</div></article></div>