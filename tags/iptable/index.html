<div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">タグ</a></li><li class="is-active"><a href="#" aria-current="page">iptable</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-12-23T15:00:00.000Z" title="2015-12-23T15:00:00.000Z">2015-12-24</time><span class="level-item">6分 read (About 955 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/12/23/2015-12-24-iptables-allow-ping/">pingを通すiptableの設定</a></h1><div class="content"><h2><span id="環境">環境</span></h2><ul>
<li>CentOS 5.8</li>
</ul>
<h2><span id="実現したいこと">実現したいこと</span></h2><p><code>Server A</code> が <code>Server B</code> からのみ ping を通す</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----------+  Ping Request   +----------+</span><br><span class="line">|          | &lt;-------------- |          |</span><br><span class="line">| Server A |                 | Server B |</span><br><span class="line">|          | --------------&gt; |          |</span><br><span class="line">+----------+  Ping Response  +----------+</span><br></pre></td></tr></table></figure>

<h2><span id="特定ipからの-ping-を通す許可設定">特定IPからの ping を通す許可設定</span></h2><p>以下設定を <code>Server A</code> で実施する。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Server A]# iptables -A INPUT -p icmp --icmp-type 8 -s &lt;Server B の IP Address&gt; -j ACCEPT</span><br><span class="line">[Server A]# iptables -A OUTPUT -p icmp --icmp-type 0 -s &lt;Server B の IP Address&gt; -j ACCEPT</span><br><span class="line">[Server A]# service iptables restart</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><code>--icmp-type 8</code> は <code>Echo request (エコー要求)</code> を許可</li>
<li><code>--icmp-type 0</code> は <code>Echo Reply (エコー応答)</code> を許可</li>
</ul>
</blockquote>
<h2><span id="server-bから-ping実行">Server Bから ping実行</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Server B]# ping &lt;Server A の IP Address&gt;</span><br><span class="line"></span><br><span class="line">PING (&lt;Server A の IP Address&gt;): 56 data bytes</span><br><span class="line">64 bytes from (&lt;Server A の IP Address&gt;): icmp_seq&#x3D;0 ttl&#x3D;58 time&#x3D;4.411 ms</span><br><span class="line">64 bytes from (&lt;Server A の IP Address&gt;): icmp_seq&#x3D;1 ttl&#x3D;58 time&#x3D;4.079 ms</span><br><span class="line">64 bytes from (&lt;Server A の IP Address&gt;): icmp_seq&#x3D;2 ttl&#x3D;58 time&#x3D;4.027 ms</span><br><span class="line">^C</span><br><span class="line">--- (&lt;Server A の IP Address&gt;) ping statistics ---</span><br><span class="line">3 packets transmitted, 3 packets received, 0.0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max&#x2F;stddev &#x3D; 4.027&#x2F;4.172&#x2F;4.411&#x2F;0.170 ms</span><br></pre></td></tr></table></figure>


<h2><span id="icmp-type-list">icmp-type List</span></h2><p>以下<a href="http://www.asahi-net.or.jp/~aa4t-nngk/ipttut/output/icmptypes.html">asahi-net Appendix C. ICMPタイプ</a>より参照</p>
<table>
<thead>
<tr>
<th>TYPE</th>
<th>CODE</th>
<th>意味</th>
<th>問合せ</th>
<th>エラー</th>
<th>参照先</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>Echo Reply (エコー応答)</td>
<td>x</td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>0</td>
<td>Network Unreachable (ネットワーク到達不能)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>Host Unreachable (ホスト到達不能)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>Protocol Unreachable (プロトコル到達不能)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>Port Unreachable (ポート到達不能)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>Fragmentation needed but no frag. bit set (フラグメント必要だがフラグメント禁止ビットあり)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>5</td>
<td>Source routing failed (ソースルーティング失敗)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>6</td>
<td>Destination network unknown (宛先ネットワーク発見できず)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>7</td>
<td>Destination host unknown (宛先ホスト発見できず)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>8</td>
<td>Source host isolated (送信元ホストへのルートなし) (廃)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>9</td>
<td>Destination network administratively prohibited (宛先ネットワークは設定によりアクセス禁止)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>10</td>
<td>Destination host administratively prohibited (宛先ホストは設定によりアクセス禁止)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>11</td>
<td>Network unreachable for TOS (TOS種別によりネットワーク到達不能)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>12</td>
<td>Host unreachable for TOS (TOS種別によりホスト到達不能)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>13</td>
<td>Communication administratively prohibited by filtering (フィルタリング設定により通信禁止)</td>
<td></td>
<td>x</td>
<td>RFC1812</td>
</tr>
<tr>
<td>3</td>
<td>14</td>
<td>Host precedence violation (ホスト優先順位侵害)</td>
<td></td>
<td>x</td>
<td>RFC1812</td>
</tr>
<tr>
<td>3</td>
<td>15</td>
<td>Precedence cutoff in effect (優先順位により遮断発動)</td>
<td></td>
<td>x</td>
<td>RFC1812</td>
</tr>
<tr>
<td>4</td>
<td>0</td>
<td>Source quench (輻輳発生による発信抑制)</td>
<td></td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>5</td>
<td>0</td>
<td>Redirect for network (指定ネットワークへのリダイレクト要求)</td>
<td></td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
<td>Redirect for host (指定ホストへのリダイレクト要求)</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>2</td>
<td>Redirect for TOS and network (TOSとネットワークのリダイレクト要求)</td>
<td></td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>5</td>
<td>3</td>
<td>Redirect for TOS and host (TOSとホストのリダイレクト要求)</td>
<td></td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>8</td>
<td>0</td>
<td>Echo request(エコー要求)</td>
<td>x</td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>9</td>
<td>0</td>
<td>Router advertisement - Normal router advertisement (ルータ広告 - 通常通知)</td>
<td></td>
<td></td>
<td>RFC1256</td>
</tr>
<tr>
<td>9</td>
<td>16</td>
<td>Router advertisement - Does not route common traffic (ルータ広告 - 通常トラフィックはルーティング不可)</td>
<td></td>
<td></td>
<td>RFC2002</td>
</tr>
<tr>
<td>10</td>
<td>0</td>
<td>Route selection (ルート選択)</td>
<td></td>
<td></td>
<td>RFC1256</td>
</tr>
<tr>
<td>11</td>
<td>0</td>
<td>TTL equals 0 during transit (搬送中にTTLが0に)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>11</td>
<td>1</td>
<td>TTL equals 0 during reassembly (再構成時の欠損フラグメント待機中に時間超過)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>12</td>
<td>0</td>
<td>IP header bad (catchall error) (IPヘッダ異常) (あらゆるエラーに共通)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>12</td>
<td>1</td>
<td>Required options missing (必要なオプションが欠如)</td>
<td></td>
<td>x</td>
<td>RFC1108</td>
</tr>
<tr>
<td>12</td>
<td>2</td>
<td>IP Header bad length (IPヘッダ長の異常)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>13</td>
<td>0</td>
<td>Timestamp request (obsolete) (タイムスタンプ要求) (廃)</td>
<td>x</td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>14</td>
<td></td>
<td>Timestamp reply (obsolete) (タイムスタンプ応答) (廃)</td>
<td>x</td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>15</td>
<td>0</td>
<td>Information request (obsolete) (情報要求) (廃)</td>
<td>x</td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>16</td>
<td>0</td>
<td>Information reply (obsolete) (情報応答) (廃)</td>
<td>x</td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>17</td>
<td>0</td>
<td>Address mask request (ネットマスク通知要求)</td>
<td>x</td>
<td></td>
<td>RFC950</td>
</tr>
<tr>
<td>18</td>
<td>0</td>
<td>Address mask reply (ネットマスク通知応答)</td>
<td>x</td>
<td></td>
<td>RFC950</td>
</tr>
<tr>
<td>20-29</td>
<td></td>
<td>Reserved for robustness experiment (信頼性試験のための予約域)</td>
<td></td>
<td></td>
<td>Zaw-Sing Su</td>
</tr>
<tr>
<td>30</td>
<td>0</td>
<td>Traceroute</td>
<td>x</td>
<td></td>
<td>RFC1393</td>
</tr>
<tr>
<td>31</td>
<td>0</td>
<td>Datagram Conversion Error (データグラム変換エラー)</td>
<td></td>
<td>x</td>
<td>RFC1475</td>
</tr>
<tr>
<td>32</td>
<td>0</td>
<td>Mobile Host Redirect (移動体ホストのリダイレクト)</td>
<td></td>
<td></td>
<td>David Johnson</td>
</tr>
<tr>
<td>33</td>
<td>0</td>
<td>IPv6 Where-Are-You (IPv6位置確認要求)</td>
<td>x</td>
<td></td>
<td>Bill Simpson</td>
</tr>
<tr>
<td>34</td>
<td>0</td>
<td>IPv6 I-Am-Here (IPv6位置確認応答)</td>
<td>x</td>
<td></td>
<td>Bill Simpson</td>
</tr>
<tr>
<td>35</td>
<td>0</td>
<td>Mobile Registration Request (移動体登録要求)</td>
<td>x</td>
<td></td>
<td>Bill Simpson</td>
</tr>
<tr>
<td>36</td>
<td>0</td>
<td>Mobile Registration Reply (移動体登録応答)</td>
<td>x</td>
<td></td>
<td>Bill Simpson</td>
</tr>
<tr>
<td>39</td>
<td>0</td>
<td>SKIP</td>
<td></td>
<td></td>
<td>Tom Markson</td>
</tr>
<tr>
<td>40</td>
<td>0</td>
<td>Photuris</td>
<td></td>
<td></td>
<td>RFC2521</td>
</tr>
</tbody></table>
</div></article></div>