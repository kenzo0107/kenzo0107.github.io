<div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">タグ</a></li><li class="is-active"><a href="#" aria-current="page">Jenkins</a></li></ul></nav></div></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/12/08/2016-12-09-fix-unable-to-read-jenkins-config/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20161209/20161209135407.png" alt="Jenkins が起動しない - Unable to read /var/lib/jenkins/config.xml -"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-12-08T15:00:00.000Z" title="2016-12-08T15:00:00.000Z">2016-12-09</time><span class="level-item">2分 read (About 255 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/12/08/2016-12-09-fix-unable-to-read-jenkins-config/">Jenkins が起動しない - Unable to read /var/lib/jenkins/config.xml -</a></h1><div class="content"><h2><span id="とある午後-jenkins-を再起動したときに出たエラー">とある午後、Jenkins を再起動したときに出たエラー</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">hudson.util.HudsonFailedToLoad: org.jvnet.hudson.reactor.ReactorException: java.io.IOException: Unable to read &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;config.xml</span><br><span class="line">	at hudson.WebAppMain$3.run(WebAppMain.java:234)</span><br><span class="line">Caused by: org.jvnet.hudson.reactor.ReactorException: java.io.IOException: Unable to read &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;config.xml</span><br><span class="line">	at org.jvnet.hudson.reactor.Reactor.execute(Reactor.java:269)</span><br><span class="line">	at jenkins.InitReactorRunner.run(InitReactorRunner.java:44)</span><br><span class="line">	at jenkins.model.Jenkins.executeReactor(Jenkins.java:912)</span><br><span class="line">	at jenkins.model.Jenkins.&lt;init&gt;(Jenkins.java:811)</span><br><span class="line">	at hudson.model.Hudson.&lt;init&gt;(Hudson.java:82)</span><br><span class="line">	at hudson.model.Hudson.&lt;init&gt;(Hudson.java:78)</span><br><span class="line">	at hudson.WebAppMain$3.run(WebAppMain.java:222)</span><br></pre></td></tr></table></figure>

<p><code>/var/lib/jenkins/config.xml が読み込めない</code> というエラー</p>
<p><code>/var/lib/jenkins/config.xml</code> の所有者は jenkins:jenkins だけど、なぜ？</p>
<p>と権限周りを諸々試験して直していくと<br><code>plugins</code> をディレクトリごと所有者変更すると直りました汗</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chown -R jenkins:jenkins &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;plugins</span><br></pre></td></tr></table></figure>

<p>plugin の挙動で何か所有者変更され得るものがあったのか解明せず。</p>
<h2><span id="同様の事象の記事を見つけたので参照">同様の事象の記事を見つけたので参照</span></h2>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/05/31/2016-06-01-jenkins-short-cycles-in-the-day-of-month-field-will-behave-oddly-near-the-end-of-a-month/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160601/20160601191107.png" alt="Jenkins - Short cycles in the day-of-month field will behave oddly near the end of a month"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-05-31T15:00:00.000Z" title="2016-05-31T15:00:00.000Z">2016-06-01</time><span class="level-item">1分 read (About 149 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/05/31/2016-06-01-jenkins-short-cycles-in-the-day-of-month-field-will-behave-oddly-near-the-end-of-a-month/">Jenkins - Short cycles in the day-of-month field will behave oddly near the end of a month</a></h1><div class="content"><p>完全なる備忘録です。</p>
<p>Jenkinsで 毎月第1月曜日のみ設定しようとしたら</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160601/20160601191107.png" width="100%">
</div>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Short cycles in the day-of-month field will behave oddly near the end of a month</span><br></pre></td></tr></table></figure>

<p>次の様に分けるとエラーが消えます。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160601/20160601191211.png" width="100%">
</div>



<h2><span id="概要">概要</span></h2><p>アメリカでは<br>月間の期間を4,5週間の単位で<br>売り上げの結果を考える慣習があります。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160601/20160601223531.gif" width="100%">
</div>

<p>その際に月初にレポートが欲しい<br>なんてときに今回このような処理をする必要がありました。</p>
<p>以上です。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/05/20/2016-05-21-jenkins-sonarqube-php-code-metrics/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521003213.png" alt="Jenkins + SonarQube で PHPコードメトリクス計測！"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-05-20T15:00:00.000Z" title="2016-05-20T15:00:00.000Z">2016-05-21</time><span class="level-item">5分 read (About 696 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/05/20/2016-05-21-jenkins-sonarqube-php-code-metrics/">Jenkins + SonarQube で PHPコードメトリクス計測！</a></h1><div class="content"><h2><span id="前回">前回</span></h2><p>Jenkinsとは別のサーバ上に<br>SonarQube をインストールし<br>アクセスできるまでをまとめました。</p>
<a href="http://kenzo0107.hatenablog.com/entry/2016/05/19/192058" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="http://i.imgur.com/etIqshd.png"></div><div class="descriptions"><div class="og-title">CentOS7にSonarQubeをインストールしアクセス確認まで - 長生村本郷Engineers&#39;Blog</div><div class="og-description">概要 SonarQube™は Java, Python, Ruby, PHP等、複数言語のコードメトリクス集計ができる 優れものです。 以前 MacOSXローカル環境で Unityプロジェクト C#コードのコードメトリクス抽出方法をまとめました。 kenzo0107.hatena…</div></div></div></a>


<p>今回は Jenkins からソースを解析し<br>SonarQubeでのメトリクス情報を表示までの実行方法をまとめます。</p>
<p>言語は どれでも良いですが、 今回は PHP とします。</p>
<h2><span id="overview">Overview</span></h2><p>以下概要になります。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521003213.png" width="100%">
</div>

<h2><span id="sonarqube側事前準備">SonarQube側事前準備</span></h2><p>プロジェクトを作成しプロジェクトキーを発行します。</p>
<h3><span id="1-ログインページへアクセス">1. ログインページへアクセス</span></h3><p>http://<sonarqube ip>:9000/sessions/new</sonarqube></p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160520/20160520233944.png" width="100%">
</div>

<p>デフォルトでは以下 admin:admin アカウントでログイン</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>ID</td>
<td>admin</td>
</tr>
<tr>
<td>PW</td>
<td>admin</td>
</tr>
</tbody></table>
<h3><span id="2-プロジェクト作成">2. プロジェクト作成</span></h3><ul>
<li>ヘッダーメニュー Administration クリックし Administration ページへ遷移</li>
<li>Projects &gt; Management クリック</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160520/20160520234632.png" width="100%">
</div>

<ul>
<li>Create ボタンクリック</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160520/20160520235020.png" width="100%">
</div>

<ul>
<li>Name, Key 入力し</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521000020.png" width="100%">
</div>

<ul>
<li>プロジェクトが追加されたことがわかります。</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521001309.png" width="100%">
</div>

<h3><span id="3-php-plugin-インストール">3. PHP Plugin インストール</span></h3><ul>
<li>Administration ページ System &gt; Update Center クリック</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521002115.png" width="100%">
</div>

<ul>
<li>Available 選択 → 検索窓で「PHP」と入力 → 表示された PHP Plugin でInstallクリック</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521002430.png" width="100%">
</div>

<ul>
<li>Restart でSonarQubeに PHP Plugin インストール</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521002605.png" width="100%">
</div>

<ul>
<li>Installed タブで PHP Plugin がインストールされていることを確認</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521002918.png" width="100%">
</div>

<h3><span id="4-authentication-token-発行">4. authentication token 発行</span></h3><ul>
<li>Security &gt; User クリック</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521005252.png" width="100%">
</div>

<ul>
<li>TOKENS クリックしポップアップ表示</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521005424.png" width="100%">
</div>

<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521005757.png" width="100%">
</div>

<ul>
<li>任意の文字列を入力しcreate</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521005946.png" width="100%">
</div>

<ul>
<li>tokenコピー<br>Jenkins側の設定時に利用します。</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521010037.png" width="100%">
</div>

<p>以上でSonarQube側の事前準備は終了です。</p>
<h2><span id="jenkins-側準備">Jenkins 側準備</span></h2><h3><span id="1-sonarqube-plugin-インストール">1. SonarQube Plugin インストール</span></h3><p>Jenkinsの管理 &gt; Pluginの管理<br>にて SonarQube Plugin インストール</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521003400.png" width="100%">
</div>

<h3><span id="2-sonarqube-scanner-インストール">2. SonarQube Scanner インストール</span></h3><p>以下オフィシャルダウンロードページからリンク取得</p>
<p><a href="http://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner">Analyzing+with+SonarQube+Scanner</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /var/lib/jenkins</span><br><span class="line">$ wget https://sonarsource.bintray.com/Distribution/sonar-scanner-cli/sonar-scanner-2.6.1.zip</span><br><span class="line">$ unzip sonar-scanner-2.6.1.zip</span><br><span class="line">$ ln -s sonar-scanner-2.6.1 sonar-scanner</span><br></pre></td></tr></table></figure>

<h3><span id="3-jenkinsシステム設定">3. Jenkinsシステム設定</span></h3><ul>
<li><p>Jenkinsの管理 &gt; システムの設定 へアクセス</p>
</li>
<li><p>JenkinsQube servers に必要項目入力</p>
</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521004429.png" width="100%">
</div>

<ul>
<li>SonarQube Scanner に先ほどインストールした sonar-scannerパスを設定</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521004625.png" width="100%">
</div>

<p>上記入力後保存</p>
<h3><span id="4-ジョブ新規作成">4. ジョブ新規作成</span></h3><p>「sonarqubeTest」という名前のジョブを新規作成します。</p>
<ul>
<li>git リポジトリよりPHPプロジェクト取得設定</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521010200.png" width="100%">
</div>

<ul>
<li>SonarScanner 実行設定</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521010349.png" width="100%">
</div>

<p>以上でJenkins側の設定完了です。</p>
<h2><span id="sonarqube-反映確認">SonarQube 反映確認</span></h2><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521010726.png" width="100%">
</div>


<p>ちなみにこちら EC-CUBE 1.1のプロジェクトでした。</p>
<p>EC-CUBEのコード重複率が多く<br>無駄が如何に多いかがわかります。</p>
<p>以上です。</p>
</div></article></div>