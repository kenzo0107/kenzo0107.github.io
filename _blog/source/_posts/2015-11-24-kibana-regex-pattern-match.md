---
layout: post
title: Kibana4 検索窓での検索 正規表現パターンマッチ等
date: 2015-11-24
tags:
- Kibana
thumbnail: https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20151124/20151124123137.png
---

## 概要

アクセスログをfluentdで集積(aggregate)して
ElasticSearch へ保存、そのデータをkibanaで表示しています。

ちょっとしたアクセスログ解析したい場合、
かつては、SSHでサーバにログインして
コマンド実行し検索するという工程を踏んでいました。

ですが、Kibanaで検索することにより
サーバログインすることなく、検索がスムーズになりました。

リモートログインして誤った操作等もなくなる、
また本番環境アカウントの公開範囲を絞ることができ
良いことが増えました。

実際構築しても使う側がどう検索したら良いかわからないということが
ちょいちょいあったので
Kibana4 検索窓での検索方法を簡単にまとめました。


## 前提

- Kibana4
- ドメイン名を以下とする

`http(s)://hogehoge.jp`


### 範囲指定

- httpステータスコード 200 から 400 検索

status: [200 TO 400]

### 否定

- 例) 指定ドメイン以外のリファラ検索
- `referer` という項目について 正規表現での否定(NOT)のパターンマッチで検索します。

```
NOT referer:/http(s?)\:\/\/hogehoge\.jp\/(.*)/
```

### 複合検索

- 例) 指定ドメイン以外、且つ、200ステータス

```
NOT referer:/http(s?)\:\/\/hogehoge\.jp\/(.*)/ AND status:200
```

随時、事例があれば追記していきます。
