<div class="card"><div class="card-image"><span class="image is-7by3"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20190804/20190804180237.png" alt="EC2 Instance Connect API で ssh ログインできるインタラクティブ cli tool &quot;omssh&quot; を作ってみました。"></span></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-08-03T15:00:00.000Z" title="2019-08-03T15:00:00.000Z">2019-08-04</time><span class="level-item">4分 read (About 611 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">EC2 Instance Connect API で ssh ログインできるインタラクティブ cli tool &quot;omssh&quot; を作ってみました。</h1><div class="content"><h2><span id="概要">概要</span></h2><p>oreno-mssh、またの名を <a href="https://github.com/kenzo0107/omssh">omssh</a> という AWS EC2 Instance Connect API を利用した ssh ログインツールを作成しました。</p>

<p><blockquote class="imgur-embed-pub" lang="en" data-id="YRcyWzC"><a href="https://imgur.com/YRcyWzC">View post on imgur.com</a></blockquote><script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script><cite class="hatena-citation"><a href="https://imgur.com/YRcyWzC">imgur.com</a></cite></p>

<a id="more"></a>

<h2><span id="作ろうと思った経緯">作ろうと思った経緯</span></h2><p>以前 EC2 Instance Connect API の登場により、EC2 Instance ID 指定で ssh ログインできる様になりました。</p>

<p>これにより、ssh ログイン接続するメンバーに秘密鍵を渡す、公開鍵を登録する等の作業が不要となりました。</p>

<a href="https://kenzo0107.github.io/2019/06/28/2019-06-28-ec2-instance-connect-aws-ec2-ssh-iam-user-or-group/" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20190628/20190628154100.png"></div><div class="descriptions"><div class="og-title">EC2 Instance Connect で AWS EC2 への ssh 管理を IAM User or Group で簡単に♪</div><div class="og-description">概要2019-06-28 に EC2 Instance Conncet が発表されました！ これによって、セキュリティグループと IAM 権限で ssh アクセス許可が可能になります。  例えば、 会社の IP からのみ、特定の IAM User Group に所属している IA…</div></div></div></a>

<p><a href="https://dev.classmethod.jp/cloud/aws/ec2-instance-connect/">mssh</a> を使用した場合、以下の様なコマンドで ssh ログインできます。</p>

<pre class="code" data-lang data-unlink>// Amazon Linux への ssh
mssh &lt;EC2 Instance ID&gt; --profile &lt;profile&gt;

// Ubuntu
mssh ubuntu@&lt;EC2 Instance ID&gt; --profile &lt;profile&gt;</pre>


<p>mssh を利用するには `&lt;EC2 Instance ID&gt;` 情報が必要で、毎回 Instance ID を調べる手間がありました。</p>

<p>もちろん踏み台サーバであれば、そうそう再起動され Instance ID が変更されることはないのでメモっておけば良いのでしょうが、
数が多くなると、管理が大変です。</p>

<p>その手間を <a href="https://github.com/ktr0731/go-fuzzyfinder">fuzzyfinder</a> でインタラクティブに解決しようと思いました。</p>

<h2><span id="使用方法">使用方法</span></h2><p>README.md にもありますが、以下ステップでインストールできます。</p>

<pre class="code" data-lang data-unlink>$ git clone https://github.com/kenzo0107/omssh
$ cd omssh
$ make build && make install</pre>


<h2><span id="今後">今後</span></h2><p>現在、EC2 Instance Connect を利用した運用に切り替えきれないところがあります。</p>

<p>理由は、EC2 インスタンスを Public Subnet に配置していないと EC2 Instance Connect API が利用できない為、踏み台までは EC2 Instance Connect API を利用し ssh ログインできたけど、その先は、秘密鍵が必要になる為です。</p>

<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20190804/20190804180237.png" width="100%">
</div>

<p>おそらく近々 Private Subnet でも EC2 Instance Connect が利用できる様になるのでは？と期待しています。</p>
<p>そうなれば、踏み台にも omssh を置いて、鍵を意識せず、 IAM の権限だけで、 ssh 権限を管理できる様な世界が実現できます。</p>
<p>AWS サポートに願いを伝えておきます♪</p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/AWS/">AWS</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Gefällt Ihnen der Artikel? Unterstützen Sie den Autor mit</h3><div class="buttons is-centered"><a class="button is-danger donate" href="https://www.patreon.com/kenzo0107" target="_blank" rel="noopener"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2019/08/15/2019-08-16-puppeteer-on-docker/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">puppeteer on Docker </span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/06/27/2019-06-28-ec2-instance-connect-aws-ec2-ssh-iam-user-or-group/"><span class="level-item">EC2 Instance Connect で AWS EC2 への ssh 管理を IAM User or Group で簡単に♪</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!-->