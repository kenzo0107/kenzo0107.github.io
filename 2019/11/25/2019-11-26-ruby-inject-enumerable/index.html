<div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-25T15:00:00.000Z" title="2019-11-25T15:00:00.000Z">2019-11-26</time><span class="level-item">5分 read (About 700 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Ruby inject (Enumerable) メソッドを学ぶ</h1><div class="content"><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20191123/20191123143247.png" width="100%">
</div>

<h2><span id="概要">概要</span></h2><p>お題を通して Ruby で inject メソッドを学びました。その備忘録です。</p>
<a id="more"></a>

<h2><span id="お題">お題</span></h2><p>123,456 円を紙幣・硬貨が一番少なくなる様になる組み合わせを求めてください。<br>硬貨 … 1, 5, 10, 50, 100, 500 円玉<br>紙幣 … 1000, 2000, 5000, 10000 円札</p>
<h2><span id="答え">答え</span></h2><ul>
<li>10,000 円札 × 12</li>
<li>5,000 円札 × 0</li>
<li>2,000 円札 × 1</li>
<li>1,000 円札 × 1</li>
<li>500 円玉 × 0</li>
<li>100 円玉 × 4</li>
<li>50 円玉 × 1</li>
<li>10 円玉 × 0</li>
<li>5 円玉 × 1</li>
<li>1 円玉 × 1</li>
</ul>
<h3><span id="inject-メソッド">inject メソッド</span></h3><p>配列の組み合わせで答えを出すとシンプルに書けます。</p>
<script src="//gist.github.com/kenzo0107/d36b644e1f19f69d6ef41382825b9b6a.js"></script>

<p>大きい値から順に divmod の結果 <code>[商, 余り]</code> を不定数個の配列 (a) の後ろに足して、<br>r に配列の一番後ろの要素 <code>余り</code> が入るので、それ次の iterator の計算に利用する方法です。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[] + <span class="number">123456</span>.divmode(<span class="number">10000</span>) <span class="comment"># [12, 3456]</span></span><br><span class="line">[<span class="number">12</span>, <span class="number">3456</span>] + <span class="number">3456</span>.divmod(<span class="number">5000</span>) <span class="comment"># [12, 0, 3456]</span></span><br><span class="line">[<span class="number">12</span>, <span class="number">0</span>, <span class="number">3456</span>] + <span class="number">3456</span>.divmod(<span class="number">2000</span>) <span class="comment"># [12, 0, 1, 1456]</span></span><br><span class="line">[<span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1456</span>] + <span class="number">1456</span>.divmod(<span class="number">1000</span>) <span class="comment"># [12, 0, 1, 1, 456]</span></span><br><span class="line">[<span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">456</span>] + <span class="number">456</span>.divmod(<span class="number">500</span>) <span class="comment"># [12, 0, 1, 1, 0, 456]</span></span><br><span class="line">[<span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">456</span>] + <span class="number">456</span>.divmod(<span class="number">100</span>) <span class="comment"># [12, 0, 1, 1, 0, 4, 56]</span></span><br><span class="line">[<span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">456</span>] + <span class="number">56</span>.divmod(<span class="number">50</span>) <span class="comment"># [12, 0, 1, 1, 0, 4, 1, 6]</span></span><br><span class="line">[<span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">6</span>] + <span class="number">6</span>.divmod(<span class="number">10</span>) <span class="comment"># [12, 0, 1, 1, 0, 4, 1, 1, 0, 6]</span></span><br><span class="line">[<span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">6</span>] + <span class="number">6</span>.divmod(<span class="number">5</span>) <span class="comment"># [12, 0, 1, 1, 0, 4, 1, 1, 0, 1]</span></span><br><span class="line">[<span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>] + <span class="number">1</span>.divmod(<span class="number">1</span>) <span class="comment"># [12, 0, 1, 1, 0, 4, 1, 1, 0, 1, 1, 0]</span></span><br></pre></td></tr></table></figure>


<p>最後の 0 が余計ですが、非常にシンプルな形で答えを求られました。</p>
<p>ただ、<br>この inject の計算式が初手でスッと出すのは慣れが必要な印象。</p>
<p>なので、<br>一旦 each で計算の手順を確認してから inject でコードがシンプルになりそうならやってみる、<br>っていうのが慣れるのに良さそうでした。</p>
<h2><span id="each-メソッド">each メソッド</span></h2><script src="//gist.github.com/kenzo0107/8b32c9b56bd755b2c0e072d063ce0c0c.js"></script>

<p>each でやると loop の外側で <code>b = []</code> と最終的に返す配列を定義する必要があります。</p>
<p><code>b &lt;&lt; r if p.size - 1 == index</code> は、不要ですが、回答の配列を inject メソッドの場合と合わせました。</p>
<h2><span id="benchmark-とってみる">benchmark とってみる</span></h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> &amp;quot;benchmark&amp;quot;</span><br><span class="line"></span><br><span class="line">r = <span class="number">123_456</span></span><br><span class="line"></span><br><span class="line">Benchmark.bmbm <span class="keyword">do</span> <span class="params">|x|</span></span><br><span class="line">    x.report(&amp;quot;div_inject&amp;quot;) <span class="keyword">do</span></span><br><span class="line">        <span class="number">10000</span>.times <span class="keyword">do</span></span><br><span class="line">            div_inject(r)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    x.report(&amp;quot;div_each&amp;quot;) <span class="keyword">do</span></span><br><span class="line">        <span class="number">10000</span>.times <span class="keyword">do</span></span><br><span class="line">            div_each(r)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>


<p>each の方が速かったです。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">                 user     system      total        real</span><br><span class="line">div_inject   <span class="number">0</span>.<span class="number">037365</span>   <span class="number">0</span>.<span class="number">000524</span>   <span class="number">0</span>.<span class="number">037</span>889 (  <span class="number">0</span>.<span class="number">040733</span>)</span><br><span class="line">div_each     <span class="number">0</span>.<span class="number">024333</span>   <span class="number">0</span>.<span class="number">000257</span>   <span class="number">0</span>.<span class="number">0245</span>9<span class="number">0</span> (  <span class="number">0</span>.<span class="number">025320</span>)</span><br></pre></td></tr></table></figure>

<p>個人的には inject の方が速くなってくれると本記事が締まったんですが<br>今回の計算ロジックでは、each の方がパフォーマンスがよかったです。</p>
<h2><span id="hash-を扱ってみる">hash を扱ってみる</span></h2><h3><span id="inject">inject</span></h3><script src="//gist.github.com/kenzo0107/7d43a2ff956336ed04efdc36cbc2800a.js"></script>


<h3><span id="each">each</span></h3><script src="//gist.github.com/kenzo0107/7c50a3fcecc7aa8e25ce9ad58e522137.js"></script>

<p>benchmark とると、 each, hash どちらもほぼ同等でした。</p>
<h2><span id="まとめ">まとめ</span></h2><p>inject メソッドを例題を通して学びました。</p>
<p>例題では特にシンプルに書けましたが、パフォーマンスが格段に上がるという話ではないので<br>使い所は見定める必要があるかなと思いました。</p>
<p>以上<br>ご参考になれば幸いです。</p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Ruby/">Ruby</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Gefällt Ihnen der Artikel? Unterstützen Sie den Autor mit</h3><div class="buttons is-centered"><a class="button is-danger donate" href="https://www.patreon.com/kenzo0107" target="_blank" rel="noopener"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2019/12/05/2019-12-06-fix-can-t-find-gem-bundler-0-a-with-executable-bundle-gem-gemnotfoundexception/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Fix: can&#039;t find gem bundler (&gt;= 0.a) with executable bundle (Gem::GemNotFoundException)</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/11/10/2019-11-11-golang/"><span class="level-item">Golang で関数のデフォルト引数を指定する</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!-->