<div class="card"><div class="card-image"><span class="image is-7by3"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20161202/20161202122453.png" alt="「会員登録完了メールが迷惑メールに入っちゃいます」対策"></span></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-12-01T15:00:00.000Z" title="2016-12-01T15:00:00.000Z">2016-12-02</time><span class="level-item">4分 read (About 608 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">「会員登録完了メールが迷惑メールに入っちゃいます」対策</h1><div class="content"><h2><span id="概要">概要</span></h2><p>サイト作りにありがちな設定忘れ<br>「会員登録完了メールが迷惑メールに入っちゃいます」</p>
<p>SPFレコード設定とDNSの逆引き設定が必要です。</p>
<h2><span id="まず-dns-正引きとは">まず DNS 正引きとは</span></h2><blockquote>
<p>ドメイン — 問合せ —&gt; IPアドレス</p>
</blockquote>
<p>以下のようなメールアドレスがあるとします。</p>
<p><code>info@hogehoge.jp</code></p>
<p>この <code>hogehoge.jp</code> から IPアドレス を問い合わせるのが <code>正引き</code></p>
<h2><span id="dns-逆引きとは">DNS 逆引きとは</span></h2><blockquote>
<p>IP アドレス — 問合せ —&gt; ドメイン</p>
</blockquote>
<p>IPアドレス から <code>hogehoge.jp</code> を問い合わせるのが <code>逆引き</code></p>
<h2><span id="spfレコード">SPFレコード</span></h2><p>SPF = Sender Policy Framework</p>
<p>メールを送る側のポリシーを設定したフレームワークです。</p>
<h2><span id="何故こんなフレームワークがあるの">何故こんなフレームワークがあるの？</span></h2><p>送信元偽装なんて簡単にできるから！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;TEST&quot; | sendmail -f aiueo@xxxx.jp -t kenzo.xxxxxx.0107@gmail.com</span><br></pre></td></tr></table></figure>

<div style="text-align:center;">
<img src="http://i.imgur.com/brOZazX.png" width="100%">
</div>



<h2><span id="spfレコードを設定することの意味">SPFレコードを設定することの意味</span></h2><p>SPFレコード設定する、ということは<br>送信元の IPアドレス, ドメイン を指定することで<br>受信先が 送信元メールアドレスとSPFレコード情報に設定している IP, ドメイン情報と一致しているか<br>わかるようになります。</p>
<h2><span id="逆引き設定することの意味">逆引き設定することの意味</span></h2><p>送信元のIPアドレスから割り出したドメインと<br>逆引き設定されたIPに紐づくドメインとを照合し<br>異なる場合は偽装と判断することができる為です。</p>
<p>Gmail などではこのフィルターが設定されていて<br>逆引き設定されていないと迷惑メールBOXに入っちゃいます。</p>
<h2><span id="spf-レコード設定確認">SPF レコード設定確認</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dig -t TXT &lt;メールドメイン&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>例) gmail.com</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ dig -t TXT gmail.com</span><br><span class="line"></span><br><span class="line">gmail.com.              300     IN      TXT     &quot;v&#x3D;spf1 redirect&#x3D;_spf.google.com&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>例) yahoo.co.jp</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ dig -t TXT yahoo.co.jp</span><br><span class="line"></span><br><span class="line">yahoo.co.jp.            6       IN      TXT     &quot;v&#x3D;spf1 include:spf.yahoo.co.jp ~all&quot;</span><br></pre></td></tr></table></figure>

<h2><span id="gmail-でspfレコード設定確認">Gmail でSPFレコード設定確認</span></h2><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20161202/20161202121710.png" width="100%">
</div>

<ul>
<li>SPF: NEUTRAL の場合、SPFレコードが正しく設定されていません。</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20161202/20161202121724.png" width="100%">
</div>

<ul>
<li>SPF: PASS の場合、SPFレコードが正しく設定されています。</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20161202/20161202122051.png" width="100%">
</div>


<p>以上です。</p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/spam/">spam</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Gefällt Ihnen der Artikel? Unterstützen Sie den Autor mit</h3><div class="buttons is-centered"><a class="button is-danger donate" href="https://www.patreon.com/kenzo0107" target="_blank" rel="noopener"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2016/12/08/2016-12-09-fix-unable-to-read-jenkins-config/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Jenkins が起動しない - Unable to read /var/lib/jenkins/config.xml -</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2016/11/29/2016-11-28-detect-diff-between-local-and-remote-in-python/"><span class="level-item">Python ローカルとリモートサーバ上のファイル差分抽出ツール</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!-->