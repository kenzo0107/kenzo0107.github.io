<div class="card"><div class="card-image"><span class="image is-7by3"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160627/20160627140744.png" alt="2016年5月現在、SSL評価Fを取らない為に"></span></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-06-26T15:00:00.000Z" title="2016-06-26T15:00:00.000Z">2016-06-27</time><span class="level-item">4分 read (About 626 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">2016年5月現在、SSL評価Fを取らない為に</h1><div class="content"><p>それは、ある日 <a href="https://www.ssllabs.com/ssltest/index.html">QUALYS SSL LABS</a> でSSLチェックしたとき</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160627/20160627140744.png" width="100%">
</div>

<p>F になってる…</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160627/20160627141207.jpg" width="100%">
</div>


<p>常に A+ を保っていたのに…</p>
<p>どうやら 2016/5/3 時点で新たに脆弱性が発見されたとのこと。</p>
<a href="https://oss.sios.com/security/general-security-20160504" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://tech-lab.sios.jp/wp-content/uploads/2018/05/sios_tech_lab_image.png"></div><div class="descriptions"><div class="og-title">SIOS Tech. Lab</div><div class="og-description">エンジニアのタメになるOSS・クラウド・認証の技術トピックス</div></div></div></a>


<p>今回指摘されている <code>CVE-2016-2107</code> :</p>
<blockquote>
<p>AES-NI CBC MACチェックでMITM攻撃者がパディングオラクル攻撃可能なことがわかりました。この問題は、CVE-2013-0169(Lucky 13パディング)の修正のために導入された箇所の不具合から発生しました。</p>
</blockquote>
<p>上記対応策をまとめました。</p>
<h2><span id="対応策">対応策</span></h2><ul>
<li>OpenSSL version up</li>
</ul>
<p>※試験OS環境:  CentOS7</p>
<p>以下記事では 「OpenSSLのバージョンを1.0.2h/1.0.1tにあげてください。」とありますが、</p>
<p><a href="https://oss.sios.com/security/general-security-20160504">general-security-20160504</a></p>
<p>段階的に試した所<br>以下コマンドでopenssl のバージョンアップをした所<br>エラーが消え B となりました。</p>
<p>事前にNginx を 1.11.1 にアップデートした為でしょうか汗</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># yum upgrade openssl -y</span><br><span class="line"></span><br><span class="line"># openssl version</span><br><span class="line">OpenSSL 1.0.1e-fips 11 Feb 2013</span><br></pre></td></tr></table></figure>

<ul>
<li>ssl_ciphers の設定変更</li>
</ul>
<p>config generator で 生成される ssl_ciphers ディレクティブをそのまま設定すると評価がB止まりでした。</p>
<p><a href="https://ssl-config.mozilla.org/">https://ssl-config.mozilla.org/</a></p>
<p>諸々含めたくない暗号化法があるようです。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssl_ciphers &#39;ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS&#39;;</span><br></pre></td></tr></table></figure>

<p><em>以下最終的に設定した ssl_ciphers</em> すると A+ に戻りました。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssl_ciphers &#39;ECDH !aNULL !eNULL !SSLv2 !SSLv3&#39;;</span><br></pre></td></tr></table></figure>

<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160627/20160627143218.png" width="100%">
</div>

<p>OpenSSLの脆弱性はチェックし続けていかねば</p>
<h2><span id="補足">補足</span></h2><p>HTTP Strict Transport Security を 有効化 (常時SSL) にしないと<br>A+ は取れません。</p>
<p>常時SSLはパフォーマンスにも影響するので<br>せめて A まで取る、という指針を決めてから着手してください。</p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/SSL/">SSL</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Gefällt Ihnen der Artikel? Unterstützen Sie den Autor mit</h3><div class="buttons is-centered"><a class="button is-danger donate" href="https://www.patreon.com/kenzo0107" target="_blank" rel="noopener"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2016/06/26/2016-06-27-each-table-mysql/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">MySQL テーブル単位の容量確認</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2016/06/26/2016-06-27-versionup-nginx/"><span class="level-item">Nginx 1.9.6 → 1.11.1 へバージョンアップ 脆弱性対応</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!-->