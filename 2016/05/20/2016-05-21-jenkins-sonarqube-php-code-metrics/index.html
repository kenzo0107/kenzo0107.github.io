<div class="card"><div class="card-image"><span class="image is-7by3"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521003213.png" alt="Jenkins + SonarQube で PHPコードメトリクス計測！"></span></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-05-20T15:00:00.000Z" title="2016-05-20T15:00:00.000Z">2016-05-21</time><span class="level-item">5分 read (About 696 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Jenkins + SonarQube で PHPコードメトリクス計測！</h1><div class="content"><h2><span id="前回">前回</span></h2><p>Jenkinsとは別のサーバ上に<br>SonarQube をインストールし<br>アクセスできるまでをまとめました。</p>
<a href="http://kenzo0107.hatenablog.com/entry/2016/05/19/192058" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="http://i.imgur.com/etIqshd.png"></div><div class="descriptions"><div class="og-title">CentOS7にSonarQubeをインストールしアクセス確認まで - 長生村本郷Engineers&#39;Blog</div><div class="og-description">概要 SonarQube™は Java, Python, Ruby, PHP等、複数言語のコードメトリクス集計ができる 優れものです。 以前 MacOSXローカル環境で Unityプロジェクト C#コードのコードメトリクス抽出方法をまとめました。 kenzo0107.hatena…</div></div></div></a>


<p>今回は Jenkins からソースを解析し<br>SonarQubeでのメトリクス情報を表示までの実行方法をまとめます。</p>
<p>言語は どれでも良いですが、 今回は PHP とします。</p>
<h2><span id="overview">Overview</span></h2><p>以下概要になります。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521003213.png" width="100%">
</div>

<h2><span id="sonarqube側事前準備">SonarQube側事前準備</span></h2><p>プロジェクトを作成しプロジェクトキーを発行します。</p>
<h3><span id="1-ログインページへアクセス">1. ログインページへアクセス</span></h3><p>http://<sonarqube ip>:9000/sessions/new</sonarqube></p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160520/20160520233944.png" width="100%">
</div>

<p>デフォルトでは以下 admin:admin アカウントでログイン</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>ID</td>
<td>admin</td>
</tr>
<tr>
<td>PW</td>
<td>admin</td>
</tr>
</tbody></table>
<h3><span id="2-プロジェクト作成">2. プロジェクト作成</span></h3><ul>
<li>ヘッダーメニュー Administration クリックし Administration ページへ遷移</li>
<li>Projects &gt; Management クリック</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160520/20160520234632.png" width="100%">
</div>

<ul>
<li>Create ボタンクリック</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160520/20160520235020.png" width="100%">
</div>

<ul>
<li>Name, Key 入力し</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521000020.png" width="100%">
</div>

<ul>
<li>プロジェクトが追加されたことがわかります。</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521001309.png" width="100%">
</div>

<h3><span id="3-php-plugin-インストール">3. PHP Plugin インストール</span></h3><ul>
<li>Administration ページ System &gt; Update Center クリック</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521002115.png" width="100%">
</div>

<ul>
<li>Available 選択 → 検索窓で「PHP」と入力 → 表示された PHP Plugin でInstallクリック</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521002430.png" width="100%">
</div>

<ul>
<li>Restart でSonarQubeに PHP Plugin インストール</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521002605.png" width="100%">
</div>

<ul>
<li>Installed タブで PHP Plugin がインストールされていることを確認</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521002918.png" width="100%">
</div>

<h3><span id="4-authentication-token-発行">4. authentication token 発行</span></h3><ul>
<li>Security &gt; User クリック</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521005252.png" width="100%">
</div>

<ul>
<li>TOKENS クリックしポップアップ表示</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521005424.png" width="100%">
</div>

<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521005757.png" width="100%">
</div>

<ul>
<li>任意の文字列を入力しcreate</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521005946.png" width="100%">
</div>

<ul>
<li>tokenコピー<br>Jenkins側の設定時に利用します。</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521010037.png" width="100%">
</div>

<p>以上でSonarQube側の事前準備は終了です。</p>
<h2><span id="jenkins-側準備">Jenkins 側準備</span></h2><h3><span id="1-sonarqube-plugin-インストール">1. SonarQube Plugin インストール</span></h3><p>Jenkinsの管理 &gt; Pluginの管理<br>にて SonarQube Plugin インストール</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521003400.png" width="100%">
</div>

<h3><span id="2-sonarqube-scanner-インストール">2. SonarQube Scanner インストール</span></h3><p>以下オフィシャルダウンロードページからリンク取得</p>
<p><a href="http://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner">Analyzing+with+SonarQube+Scanner</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /var/lib/jenkins</span><br><span class="line">$ wget https://sonarsource.bintray.com/Distribution/sonar-scanner-cli/sonar-scanner-2.6.1.zip</span><br><span class="line">$ unzip sonar-scanner-2.6.1.zip</span><br><span class="line">$ ln -s sonar-scanner-2.6.1 sonar-scanner</span><br></pre></td></tr></table></figure>

<h3><span id="3-jenkinsシステム設定">3. Jenkinsシステム設定</span></h3><ul>
<li><p>Jenkinsの管理 &gt; システムの設定 へアクセス</p>
</li>
<li><p>JenkinsQube servers に必要項目入力</p>
</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521004429.png" width="100%">
</div>

<ul>
<li>SonarQube Scanner に先ほどインストールした sonar-scannerパスを設定</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521004625.png" width="100%">
</div>

<p>上記入力後保存</p>
<h3><span id="4-ジョブ新規作成">4. ジョブ新規作成</span></h3><p>「sonarqubeTest」という名前のジョブを新規作成します。</p>
<ul>
<li>git リポジトリよりPHPプロジェクト取得設定</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521010200.png" width="100%">
</div>

<ul>
<li>SonarScanner 実行設定</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521010349.png" width="100%">
</div>

<p>以上でJenkins側の設定完了です。</p>
<h2><span id="sonarqube-反映確認">SonarQube 反映確認</span></h2><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160521/20160521010726.png" width="100%">
</div>


<p>ちなみにこちら EC-CUBE 1.1のプロジェクトでした。</p>
<p>EC-CUBEのコード重複率が多く<br>無駄が如何に多いかがわかります。</p>
<p>以上です。</p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/SonarQube/">SonarQube</a><a class="link-muted mr-2" rel="tag" href="/tags/PHP/">PHP</a><a class="link-muted mr-2" rel="tag" href="/tags/Jenkins/">Jenkins</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Gefällt Ihnen der Artikel? Unterstützen Sie den Autor mit</h3><div class="buttons is-centered"><a class="button is-danger donate" href="https://www.patreon.com/kenzo0107" target="_blank" rel="noopener"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2016/05/25/2016-05-26-ruby-30-sec-cooking-get-access-ip-from-japan/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">日本国内からアクセスされるIP取得スクリプト Ruby 30秒クッキング</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2016/05/19/2016-05-20-mysql-cannot-allocate-memory-for-the-buffer-pool/"><span class="level-item">MySQが落ちる トラブルシューティング Cannot allocate memory for the buffer pool</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!-->