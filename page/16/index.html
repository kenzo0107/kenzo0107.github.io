<!doctype html>
<html lang="ja"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>長生村本郷Engineers&#039;Blog</title><meta description="tech"><meta property="og:type" content="blog"><meta property="og:title" content="長生村本郷Engineers&#039;Blog"><meta property="og:url" content="https://kenzo0107.github.io/"><meta property="og:site_name" content="長生村本郷Engineers&#039;Blog"><meta property="og:description" content="tech"><meta property="og:locale" content="ja_JP"><meta property="og:image" content="https://kenzo0107.github.io/img/og_image.png"><meta property="article:author" content="Kenzo Tanaka"><meta property="article:tag" content="aws golang"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://kenzo0107.github.io"},"headline":"長生村本郷Engineers'Blog","image":["https://kenzo0107.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Kenzo Tanaka"},"description":"tech"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-162026478-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-162026478-1');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="長生村本郷Engineers&#039;Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/2013/12/31/PrivacyPolicy/">PrivacyPolicy</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/kenzo0107"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-02-03T15:00:00.000Z" title="2016-02-03T15:00:00.000Z">2016-02-04</time><span class="level-item">4分 read (About 661 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/02/03/2016-02-04-no-ip-aws-instance-dynamic-ip/">no-ipでAWSインスタンスの動的ip更新対応 ~いつも同じドメイン名でアクセスしたい~</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>AWSの起動停止をするとElasticIPを設定していない限り<br>Public IPが変更されてしまいます。</p>
<p>ElasticIPは設定するとAWSを停止していても費用が発生します。</p>
<p>検証用環境など一時的に利用するインスタンスについて<br>起動時にIPが変更したことを関係者に周知するなどの手間が掛かります。</p>
<p>その為No-IPを利用しドメインを固定しIP変更に対応するようにしました。</p>
<p>No-IPは無料のドメインサービスで動的IP変更を検知するLinux用モジュールも配布しています。</p>
<h2><span id="環境">環境</span></h2><ul>
<li>Amazon Linux AMI release 2015.09</li>
<li>noip 2.1.9</li>
</ul>
<h2><span id="手順">手順</span></h2><p>まずnoipサイトで会員登録し利用したいドメインを登録します。<br>ipはとりあえず適当で良いです。</p>
<p><a href="http://www.noip.com/">http://www.noip.com/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; rootユーザで実行</span><br><span class="line">$ sudo su</span><br><span class="line"># cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; noipモジュール</span><br><span class="line"># wget http:&#x2F;&#x2F;www.no-ip.com&#x2F;client&#x2F;linux&#x2F;noip-duc-linux.tar.gz</span><br><span class="line"># tar xzf noip-duc-linux.tar.gz</span><br><span class="line"># cd noip-2.1.9</span><br><span class="line"># make</span><br><span class="line"># make install</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 起動スクリプト作成</span><br><span class="line"># cp redhat.noip.sh &#x2F;etc&#x2F;init.d&#x2F;noip</span><br><span class="line"># chmod 755 &#x2F;etc&#x2F;init.d&#x2F;noip</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 起動設定</span><br><span class="line"># &#x2F;sbin&#x2F;chkconfig noip on</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 起動</span><br><span class="line"># &#x2F;etc&#x2F;init.d&#x2F;noip start</span><br></pre></td></tr></table></figure>

<p>起動後、no-ipのコンソール上で指定ドメインのIPが<br>1分もしない程度で切り替わっていることが確認できます。</p>
<h2><span id="今後">今後</span></h2><p>No-IPはMicroSoftによりマルウェアの温床となっておりユーザを保護すべく<br>22のNO-IPドメイン差し止めを連邦裁判所に申し立て、受理されましたが</p>
<p>No-IP側としては相談していただければ対応もできた、とし申し立て後<br>対応し随時ドメインの復活を果たしています。</p>
<p>ある程度セキュリティを加味して利用する必要がありますね。<br>今の所、AWSのセキュリティグループで特に外部アクセスはなく<br>問題なく動作しています。</p>
<p>また、<br>以下のようなGREEさんの記事がありました。</p>
<p><a href="https://labs.gree.jp/blog/2016/02/15825/">AWS EC2 での最強の Public IP 取得方法</a></p>
<p>内部関係者に聞いてみたいと思います。</p>
<p>===追記===</p>
<p>GREEさんの記事の件、内部関係者に聞いた所ubuntuのみで利用しているそうです。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/02/02/2016-02-03-buildscript-for-revel-go/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160203/20160203221206.png" alt="CentOS7用 Revel(Golang)フレームワークの起動スクリプト 書いてみた。"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-02-02T15:00:00.000Z" title="2016-02-02T15:00:00.000Z">2016-02-03</time><span class="level-item"><a class="link-muted" href="/categories/Go/">Go</a></span><span class="level-item">4分 read (About 626 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/02/02/2016-02-03-buildscript-for-revel-go/">CentOS7用 Revel(Golang)フレームワークの起動スクリプト 書いてみた。</a></h1><div class="content"><h2><span id="起動スクリプト作成">起動スクリプト作成</span></h2><p>まず成果物から</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;revel.service</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description&#x3D;RevelBuildScript</span><br><span class="line">After&#x3D;nginx.service mysqld.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type&#x3D;simple</span><br><span class="line">ExecStart&#x3D;&#x2F;bin&#x2F;bash &#x2F;var&#x2F;golang&#x2F;run.sh</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>

<p>※After … 上記では nginx と mysqld 起動後に revelを起動させるという設定です。</p>
<p>※ExecStart … <code>/bin/bash /var/golang/run.sh</code> については<br>以前の記事でローカルビルドによる<br>デプロイ方法を採用しているというお話をしましたが<br>その際に作成される <code>run.sh</code> のパスを指しています。</p>
<a href="https://kenzo0107.hatenablog.com/entry/2015/08/21/013757" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://ogimage.blog.st-hatena.com/12921228815725257333/8454420450106339592/1479431121"></div><div class="descriptions"><div class="og-title">Golang Revelフレームワーク ホットデプロイ方法 - 長生村本郷Engineers&#39;Blog</div><div class="og-description">概要 Revel Officialサイトにあるデプロイ方法を検証しました。 Revel Deployment ローカルでアプリをビルドしサーバにコピーする サーバーで更新したコードをpullし、ビルド・起動する Heroku を利用しデプロイ管理する 1. ローカルビルド # ア…</div></div></div></a>


<h4><span id="起動設定">起動設定</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable revel.service</span><br></pre></td></tr></table></figure>

<h4><span id="起動">起動</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl start revel.service</span><br></pre></td></tr></table></figure>

<h4><span id="停止">停止</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl start revel.service</span><br></pre></td></tr></table></figure>

<p>以上です。</p>
<h2><span id="導入経緯">導入経緯</span></h2><p>AWSでの運用をしていると検証環境は<br>検証時のみに利用し余計なコストは掛けたくないものです。</p>
<p>なので、しょっ中、起動・停止を繰り返します。</p>
<p>Revelフレームワークは起動スクリプトが標準装備されていない為<br>インスタンス起動時に手動で起動する手間が発生していました。</p>
<p>その為、デザインの修正でもシステムさんお願いします〜というような依頼があり<br>相互に手間が発生していたのでその解決として作成しました。</p>
<p>現在は Slack経由で hubot から Jenkins ジョブを実行させ<br>Revelの乗ってるAWSインスタンスの起動・停止できるようにしています。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160203/20160203220906.png" width="100%">
</div>

<p>ipもElasticIPは使用せず、No-IPを利用してPublic IPが変更されても<br>同ドメインでアクセスできるようにしています。</p>
<p>こちらもインスタンス起動時にドメイン管理しているNo-ipへPublic IPを通知し<br>動的にドメインとIPを紐付けるようにしています。</p>
<a href="http://kenzo0107.hatenablog.com/entry/2016/02/04/101002" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://ogimage.blog.st-hatena.com/12921228815725257333/6653586347155942318/1463368963"></div><div class="descriptions"><div class="og-title">no-ipでAWSインスタンスの動的ip更新対応 ~いつも同じドメイン名でアクセスしたい~ - 長生村本郷Engineers&#39;Blog</div><div class="og-description">概要 AWSの起動停止をするとElasticIPを設定していない限り Public IPが変更されてしまいます。 ElasticIPは設定するとAWSを停止していても費用が発生します。 検証用環境など一時的に利用するインスタンスについて 起動時にIPが変更したことを関係者に周知す…</div></div></div></a>




<p><a href="http://www.noip.com/">http://www.noip.com/</a></p>
<p>極力費用を抑えた、AWSにおける検証環境構築の参考にもしていただければと思います。</p>
<p>以上です。</p>
<p>※ 検証環境 はローカル開発環境と異なり、あくまで本番デプロイ前の検証用という認識です。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-01-18T15:00:00.000Z" title="2016-01-18T15:00:00.000Z">2016-01-19</time><span class="level-item">数秒 read (About 96 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/01/18/2016-01-19-mysqldump-couldnt-execute-flush-tables-access-denied/">MySQLトラブルシューティング - mysqldump: Couldn&#039;t execute &#039;FLUSH TABLES&#039;: Access denied; you need (at least one of) the RELOAD privilege(s) for this operation (1227)</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>以下のように mysqldump コマンド実行時に掲題のエラーが発生しました。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mysqldump --lock-all-tables --events -h &lt;host_name&gt; -u &lt;user&gt; -p&lt;password&gt; --no-create-info &lt;db_name&gt; &lt;table, ...&gt; &gt; output.sql</span><br><span class="line"></span><br><span class="line">mysqldump: Couldn<span class="string">'t execute '</span>FLUSH TABLES<span class="string">': Access denied; you need (at least one of) the RELOAD privilege(s) for this operation (1227)</span></span><br></pre></td></tr></table></figure>

<h2><span id="対策">対策</span></h2><p>エラー文の通り、RELOAD権限を付与する。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; GRANT RELOAD ON *.* TO <span class="string">'&lt;user&gt;'</span>@<span class="string">'&lt;host_name&gt;'</span>;</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<p>以上</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-01-14T15:00:00.000Z" title="2016-01-14T15:00:00.000Z">2016-01-15</time><span class="level-item">3分 read (About 390 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/01/14/2016-01-15-mysql-error-1045-28000-access-denied-for-user/">MySQLトラブルシューティング - ERROR 1045 (28000): Access denied for user &#039;root&#039;@&#039;localhost&#039; (using password: NO)</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>ローカルでMacOSXでMAMPを使っていてある日誤った操作により以下のようなエラーが発生した為<br>対応まとめました。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root</span><br><span class="line">ERROR 1045 (28000): Access denied for user &#39;root&#39;@&#39;localhost&#39; (using password: NO)</span><br></pre></td></tr></table></figure>

<p>ローカル環境でrootユーザのアクセス権を誤って削除してしまったときなどに発生します。</p>
<h2><span id="対策">対策</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; mysql停止</span><br><span class="line">$ service mysqld stop</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; rootユーザのアクセス権限が失われている</span><br><span class="line">&#x2F;&#x2F; → テーブル権限をスキップ(無視)して作業するオプション付きでセーフモードでmysql起動</span><br><span class="line">$ mysqld_safe --skip-grant-tables &amp;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; rootユーザでアクセス</span><br><span class="line">$ mysql -u root</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 現状の権限設定テーブルを空にする</span><br><span class="line">mysql&gt; TRUNCATE TABLE mysql.user;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 権限反映</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; rootユーザにlocalhostの全DBアクセス権限付与</span><br><span class="line">mysql&gt; GRANT ALL PRIVILEGES on *.* to root@localhost IDENTIFIED BY &#39;(root&#39;s password)&#39; WITH GRANT OPTION;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 権限反映</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 権限設定確認</span><br><span class="line">mysql&gt; SELECT host, user FROM mysql.user;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; mysql CLIモード停止 (Ctl+c)でもOK</span><br><span class="line">mysql&gt; quit;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; safe modeで起動させたmysql 関連psをkillする</span><br><span class="line">$ ps aux | grep mysql | grep -v grep | awk &#39;&#123;print &quot;kill -9&quot;, $2&#125;&#39;|sh</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; mysql 起動</span><br><span class="line">$ service mysqld start</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; rootユーザでmysqlアクセス</span><br><span class="line">$ mysql -u root -p(root&#39;s password)</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>rootユーザに権限が失われお手上げ状態になったとき、困ったときに <code>safe_mode</code> 使えます。</p>
<p>以上</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2016-01-12T15:00:00.000Z" title="2016-01-12T15:00:00.000Z">2016-01-13</time><span class="level-item">6分 read (About 922 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/01/12/2016-01-13-hubot-slack-on-amazonlinux/">Hubot + Slack on Amazon Linux</a></h1><div class="content"><h2><span id="prerequisite">Prerequisite</span></h2><ul>
<li>Amazon Linux AMI 2015.09.1 (HVM), SSD Volume Type(t2.nano)</li>
<li>npm 1.3.6</li>
<li>hubot 2.17.0</li>
<li>coffeescript 1.10.0</li>
</ul>
<p>I use t2.nano released at December 2015.</p>
<h2><span id="first-to-do">first to do.</span></h2><ul>
<li>summarized in the following site.</li>
</ul>
<p><a href="http://qiita.com/yangci/items/ef2ab9b6f0d28bad0881">AWS EC2 Amazon Linuxインスタンス起動後、最初にやることまとめ</a></p>
<h2><span id="install-npm">Install npm</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install -y npm --enablerepo&#x3D;epel</span><br><span class="line"></span><br><span class="line">$ npm -v</span><br><span class="line">1.3.6</span><br></pre></td></tr></table></figure>

<h2><span id="install-hubot-coffee-script-yo-generator-hubot">Install hubot, coffee-script, yo, generator-hubot</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo npm install -g hubot coffee-script yo generator-hubot</span><br><span class="line"></span><br><span class="line">$ hubot -v</span><br><span class="line">2.17.0</span><br><span class="line"></span><br><span class="line">$ coffee -v</span><br><span class="line">CoffeeScript version 1.10.0</span><br></pre></td></tr></table></figure>

<h2><span id="create-hubot">create hubot</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir mybot</span><br><span class="line">$ cd mybot</span><br><span class="line">$ yo hubot</span><br><span class="line"></span><br><span class="line">? &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">We&#39;re constantly looking for ways to make yo better!</span><br><span class="line">May we anonymously report usage statistics to improve the tool over time?</span><br><span class="line">More info: https:&#x2F;&#x2F;github.com&#x2F;yeoman&#x2F;insight &amp; http:&#x2F;&#x2F;yeoman.io</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; (Y&#x2F;n) n</span><br><span class="line">                     _____________________________</span><br><span class="line">                    &#x2F;                             \</span><br><span class="line">   &#x2F;&#x2F;\              |      Extracting input for    |</span><br><span class="line">  &#x2F;&#x2F;&#x2F;&#x2F;\    _____    |   self-replication process   |</span><br><span class="line"> &#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;\  &#x2F;_____\   \                             &#x2F;</span><br><span class="line"> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; |[^_&#x2F;\_]|   &#x2F;----------------------------</span><br><span class="line">  |   | _|___@@__|__</span><br><span class="line">  +&#x3D;&#x3D;&#x3D;+&#x2F;  &#x2F;&#x2F;&#x2F;     \_\</span><br><span class="line">   | |_\ &#x2F;&#x2F;&#x2F; HUBOT&#x2F;\\</span><br><span class="line">   |___&#x2F;\&#x2F;&#x2F;      &#x2F;  \\</span><br><span class="line">         \      &#x2F;   +---+</span><br><span class="line">          \____&#x2F;    |   |</span><br><span class="line">           | &#x2F;&#x2F;|    +&#x3D;&#x3D;&#x3D;+</span><br><span class="line">            \&#x2F;&#x2F;      |xx|</span><br><span class="line"></span><br><span class="line">? Owner (User &lt;user@example.com&gt;) tech@xxxxxxxx.jp</span><br><span class="line">? Bot name (mybot) hubot</span><br><span class="line">? Description xxxxxxx&#39;s hubot</span><br><span class="line">? Bot adapter slack</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">hubot-maps@0.0.2 node_modules&#x2F;hubot-maps</span><br><span class="line"></span><br><span class="line">$ ls</span><br><span class="line">Procfile   bin                    hubot-scripts.json  package.json</span><br><span class="line">README.md  external-scripts.json  node_modules        scripts</span><br></pre></td></tr></table></figure>

<h3><span id="こんなエラーが出たときは">こんなエラーが出たときは</span></h3><p>/root/.config へのアクセス権限がないと言われています。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Error: EACCES, permission denied &#39;&#x2F;root&#x2F;.config&#39;</span><br><span class="line">    at Object.fs.mkdirSync (fs.js:654:18)</span><br><span class="line">    at sync (&#x2F;usr&#x2F;lib&#x2F;node_modules&#x2F;yo&#x2F;node_modules&#x2F;configstore&#x2F;node_modules&#x2F;mkdirp&#x2F;index.js:71:13)</span><br><span class="line">    at Function.sync (&#x2F;usr&#x2F;lib&#x2F;node_modules&#x2F;yo&#x2F;node_modules&#x2F;configstore&#x2F;node_modules&#x2F;mkdirp&#x2F;index.js:77:24)</span><br><span class="line">    at Object.create.all.get (&#x2F;usr&#x2F;lib&#x2F;node_modules&#x2F;yo&#x2F;node_modules&#x2F;configstore&#x2F;index.js:38:13)</span><br><span class="line">    at Object.Configstore (&#x2F;usr&#x2F;lib&#x2F;node_modules&#x2F;yo&#x2F;node_modules&#x2F;configstore&#x2F;index.js:27:44)</span><br><span class="line">    at new Insight (&#x2F;usr&#x2F;lib&#x2F;node_modules&#x2F;yo&#x2F;node_modules&#x2F;insight&#x2F;lib&#x2F;index.js:37:34)</span><br><span class="line">    at Object.&lt;anonymous&gt; (&#x2F;usr&#x2F;lib&#x2F;node_modules&#x2F;yo&#x2F;lib&#x2F;cli.js:156:11)</span><br><span class="line">    at Module._compile (module.js:456:26)</span><br><span class="line">    at Object.Module._extensions..js (module.js:474:10)</span><br><span class="line">    at Module.load (module.js:356:32)</span><br></pre></td></tr></table></figure>

<ul>
<li>全権限付与</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mkdir &#x2F;root&#x2F;.config</span><br><span class="line"># chmod -R 0777 &#x2F;root&#x2F;.config</span><br></pre></td></tr></table></figure>

<p>上記で問題なくyo コマンドが通りました。ほっ(-o-)</p>
<ul>
<li>Initial setting hubot.</li>
</ul>
<table>
<thead>
<tr>
<th><em>Item</em></th>
<th><em>Value</em></th>
</tr>
</thead>
<tbody><tr>
<td>Owner</td>
<td>E-mail address</td>
</tr>
<tr>
<td>Bot name</td>
<td>same the hubot integrated slack</td>
</tr>
<tr>
<td>Descriiption</td>
<td>-</td>
</tr>
<tr>
<td>Bot adapter</td>
<td>slack</td>
</tr>
</tbody></table>
<p><img src="http://i.imgur.com/AdyvxbZ.png" alt="Imgur"></p>
<h2><span id="install-hubot-slack">Install hubot-slack</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo npm install hubot-slack --save</span><br></pre></td></tr></table></figure>

<h2><span id="modify-external-scriptsjson">modify external-scripts.json</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ echo &#39;[]&#39; &gt; external-scripts.json</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; confirm setting.</span><br><span class="line">$ cat external-scripts.json</span><br><span class="line">[]</span><br></pre></td></tr></table></figure>

<h2><span id="add-to-binhubot">Add to bin/hubot</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim bin&#x2F;hubot</span><br></pre></td></tr></table></figure>

<ul>
<li>run hubot via port 80</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line"></span><br><span class="line">set -e</span><br><span class="line"></span><br><span class="line">npm install</span><br><span class="line">export PATH&#x3D;&quot;node_modules&#x2F;.bin:node_modules&#x2F;hubot&#x2F;node_modules&#x2F;.bin:$PATH&quot;</span><br><span class="line"></span><br><span class="line"># add start</span><br><span class="line">export HUBOT_SLACK_TOKEN&#x3D;xoxb-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><br><span class="line">export PORT&#x3D;80</span><br><span class="line"># add end</span><br><span class="line"></span><br><span class="line">exec node_modules&#x2F;.bin&#x2F;hubot --name &quot;hubot&quot; &quot;$@&quot;</span><br></pre></td></tr></table></figure>

<h2><span id="creat-hubot-script">creat hubot script</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim scripts&#x2F;hello.coffee</span><br></pre></td></tr></table></figure>

<p>save the belowing scripts as scripts/hello.coffee</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># Description:</span><br><span class="line">#   hubot basic command.</span><br><span class="line">#</span><br><span class="line"># Commands:</span><br><span class="line">#   hubot who are you - I&#39;m hubot!</span><br><span class="line">#   hubot hello</span><br><span class="line">#   hubot who am I - You are &lt;user_name&gt;</span><br><span class="line">#   hubot what is this &lt;*&gt; - This is &lt;$1&gt;</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; (robot) -&gt;</span><br><span class="line">  robot.respond &#x2F;who are you&#x2F;i, (msg) -&gt;</span><br><span class="line">    msg.send &quot;I&#39;m hubot!&quot;</span><br><span class="line"></span><br><span class="line">  robot.hear &#x2F;HELLO$&#x2F;i, (msg) -&gt;</span><br><span class="line">    msg.send &quot;hello!&quot;</span><br><span class="line"></span><br><span class="line">  robot.respond &#x2F;who am I&#x2F;i, (msg) -&gt;</span><br><span class="line">    msg.send &quot;You are #&#123;msg.message.user.name&#125;&quot;</span><br><span class="line"></span><br><span class="line">  robot.respond &#x2F;what is this (.*)&#x2F;i, (msg) -&gt;</span><br><span class="line">    msg.send &quot;This is #&#123;msg.match[1]&#125;&quot;</span><br></pre></td></tr></table></figure>

<h2><span id="run-hubot">run hubot</span></h2><p><code>sudo</code> is required and in order to access http port.<br>You will require hubot integrated with outside site - ex) JIRA etc…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo bin&#x2F;hubot -a slack</span><br><span class="line"></span><br><span class="line">[Wed Jan 13 2016 13:43:08 GMT+0900 (JST)] INFO Connecting...</span><br><span class="line">[Wed Jan 13 2016 13:43:10 GMT+0900 (JST)] INFO Logged in as hubot of RUBY GROUPE, but not yet connected</span><br><span class="line">[Wed Jan 13 2016 13:43:11 GMT+0900 (JST)] INFO Slack client now connected</span><br></pre></td></tr></table></figure>

<ul>
<li>no sudo execution result …(&gt;_&lt;)<br>Error occured!!</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ bin&#x2F;hubot -a slack</span><br><span class="line"></span><br><span class="line">[Wed Jan 13 2016 16:40:59 GMT+0900 (JST)] INFO Connecting...</span><br><span class="line">[Wed Jan 13 2016 16:40:59 GMT+0900 (JST)] ERROR Error: listen EACCES</span><br><span class="line">  at errnoException (net.js:905:11)</span><br><span class="line">  at Server._listen2 (net.js:1024:19)</span><br><span class="line">  at listen (net.js:1065:10)</span><br><span class="line">  at net.js:1147:9</span><br><span class="line">  at dns.js:72:18</span><br><span class="line">  at process._tickCallback (node.js:442:13)</span><br><span class="line"></span><br><span class="line">[Wed Jan 13 2016 16:41:00 GMT+0900 (JST)] INFO Logged in as hubot of RUBY GROUPE, but not yet connected</span><br><span class="line">[Wed Jan 13 2016 16:41:02 GMT+0900 (JST)] INFO Slack client now connected</span><br></pre></td></tr></table></figure>

<h2><span id="invite-hubot-at-slack">Invite hubot at Slack</span></h2><p>ex) botname=hubot</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;invite @hubot</span><br></pre></td></tr></table></figure>

<p><img src="http://i.imgur.com/v3MK8VL.png" alt="Imgur"></p>
<h2><span id="input-text-at-slack">Input text at Slack</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[me]    hubot hello</span><br><span class="line">[hubot] hello!</span><br></pre></td></tr></table></figure>

<p><img src="http://i.imgur.com/in4XiYj.png" alt="Imgur"></p>
<hr>
<h1><span id="daemonize-hubot">daemonize hubot</span></h1><h2><span id="install-forever">Install forever</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo npm install --save forever</span><br><span class="line"></span><br><span class="line">$ forever --version</span><br><span class="line">v0.15.1</span><br></pre></td></tr></table></figure>

<h2><span id="set-path-as-not-root-user">set path as not root user.</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ echo &#39;export PATH&#x3D;$PATH:&#x2F;home&#x2F;&lt;user&gt;&#x2F;mybot&#x2F;node_modules&#x2F;forever&#x2F;bin&#39; &gt;&gt; ~&#x2F;.bashrc</span><br><span class="line">$ source ~&#x2F;.bashrc</span><br></pre></td></tr></table></figure>

<ul>
<li>root user too.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; change to super user.</span><br><span class="line">$ sudo su</span><br><span class="line"># echo &#39;export PATH&#x3D;$PATH:&#x2F;home&#x2F;&lt;user&gt;&#x2F;mybot&#x2F;node_modules&#x2F;forever&#x2F;bin&#39; &gt;&gt; ~&#x2F;.bashrc</span><br><span class="line"># source ~&#x2F;.bashrc</span><br><span class="line"># echo $PATH</span><br><span class="line">.......:&#x2F;home&#x2F;&lt;user&gt;&#x2F;mybot&#x2F;node_modules&#x2F;forever&#x2F;bin:......</span><br></pre></td></tr></table></figure>

<h2><span id="modify-binhubot">Modify bin/hubot</span></h2><script src="//gist.github.com/kenzo0107/c6c713835918c3a75159.js"></script>



<h2><span id="daemonize-start-hubot-sudo-binhubot-a-slack">daemonize start hubot - <code>sudo bin/hubot -a slack</code></span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo bin&#x2F;hubot start</span><br></pre></td></tr></table></figure>

<h2><span id="stop-daemonized-hubot">stop daemonized hubot</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo bin&#x2F;hubot stop</span><br></pre></td></tr></table></figure>

<h2><span id="restart-hubot">restart hubot</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo bin&#x2F;hubot restart</span><br></pre></td></tr></table></figure>

<h2><span id="check-forever-list">check forever list</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo su</span><br><span class="line"># forever list</span><br><span class="line"></span><br><span class="line">info:    Forever processes running</span><br><span class="line">data:        uid  command script                           forever pid   id logfile                 uptime</span><br><span class="line">data:    [0] sICk coffee  node_modules&#x2F;.bin&#x2F;hubot -a slack 30494   30496    &#x2F;root&#x2F;.forever&#x2F;sICk.log 0:0:5:35.399</span><br></pre></td></tr></table></figure>

<h2><span id="another-way-stop-forever-process">another way stop forever process</span></h2><ul>
<li>check process. kill -9 process</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ps aux | grep hubot | grep -v grep</span><br><span class="line"></span><br><span class="line">root     31144  0.3  3.1 723820 32392 ?        Ssl  17:58   0:00 &#x2F;usr&#x2F;bin&#x2F;node &#x2F;home&#x2F;hu&#x2F;mybot&#x2F;node_modules&#x2F;forever&#x2F;bin&#x2F;monitor node_modules&#x2F;.bin&#x2F;hubot</span><br><span class="line">root     31146  1.1  6.7 979588 69196 ?        Sl   17:58   0:00 node node_modules&#x2F;hubot&#x2F;node_modules&#x2F;.bin&#x2F;coffee &#x2F;home&#x2F;hu&#x2F;mybot&#x2F;node_modules&#x2F;.bin&#x2F;hubot -a slack</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; kill forcibly process</span><br><span class="line">$ sudo kill -9 31146</span><br></pre></td></tr></table></figure>

<ul>
<li>another one.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ps aux | grep hubot | grep -v grep | awk &#39;&#123;print &quot;kill -9&quot;, $2&#125;&#39; | sh</span><br></pre></td></tr></table></figure>

<p>Thanks.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-12-30T15:00:00.000Z" title="2015-12-30T15:00:00.000Z">2015-12-31</time><span class="level-item">4分 read (About 644 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/12/30/2015-12-31-pod-install-assersion/">pod install で ASSERSION対策</a></h1><div class="content"><p>pod install で ASSERSION対策</p>
<h2><span id="概要">概要</span></h2><p><code>pod install</code> 実行時に正常にインストール処理ができなかったのでメモ。</p>
<p>冬休み中にSwift2.0をほんきで学ぶ為、以下書籍購入してチャレンジ。</p>
<a href="https://www.amazon.co.jp/exec/obidos/ASIN/4798142352/kenzo0107-22/" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img></div><div class="descriptions"><div class="og-title">ほんきで学ぶSwift+iOSアプリ開発入門 Swift2, Xcode7, iOS9対応 | 加藤 勝也 |本 | 通販 | Amazon</div><div class="og-description">Amazonで加藤 勝也のほんきで学ぶSwift+iOSアプリ開発入門 Swift2, Xcode7, iOS9対応。アマゾンならポイント還元本が多数。加藤 勝也作品ほか、お急ぎ便対象商品は当日お届けも可能。またほんきで学ぶSwift+iOSアプリ開発入門 Swift2, Xco…</div></div></div></a>


<p>これの LESSON 31 でCocoaPodsインストール手順がありますが<br>その通りに進めた際にエラー発生したので対策をまとめました。</p>
<p>この手のエラーは環境依存が主ですし、<br>書籍の執筆時も技術は日進月歩進んでおりますので書籍を責めず<br>CocoaPodsオフィシャルサイトやStackOverFlowなどで情報探ってみるのが<br>精神衛生上も良いかもしれないです。</p>
<h2><span id="環境情報">環境情報</span></h2><ul>
<li>Xcode 7.2 (7C68)</li>
<li>ruby 2.0.0p645</li>
<li>gem 2.5.0</li>
</ul>
<h2><span id="書籍に記載されているコマンド">書籍に記載されているコマンド</span></h2><h3><span id="cocoapodsインストール">CocoaPodsインストール</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo gem install -n &#x2F;usr&#x2F;local&#x2F;bin cocoa pods</span><br></pre></td></tr></table></figure>

<h3><span id="エラー内容">エラー内容</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ pod install</span><br><span class="line">[!] Unable to load a specification for the plugin &#96;&#x2F;opt&#x2F;homebrew-cask&#x2F;Caskroom&#x2F;cocoapods&#x2F;0.37.0&#x2F;CocoaPods.app&#x2F;Contents&#x2F;Resources&#x2F;bundle&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;2.2.0&#x2F;gems&#x2F;cocoapods-plugins-install-0.0.1&#96;</span><br><span class="line">Analyzing dependencies</span><br><span class="line"></span><br><span class="line">CocoaPods 1.0.0.beta.1 is available.</span><br><span class="line">To update use: &#96;sudo gem install cocoapods --pre&#96;</span><br><span class="line">[!] This is a test version we&#39;d love you to try.</span><br><span class="line"></span><br><span class="line">For more information see http:&#x2F;&#x2F;blog.cocoapods.org</span><br><span class="line">and the CHANGELOG for this version http:&#x2F;&#x2F;git.io&#x2F;BaH8pQ.</span><br><span class="line"></span><br><span class="line">Downloading dependencies</span><br><span class="line">Installing Realm (0.97.0)</span><br><span class="line">Installing RealmSwift (0.97.0)</span><br><span class="line">Generating Pods project</span><br><span class="line">2015-12-31 10:51:38.680 ruby[6275:47591] [MT] DVTAssertions: ASSERTION FAILURE in &#x2F;Library&#x2F;Caches&#x2F;com.apple.xbs&#x2F;Sources&#x2F;IDEFrameworks&#x2F;IDEFrameworks-9548&#x2F;IDEFoundation&#x2F;Initialization&#x2F;IDEInitialization.m:590</span><br><span class="line">Details:  Assertion failed: _initializationCompletedSuccessfully</span><br><span class="line">Function: BOOL IDEIsInitializedForUserInteraction()</span><br><span class="line">Thread:   &lt;NSThread: 0x7fc66d067980&gt;&#123;number &#x3D; 1, name &#x3D; main&#125;</span><br><span class="line">Hints: None</span><br><span class="line">Backtrace:</span><br><span class="line">  0  0x000000010e001f7f -[DVTAssertionHandler handleFailureInFunction:fileName:lineNumber:assertionSignature:messageFormat:arguments:] (in DVTFoundation)</span><br><span class="line">  1  0x000000010e00170c _DVTAssertionHandler (in DVTFoundation)</span><br><span class="line">  2  0x000000010e001978 _DVTAssertionFailureHandler (in DVTFoundation)</span><br><span class="line">  3  0x000000010e0018da _DVTAssertionFailureHandler (in DVTFoundation)</span><br><span class="line">  4  0x0000000110e5154d IDEIsInitializedForUserInteraction (in IDEFoundation)</span><br><span class="line">  5  0x000000011393a631 +[PBXProject projectWithFile:errorHandler:readOnly:] (in DevToolsCore)</span><br><span class="line">  6  0x000000011393c1b6 +[PBXProject projectWithFile:errorHandler:] (in DevToolsCore)</span><br><span class="line">  7  0x00007fff93b2af14 ffi_call_unix64 (in libffi.dylib)</span><br><span class="line">zsh: abort      pod install</span><br></pre></td></tr></table></figure>

<h2><span id="対策">対策</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 既にインストール済みのCocoaPodsをアンインストールする</span><br><span class="line">$ sudo gem uninstall cocoapods</span><br><span class="line"></span><br><span class="line"># 再度 &#96;cocoapods&#96; をインストールする。</span><br><span class="line">$ sudo gem install  -n &#x2F;usr&#x2F;local&#x2F;bin cocoapods</span><br></pre></td></tr></table></figure>

<h2><span id="実行確認">実行確認</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$  pod install</span><br><span class="line">Updating local specs repositories</span><br><span class="line"></span><br><span class="line">CocoaPods 1.0.0.beta.1 is available.</span><br><span class="line">To update use: &#96;gem install cocoapods --pre&#96;</span><br><span class="line">[!] This is a test version we&#39;d love you to try.</span><br><span class="line"></span><br><span class="line">For more information see http:&#x2F;&#x2F;blog.cocoapods.org</span><br><span class="line">and the CHANGELOG for this version http:&#x2F;&#x2F;git.io&#x2F;BaH8pQ.</span><br><span class="line"></span><br><span class="line">Analyzing dependencies</span><br><span class="line">Downloading dependencies</span><br><span class="line">Installing Realm (0.97.0)</span><br><span class="line">Installing RealmSwift (0.97.0)</span><br><span class="line">Generating Pods project</span><br><span class="line">Integrating client project</span><br><span class="line"></span><br><span class="line">[!] Please close any current Xcode sessions and use &#96;Chapter6.xcworkspace&#96; for this project from now on.</span><br><span class="line">Sending stats</span><br><span class="line">Pod installation complete! There is 1 dependency from the Podfile and 2 total pods</span><br><span class="line">installed.</span><br><span class="line"></span><br><span class="line">~&#x2F;honki_swift&#x2F;Chapter6&#x2F;LESSON31&#x2F;before&#x2F;Chapter6</span><br></pre></td></tr></table></figure>

<p>無事、 .xcworkspace, Podfile.lock, Pods が作成されました。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[~&#x2F;honki_swift&#x2F;Chapter6&#x2F;LESSON31&#x2F;before&#x2F;Chapter6]$ tree -L 1</span><br><span class="line">.</span><br><span class="line">├── Chapter6</span><br><span class="line">├── Chapter6.xcodeproj</span><br><span class="line">├── Chapter6.xcworkspace</span><br><span class="line">├── Podfile</span><br><span class="line">├── Podfile.lock</span><br><span class="line">└── Pods</span><br></pre></td></tr></table></figure>

<p>以上です。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-12-25T15:00:00.000Z" title="2015-12-25T15:00:00.000Z">2015-12-26</time><span class="level-item">28分 read (About 4172 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/12/25/2015-12-26-aws-multi-az-pacemaker-corosync-switching-eip/">AWS Multi-AZにおける Pacemaker + Corosync による Elastic IP の付け替え</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>Pacemaker &amp; Corosync による<br>AWS での Multi-AZ 間のEIP付け替えによる<br>フェイルオーバーについて実装したのでまとめます。</p>
<p>以下イメージです。</p>
<ul>
<li>通常状態</li>
</ul>
<p><img src="http://i.imgur.com/QBvFhti.png" alt="Normal"></p>
<ul>
<li>Avalavility Zone A に配置された Instance A で障害が発生した場合<br>Avalavility Zone B に配置された Instance B に EIPを付け替え</li>
</ul>
<p><img src="http://i.imgur.com/xoJ3h8s.png?1" alt="Accident occured"></p>
<h2><span id="todo">ToDo</span></h2><ul>
<li>VPC, Subnet 設定</li>
<li>Pacemaker &amp; Corosync インストール / 設定</li>
<li>Cluster 構築</li>
<li>EIP付け替えスクリプト作成</li>
<li>フェイルオーバー試験</li>
</ul>
<h2><span id="環境">環境</span></h2><ul>
<li>CentOS 7 (x86_64) with Updates HVM (t2.micro)<br>※ 検証用の為、 t2.microで実施しています。</li>
</ul>
<h2><span id="vpc-subnet-構築">VPC, Subnet 構築</span></h2><p>以下記事にて非常によくまとめて頂いているので参考にしていただき<br>この設定を以降そのまま利用します。</p>
<p><a href="http://qiita.com/hiroshik1985/items/9de2dd02c9c2f6911f3b">0から始めるAWS入門①：VPC編</a></p>
<h5><span id="念のため-以下-vpc-subnet-設定です">念のため、以下 VPC, Subnet 設定です。</span></h5><ul>
<li>VPC 設定</li>
</ul>
<table>
<thead>
<tr>
<th><em>項目</em></th>
<th><em>値</em></th>
</tr>
</thead>
<tbody><tr>
<td>Name tag</td>
<td>任意</td>
</tr>
<tr>
<td>CIDR</td>
<td>10.0.0.0/16</td>
</tr>
<tr>
<td>tenancy</td>
<td>Default</td>
</tr>
</tbody></table>
<ul>
<li>Subnet 設定</li>
</ul>
<table>
<thead>
<tr>
<th><em>項目</em></th>
<th>Subnet 1</th>
<th>Subnet 2</th>
</tr>
</thead>
<tbody><tr>
<td>Name tag</td>
<td>任意(VPCのタグ名と関連付けたほうが管理しやすい)</td>
<td>任意(VPCのタグ名と関連付けたほうが管理しやすい)</td>
</tr>
<tr>
<td>VPC</td>
<td>上記で作成したVPCを選択する</td>
<td>上記で作成したVPCを選択する</td>
</tr>
<tr>
<td>Availability Zone</td>
<td>ap-northeast-1a</td>
<td>ap-northeast-1c</td>
</tr>
<tr>
<td>CIDR</td>
<td>10.0.0.0/24</td>
<td>10.0.1.0/24</td>
</tr>
</tbody></table>
<p>上記VPC設定に基づき以下設定していきます。</p>
<p>構築するイメージは以下になります。</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/Vecob6k.png" width="100%">
</div>


<h2><span id="セキュリティグループ作成">セキュリティグループ作成</span></h2><p>今回作成するインスタンス2つにアタッチするセキュリティグループを事前に作成します。</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/OMoO3DE.png" width="100%">
</div>

<h4><span id="マイipからのsshログイン許可">マイIPからのSSHログイン許可</span></h4><table>
<thead>
<tr>
<th><em>項目</em></th>
<th>設定値</th>
</tr>
</thead>
<tbody><tr>
<td>セキュリティグループ名</td>
<td>VPC-for-EIP(任意)</td>
</tr>
<tr>
<td>説明</td>
<td>VPC-for-EIP(任意)</td>
</tr>
<tr>
<td>VPC</td>
<td>上記で作成したVPCを選択する</td>
</tr>
</tbody></table>
<div style="text-align:center;">
<img src="http://i.imgur.com/PV3aosl.png" width="100%">
</div>


<h4><span id="作成したセキュリティグループ編集">作成したセキュリティグループ編集</span></h4><ul>
<li>フィルターで検索<div style="text-align:center;">
<img src="http://i.imgur.com/iCAVdLY.png" width="100%">
</div>

</li>
</ul>
<p><span style="color:red">※以下は環境により変更してください。</span></p>
<ul>
<li>送信元を作成したグループIDとし以下追加し保存</li>
</ul>
<table>
<thead>
<tr>
<th><em>タイプ</em></th>
<th><em>プロトコル</em></th>
<th><em>ポート範囲</em></th>
<th><em>送信元</em></th>
<th><em>用途</em></th>
</tr>
</thead>
<tbody><tr>
<td>すべてのTCP</td>
<td>TCP</td>
<td>0 - 65535</td>
<td>作成したセキュリティグループID</td>
<td>今回は検証用の為、全解放。適宜設定変更してください。</td>
</tr>
<tr>
<td>すべてのICMP</td>
<td>ICMP</td>
<td>0 - 65535</td>
<td>作成したセキュリティグループID</td>
<td>ping疎通確認用。今回は検証用の為、全解放  適宜設定変更してください。</td>
</tr>
<tr>
<td>すべてのUDP</td>
<td>UDP</td>
<td>0 - 65535</td>
<td>作成したセキュリティグループID</td>
<td>corosyncで必要なポートはデフォルトで 5404 - 5405。  環境により設定変更する場合は注意が必要です。今回は検証用の為、全解放。適宜設定変更してください。</td>
</tr>
<tr>
<td>SSH</td>
<td>TCP</td>
<td>20</td>
<td>マイIP</td>
<td>自PC端末からSSHログイン用。実環境で設定する必要はありません。</td>
</tr>
<tr>
<td>HTTP</td>
<td>TCP</td>
<td>80</td>
<td>マイIP</td>
<td>FailOver検証用。実環境で設定する必要はありません。</td>
</tr>
</tbody></table>
<div style="text-align:center;">
<img src="http://i.imgur.com/tqo68AU.png" width="100%">
</div>

<p>以上でインスタンスに適用するセキュリティグループの作成が完了しました。</p>
<hr>
<h2><span id="ポリシー作成">ポリシー作成</span></h2><p>今回、以下コマンドを実行する必要があります。</p>
<table>
<thead>
<tr>
<th><em>コマンド</em></th>
<th><em>用途</em></th>
</tr>
</thead>
<tbody><tr>
<td>aws ec2 associate-address</td>
<td>ElasticIPをインスタンスに関連付ける</td>
</tr>
<tr>
<td>aws ec2 disassociate-address</td>
<td>ElasticIPをインスタンス関連付け解除</td>
</tr>
<tr>
<td>aws ec2 describe-addresses</td>
<td>IPアドレスについて詳細取得</td>
</tr>
</tbody></table>
<h5><span id="identity-amp-access-management-ページにアクセス">Identity &amp; Access Management ページにアクセス</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/SXbwsQO.png" width="100%">
</div>

<h5><span id="ポシリー作成クリック">「ポシリー作成」クリック</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/YtCrsuO.png" width="100%">
</div>

<h5><span id="独自ポリシー作成">独自ポリシー作成</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/ESnqZ9e.png" width="100%">
</div>

<h5><span id="独自ポリシー情報入力">独自ポリシー情報入力</span></h5><ul>
<li>ポリシー名(任意)</li>
</ul>
<p>floatingElasticIP</p>
<ul>
<li>ポリシードキュメント</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">    &quot;Statement&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">            &quot;Action&quot;: [</span><br><span class="line">                &quot;ec2:Describe*&quot;,</span><br><span class="line">                &quot;ec2:DisassociateAddress&quot;,</span><br><span class="line">                &quot;ec2:AssociateAddress&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Resource&quot;: [</span><br><span class="line">                &quot;*&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<div style="text-align:center;">
<img src="http://i.imgur.com/pBl5BIx.png" width="100%">
</div>

<h5><span id="確認">確認</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/NQCNu3S.png" width="100%">
</div>





<h2><span id="iamロール作成">IAMロール作成</span></h2><p>ElasticIPの付け替え権限を持ったロールを作成します。</p>
<h5><span id="新しいロールの作成-をクリック">新しいロールの作成 をクリック</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/5gceMNE.png" width="100%">
</div>

<h5><span id="ロール名の設定">ロール名の設定</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/jm6Xd6R.png" width="100%">
</div>

<h5><span id="ロールタイプの選択">ロールタイプの選択</span></h5><p><code>Amazon EC2</code> の「選択」ボタンをクリック</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/1WlUrxd.png" width="100%">
</div>

<h5><span id="ポリシーのアタッチ">ポリシーのアタッチ</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/2SQnomX.png" width="100%">
</div>

<h5><span id="登録内容を確認しロールの作成">登録内容を確認しロールの作成</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/2ShhAQb.png" width="100%">
</div>

<h5><span id="作成されたか確認">作成されたか確認</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/ku9OuEY.png" width="100%">
</div>

<p>以上でインスタンスに適用するIAMロールの作成が完了しました。</p>
<h2><span id="ユーザ作成">ユーザ作成</span></h2><h5><span id="identity-amp-access-management-ページにアクセス">Identity &amp; Access Management ページにアクセス</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/SXbwsQO.png" width="100%">
</div>

<h5><span id="メニューからユーザクリック-amp-新規ユーザの作成-ボタンクリック">メニューからユーザクリック &amp; 新規ユーザの作成 ボタンクリック</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/CgXjbXe.png" width="100%">
</div>

<h5><span id="ユーザ名入力し作成ボタンクリック">ユーザ名入力し作成ボタンクリック</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/krwAV7x.png" width="100%">
</div>

<h5><span id="認証情報をダウンロードクリック">認証情報をダウンロードクリック</span></h5><p><code>Access Key Id</code> と <code>Secret Access Key</code> が記載されたCSVがダウンロードされます。<br>大切に保管しましょう。</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/aijHfiD.png" width="100%">
</div>

<h5><span id="作成されたユーザーにアクセス">作成されたユーザーにアクセス</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/GZlHWhS.png" width="100%">
</div>


<h5><span id="ポリシーのアタッチ開始">ポリシーのアタッチ開始</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/7eqSqLN.png" width="100%">
</div>

<h5><span id="ポリシーにチェックを入れアタッチ">ポリシーにチェックを入れアタッチ</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/GzFx20A.png" width="100%">
</div>

<p>以上で<br><code>AmazonEC2FullAccess</code> 権限を持ったユーザ <code>floatingIP</code> ユーザが作成されました。</p>
<p>上記ユーザの認証情報は 手順 <code>aws-cli インストール</code> で利用します。</p>
<hr>
<h2><span id="インスタンスの作成">インスタンスの作成</span></h2><ul>
<li>上記で作成したVPCのSubnet (ap-northeast-1a)にインスタンス (以降Instance A)を作成します。</li>
</ul>
<h4><span id="インスタンスの作成をクリック">「インスタンスの作成」をクリック</span></h4><div style="text-align:center;">
<img src="http://i.imgur.com/xUusATW.png" width="100%">
</div>


<h4><span id="マシンイメージ選択">マシンイメージ選択</span></h4><p>今回は <code>CentOS 7 (x86_64) with Updates HVM</code> を選択します。</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/lpufR9j.png" width="100%">
</div>


<h4><span id="インスタンスタイプ選択">インスタンスタイプ選択</span></h4><p>今回は検証用で無料枠として利用したいので <code>t2.micro</code> を選択します。</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/6dtDEyx.png" width="100%">
</div>

<h4><span id="インスタンスの詳細の設定">インスタンスの詳細の設定</span></h4><p><code>ap-northeast-1a</code> に作成する <code>Instance A</code> のプライマリIPを<br><code>10.0.0.20</code> とします。</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/NLKElwj.png" width="100%">
</div>


<h4><span id="ストレージの追加">ストレージの追加</span></h4><p>特に変更することなく次の手順へ</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/oxgrhev.png" width="100%">
</div>


<h4><span id="インスタンスのタグ付け">インスタンスのタグ付け</span></h4><p><code>Name</code> タグに <code>Instance A</code> と指定します。<br>※ 任意なのでわかりやすいテキストであれば良いです。</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/hPol99o.png" width="100%">
</div>


<h4><span id="セキュリティグループの設定">セキュリティグループの設定</span></h4><ul>
<li>事前に作成したセキュリティグループを選択</li>
</ul>
<div style="text-align:center;">
<img src="http://i.imgur.com/M0eWyCo.png" width="100%">
</div>


<h4><span id="インスタンス作成の確認">インスタンス作成の確認</span></h4><div style="text-align:center;">
<img src="http://i.imgur.com/IAEUp2R.png" width="100%">
</div>

<p>以上で <code>Insntace A</code> の作成が完了しました。</p>
<h2><span id="同様に-instance-b-作成">同様に <code>Instance B</code> 作成</span></h2><h6><span id="instance-a-との主な変更点"><code>Instance A</code> との主な変更点</span></h6><ul>
<li>Subnet <code>10.0.1.0/24</code> を選択</li>
<li>インスタンスのタグは <code>Instance B</code> とする</li>
</ul>
<h6><span id="instance-b-設定時注意点"><code>Instance B</code> 設定時注意点</span></h6><ul>
<li><code>セキュリティグループ</code> は <code>Instance B</code> でも同様 <code>Instance A</code> で設定した<br><code>セキュリティグループ</code> を選択する。</li>
</ul>
<div style="text-align:center;">
<img src="http://i.imgur.com/it25cK3.png" width="100%">
</div>


<h2><span id="送信元送信先の変更チェックを無効化">送信元/送信先の変更チェックを無効化</span></h2><p>※上記 Instance A, B 共に <code>Source/Destination Check</code> (ネットワーク &gt; 送信元/送信先の変更チェック) を <code>Disabled</code> (無効) に設定する必要があります。</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/eYjJF0i.png" width="100%">
</div>


<h2><span id="インスタンス-sshログイン後まずやること">インスタンス SSHログイン後まずやること</span></h2><h4><span id="最低限必要なモジュールインストール">最低限必要なモジュールインストール</span></h4><p>※ git は ElasticIP付け替え時のシェルをインストールする際に必要になります。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Instance A &amp; B ]# yum install -y git</span><br><span class="line"></span><br><span class="line">[Instance A &amp; B ]# git --version</span><br><span class="line"></span><br><span class="line">git version 1.8.3.1</span><br></pre></td></tr></table></figure>

<h4><span id="fail-over-検証用に-httpd-php-インストール">Fail Over 検証用に httpd, php インストール</span></h4><p>あくまで Fail Over 時の動きを見る為の確認用にインストールし起動しています。<br><span style="color:red">※必須工程ではありません。</span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[Instance A &amp; B ]# yum --disableexcludes&#x3D;main install -y gcc</span><br><span class="line">[Instance A &amp; B ]# yum install -y gmp gmp-devel</span><br><span class="line">[Instance A &amp; B ]# yum install -y php php-mysql httpd libxml2-devel net-snmp net-snmp-devel curl-devel gettext</span><br><span class="line">[Instance A &amp; B ]# echo &#39;&lt;?php print_r($_SERVER[&quot;SERVER_ADDR&quot;]); ?&gt;&#39; &gt; &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php</span><br><span class="line">[Instance A &amp; B ]# systemctl start httpd</span><br><span class="line">[Instance A &amp; B ]# systemctl enable httpd</span><br></pre></td></tr></table></figure>



<h4><span id="system-clock-調整-jst設定">system clock 調整 JST設定</span></h4><p>OS内の時間が現実の時間とずれていると<br>aws-cliが正常に動作しない可能性があるので<br>念の為、調整しておきます。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># バックアップ確保</span><br><span class="line">[Instance A &amp; B ]# cp &#x2F;etc&#x2F;sysconfig&#x2F;clock &#x2F;etc&#x2F;sysconfig&#x2F;clock.org</span><br><span class="line"></span><br><span class="line"># 再起動しても設定維持する様にする。</span><br><span class="line">[Instance A &amp; B ]# echo -e &#39;ZONE&#x3D;&quot;Asia&#x2F;Tokyo&quot;\nUTC&#x3D;false&#39; &gt; &#x2F;etc&#x2F;sysconfig&#x2F;clock</span><br><span class="line"></span><br><span class="line"># バックアップ確保</span><br><span class="line">[Instance A &amp; B ]# cp &#x2F;etc&#x2F;localtime &#x2F;etc&#x2F;localtime.org</span><br><span class="line"></span><br><span class="line"># Asia&#x2F;Tokyo を localtime に設定</span><br><span class="line">[Instance A &amp; B ]# ln -sf  &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Tokyo &#x2F;etc&#x2F;localtime</span><br><span class="line"></span><br><span class="line">[Instance A &amp; B ]# date</span><br></pre></td></tr></table></figure>



<h2><span id="elastic-ip作成">Elastic IP作成</span></h2><p>Elastic IPを作成し <code>Server A</code> に関連付けます。</p>
<h5><span id="新しいアドレスを割り当てる">新しいアドレスを割り当てる</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/Xcv1hQ5.png" width="100%">
</div>

<h5><span id="確認ポップアップで関連付けるをクリック">確認ポップアップで「関連付ける」をクリック</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/8LUxbhs.png" width="100%">
</div>

<h5><span id="成功確認">成功確認</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/UQ1YPk4.png" width="100%">
</div>

<h5><span id="インスタンスに関連付け">インスタンスに関連付け</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/Cpol9pv.png" width="100%">
</div>

<h5><span id="関連するインスタンス選択">関連するインスタンス選択</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/bJVJcSv.png" width="100%">
</div>

<h5><span id="確認">確認</span></h5><div style="text-align:center;">
<img src="http://i.imgur.com/uQlaHyf.png" width="100%">
</div>

<p>以上で Instance A に ElasticIP が関連付けされました。</p>
<h2><span id="instance-a-amp-b-に-sshログイン">Instance A &amp; B に SSHログイン</span></h2><ul>
<li><p>Instance A に SSHログイン</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Local PC]# ssh -i aws.pem centos@&lt;Instance AのPublic IP&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Instance B に SSHログイン</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Local PC]# ssh -i aws.pem centos@&lt;Instance BのPublic IP&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2><span id="etchosts設定">/etc/hosts設定</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Instance A ]# uname -n</span><br><span class="line">ip-10-0-0-10.ap-northeast-1.compute.internal</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Instance B ]# uname -n</span><br><span class="line">ip-10-0-1-10.ap-northeast-1.compute.internal</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Instance A &amp; B ]# vi &#x2F;etc&#x2F;hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line"># 以下追加</span><br><span class="line">10.0.0.20 ip-10-0-0-20.ap-northeast-1.compute.internal</span><br><span class="line">10.0.1.20 ip-10-0-1-20.ap-northeast-1.compute.internal</span><br></pre></td></tr></table></figure>

<h2><span id="pacemaker-amp-corosync-インストール">Pacemaker &amp; Corosync インストール</span></h2><ul>
<li>pcsは旧来のcrmshに代わるPacemakerクラスタ管理ツールであり、RHEL/CentOS7においてはpcsの使用が推奨されている。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Instance A &amp; B ]# yum -y install pcs fence-agents-all</span><br></pre></td></tr></table></figure>


<ul>
<li>バージョン確認</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Instance A &amp; B ]# pcs --version</span><br><span class="line">0.9.143</span><br><span class="line"></span><br><span class="line">[Instance A &amp; B ]# pacemakerd --version</span><br><span class="line">Pacemaker 1.1.13-10.el7</span><br><span class="line">Written by Andrew Beekhof</span><br><span class="line"></span><br><span class="line">[Instance A &amp; B ]# corosync -v</span><br><span class="line">Corosync Cluster Engine, version &#39;2.3.4&#39;</span><br><span class="line">Copyright (c) 2006-2009 Red Hat, Inc.</span><br></pre></td></tr></table></figure>



<h2><span id="hacluster-パスワード設定">hacluster パスワード設定</span></h2><p>corosyncパッケージインストール時に自動で <code>hacluster</code> ユーザが追加される。<br>その <code>hacluster</code> のパスワードを設定する。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Instance A &amp; B ]# passwd hacluster</span><br><span class="line">ユーザー hacluster のパスワードを変更。</span><br><span class="line">新しいパスワード:</span><br><span class="line">新しいパスワードを再入力してください:</span><br><span class="line">passwd: すべての認証トークンが正しく更新できました。</span><br></pre></td></tr></table></figure>



<h2><span id="pcsd-起動">pcsd 起動</span></h2><p>cluster監視を実施する為</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Instance A &amp; B ]# systemctl start pcsd</span><br><span class="line">[Instance A &amp; B ]# systemctl enable pcsd</span><br><span class="line">[Instance A &amp; B ]# systemctl status pcsd</span><br></pre></td></tr></table></figure>


<h2><span id="cluster認証">cluster認証</span></h2><p>クラスタを組む各ホストへのアクセス認証を検証します。</p>
<p>どちらか一方のInstanceから実行します。<br>以下はInstance Aから実行しています。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Instance A ]# pcs cluster auth ip-10-0-0-20.ap-northeast-1.compute.internal ip-10-0-1-20.ap-northeast-1.compute.internal</span><br><span class="line">Username: hacluster</span><br><span class="line">Password:</span><br><span class="line">ip-10-0-1-20.ap-northeast-1.compute.internal: Authorized</span><br><span class="line">ip-10-0-0-20.ap-northeast-1.compute.internal: Authorized</span><br></pre></td></tr></table></figure>

<p>上記のように Authorized (認証済み) と出力されていれば問題ありませんが<br>以下のような <code>Unable to Communicate</code> というエラーが出力されている場合は<br><code>各Instance</code> の設定を見直してください。</p>
<ul>
<li>認証エラーの例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Instance A ]# pcs cluster auth ip-10-0-0-20.ap-northeast-1.compute.internal ip-10-0-1-20.ap-northeast-1.compute.internal -u hacluster -p ruby2015</span><br><span class="line">Error: Unable to communicate with ip-10-0-0-20.ap-northeast-1.compute.internal</span><br><span class="line">Error: Unable to communicate with ip-10-0-1-20.ap-northeast-1.compute.internal</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h2><span id="cluster設定">cluster設定</span></h2><p>クラスタ設定をします。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[Instance A ]# pcs cluster setup --name aws-cluster ip-10-0-0-20.ap-northeast-1.compute.internal ip-10-0-1-20.ap-northeast-1.compute.internal --force</span><br><span class="line"></span><br><span class="line">Shutting down pacemaker&#x2F;corosync services...</span><br><span class="line">Redirecting to &#x2F;bin&#x2F;systemctl stop  pacemaker.service</span><br><span class="line">Redirecting to &#x2F;bin&#x2F;systemctl stop  corosync.service</span><br><span class="line">Killing any remaining services...</span><br><span class="line">Removing all cluster configuration files...</span><br><span class="line">ip-10-0-0-20.ap-northeast-1.compute.internal: Succeeded</span><br><span class="line">ip-10-0-1-20.ap-northeast-1.compute.internal: Succeeded</span><br><span class="line">Synchronizing pcsd certificates on nodes ip-10-0-0-20.ap-northeast-1.compute.internal, ip-10-0-1-20.ap-northeast-1.compute.internal...</span><br><span class="line">ip-10-0-0-20.ap-northeast-1.compute.internal: Success</span><br><span class="line">ip-10-0-1-20.ap-northeast-1.compute.internal: Success</span><br><span class="line"></span><br><span class="line">Restaring pcsd on the nodes in order to reload the certificates...</span><br><span class="line">ip-10-0-0-20.ap-northeast-1.compute.internal: Success</span><br><span class="line">ip-10-0-1-20.ap-northeast-1.compute.internal: Success</span><br></pre></td></tr></table></figure>


<h2><span id="cluster起動">cluster起動</span></h2><p>全ホストに向け クラスタ起動します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Instance A ]# pcs cluster start --all</span><br><span class="line"></span><br><span class="line">ip-10-0-1-20.ap-northeast-1.compute.internal: Starting Cluster...</span><br><span class="line">ip-10-0-0-20.ap-northeast-1.compute.internal: Starting Cluster...</span><br></pre></td></tr></table></figure>

<h2><span id="aws-cli-インストール">aws-cli インストール</span></h2><p>手順: <code>ユーザ作成</code> でダウンロードした <code>credentials.csv</code> に記載された<br><code>Access Key Id</code> <code>Secret Access Key</code> を使用します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Instance A &amp; B ]# rpm -iUvh http:&#x2F;&#x2F;dl.fedoraproject.org&#x2F;pub&#x2F;epel&#x2F;7&#x2F;x86_64&#x2F;e&#x2F;epel-release-7-5.noarch.rpm</span><br><span class="line">[Instance A &amp; B ]# yum -y install python-pip</span><br><span class="line">[Instance A &amp; B ]# pip --version</span><br><span class="line">pip 7.1.0 from &#x2F;usr&#x2F;lib&#x2F;python2.7&#x2F;site-packages (python 2.7)</span><br><span class="line"></span><br><span class="line">[Instance A &amp; B ]# pip install awscli</span><br><span class="line">[Instance A &amp; B ]# aws configure</span><br><span class="line">AWS Access Key ID [None]: *********************</span><br><span class="line">AWS Secret Access Key [None]: **************************************</span><br><span class="line">Default region name [None]: ap-northeast-1</span><br><span class="line">Default output format [None]: json</span><br></pre></td></tr></table></figure>

<h2><span id="eip-付け替えリソース作成">EIP 付け替えリソース作成</span></h2><p>heartbeat で問題検知した際に起動するリソースとして登録します。</p>
<p><code>OCF_ROOT</code> が定数として指定されているが、存在しない為</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Instance A &amp; B ]# cd &#x2F;tmp</span><br><span class="line">[Instance A &amp; B ]# git clone https:&#x2F;&#x2F;github.com&#x2F;moomindani&#x2F;aws-eip-resource-agent.git</span><br><span class="line">[Instance A &amp; B ]# cd aws-eip-resource-agent</span><br><span class="line">[Instance A &amp; B ]# sed -i &#39;s&#x2F;\$&#123;OCF_ROOT&#125;&#x2F;\&#x2F;usr\&#x2F;lib\&#x2F;ocf&#x2F;&#39; eip</span><br><span class="line">[Instance A &amp; B ]# mv eip &#x2F;usr&#x2F;lib&#x2F;ocf&#x2F;resource.d&#x2F;heartbeat&#x2F;</span><br><span class="line">[Instance A &amp; B ]# chown root:root &#x2F;usr&#x2F;lib&#x2F;ocf&#x2F;resource.d&#x2F;heartbeat&#x2F;eip</span><br><span class="line">[Instance A &amp; B ]# chmod 0755 &#x2F;usr&#x2F;lib&#x2F;ocf&#x2F;resource.d&#x2F;heartbeat&#x2F;eip</span><br></pre></td></tr></table></figure>


<h2><span id="pacemaker-設定">pacemaker 設定</span></h2><h5><span id="stonish-無効化">stonish 無効化</span></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Instance A ]# pcs property set stonith-enabled&#x3D;false</span><br></pre></td></tr></table></figure>

<h5><span id="split-brain-スプリットブレイン-が発生しても-quorum-クォーラム-が特別な動作を行わないように設定"><code>split-brain</code> (スプリット・ブレイン) が発生しても quorum (クォーラム) が特別な動作を行わないように設定</span></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Instance A ]# pcs property set no-quorum-policy&#x3D;ignore</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>split-brain</code> とは<br>ハートビート通信を行うネットワークに断線などの問題が発生した場合、ホストに障害が起こったと勘違いし、<br>本来立ち上がってほしくないスタンバイ側のホストがアクティブになってしまうというもの</p>
</blockquote>
<ul>
<li><a href="http://linux-ha.org/wiki/Split_Brain">Split-Brain wiki</a></li>
<li><a href="https://ja.wikipedia.org/wiki/Quorum">Quorum wiki</a></li>
</ul>
<h5><span id="属性値更新時の待ち時間-crmd-transition-delay-を-0s秒-設定">属性値更新時の待ち時間( <code>crmd-transition-delay</code> )を 0s(秒) 設定</span></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Instance A ]# pcs property set crmd-transition-delay&#x3D;&quot;0s&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="http://linux-ha.osdn.jp/wp/archives/1498">Pacemaker-1.0.11 がリリースされました</a></li>
</ul>
<h5><span id="自動フェイルバックなし-同一サーバでリソースの再起動を試みる回数を-1-回に設定">自動フェイルバックなし、同一サーバでリソースの再起動を試みる回数を 1 回に設定</span></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Instance A ]# pcs resource defaults resource-stickiness&#x3D;&quot;INFINITY&quot; migration-threshold&#x3D;&quot;1&quot;</span><br></pre></td></tr></table></figure>

<h5><span id="eip切り替え設定">EIP切り替え設定</span></h5><p>今回作成し <code>Instance A</code> に関連付けした ElasticIP は <code>52.192.203.215</code> です。<br>以下設定に反映させます。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[Instance A ]# pcs resource create eip ocf:heartbeat:eip \</span><br><span class="line">    params \</span><br><span class="line">        elastic_ip&#x3D;&quot;52.192.203.215&quot; \</span><br><span class="line">    op start   timeout&#x3D;&quot;60s&quot; interval&#x3D;&quot;0s&quot;  on-fail&#x3D;&quot;stop&quot; \</span><br><span class="line">    op monitor timeout&#x3D;&quot;60s&quot; interval&#x3D;&quot;10s&quot; on-fail&#x3D;&quot;restart&quot; \</span><br><span class="line">    op stop    timeout&#x3D;&quot;60s&quot; interval&#x3D;&quot;0s&quot;  on-fail&#x3D;&quot;block&quot;</span><br></pre></td></tr></table></figure>

<h2><span id="cluster-設定確認">cluster 設定確認</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[Instance A ]# pcs config</span><br><span class="line"></span><br><span class="line">pcs config</span><br><span class="line">Cluster Name: aws-cluster</span><br><span class="line">Corosync Nodes:</span><br><span class="line"> ip-10-0-0-20.ap-northeast-1.compute.internal ip-10-0-1-20.ap-northeast-1.compute.internal</span><br><span class="line">Pacemaker Nodes:</span><br><span class="line"> ip-10-0-0-20.ap-northeast-1.compute.internal ip-10-0-1-20.ap-northeast-1.compute.internal</span><br><span class="line"></span><br><span class="line">Resources:</span><br><span class="line"> Resource: eip (class&#x3D;ocf provider&#x3D;heartbeat type&#x3D;eip)</span><br><span class="line">  Attributes: elastic_ip&#x3D;52.192.203.215</span><br><span class="line">  Operations: start interval&#x3D;0s timeout&#x3D;60s on-fail&#x3D;stop (eip-start-interval-0s)</span><br><span class="line">              monitor interval&#x3D;10s timeout&#x3D;60s on-fail&#x3D;restart (eip-monitor-interval-10s)</span><br><span class="line">              stop interval&#x3D;0s timeout&#x3D;60s on-fail&#x3D;block (eip-stop-interval-0s)</span><br><span class="line"></span><br><span class="line">Stonith Devices:</span><br><span class="line">Fencing Levels:</span><br><span class="line"></span><br><span class="line">Location Constraints:</span><br><span class="line">Ordering Constraints:</span><br><span class="line">Colocation Constraints:</span><br><span class="line"></span><br><span class="line">Resources Defaults:</span><br><span class="line"> resource-stickiness: INFINITY</span><br><span class="line"> migration-threshold: 1</span><br><span class="line">Operations Defaults:</span><br><span class="line"> No defaults set</span><br><span class="line"></span><br><span class="line">Cluster Properties:</span><br><span class="line"> cluster-infrastructure: corosync</span><br><span class="line"> cluster-name: aws-cluster</span><br><span class="line"> crmd-transition-delay: 0s</span><br><span class="line"> dc-version: 1.1.13-10.el7-44eb2dd</span><br><span class="line"> have-watchdog: false</span><br><span class="line"> no-quorum-policy: ignore</span><br><span class="line"> stonith-enabled: false</span><br></pre></td></tr></table></figure>

<h2><span id="fail-over-実行確認">Fail Over 実行確認</span></h2><p>手順 <code>Fail Over 検証用に httpd, php インストール</code> にて<br>DocumentRoot (/var/www/html/) に<br><code>Private IP</code> (<code>$_SERVER[&quot;SERVER_ADDR&quot;]</code>)  を表示させるindex.phpファイルを<br>配置しました。</p>
<p>ブラウザから Private IP を元に Instance A or B どちらのInstance に<br>アクセスしているかがわかります。</p>
<h5><span id="ブラウザから-elasticip-にアクセス">ブラウザから ElasticIP にアクセス</span></h5><p>ElasticIP <code>52.192.203.215</code> にアクセスすると<br>Private IP <code>10.0.0.20</code> が表示されていることがわかります。</p>
<p>現状、ElasticIP は Instance A に関連付いていることがわかります。</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/fF2SwAb.png" width="100%">
</div>

<h5><span id="instance-a-の-corosync-停止">Instance A の corosync 停止</span></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Instance A]# systemctl stop corosync</span><br></pre></td></tr></table></figure>

<h5><span id="再度ブラウザから-elasticip-にアクセス">再度ブラウザから ElasticIP にアクセス</span></h5><p>先ほど表示させていたブラウザを幾度かリロードすると<br>Private IP <code>10.0.1.20</code> が表示されていることがわかります。</p>
<p>ElasticIP は Instance B に関連付けられたことがわかります。</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/ddnCfF5.png" width="100%">
</div>


<p>ElasticIP が Instance A から関連付けが解放され、 Instance B に関連付けされるようになりました。</p>
<p>コンソールページ上でも確認することができます。</p>
<p>以上で簡易的ではありますが<br>Cloud Design Pattern の floating IP (ElasticIP) が実現できました。</p>
<p>以上です。</p>
<h2><span id="参考">参考</span></h2><ul>
<li><a href="http://kan3aa.hatenablog.com/entry/2015/06/05/135150">CentOS7.1でPacemaker+corosyncによるクラスタを構成する</a></li>
<li><a href="https://moomindani.wordpress.com/2014/05/27/aws-eip-resource-agent/">PacemakerでEIPを付替えるResource Agentを書いてみた</a></li>
<li><a href="http://doruby.kbmj.com/taka/20131018/yum_update_crm_pcs_">yum updateしたらcrmコマンドが無くなった！(pcsコマンド対照表)</a></li>
<li><a href="http://news.mynavi.jp/news/2013/05/14/092/">pacemaker + corosync で HA クラスタ構築</a></li>
<li><a href="http://linux-ha.osdn.jp/wp/archives/3868">動かして理解するPacemaker ～CRM設定編～</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-12-23T15:00:00.000Z" title="2015-12-23T15:00:00.000Z">2015-12-24</time><span class="level-item">6分 read (About 955 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/12/23/2015-12-24-iptables-allow-ping/">pingを通すiptableの設定</a></h1><div class="content"><h2><span id="環境">環境</span></h2><ul>
<li>CentOS 5.8</li>
</ul>
<h2><span id="実現したいこと">実現したいこと</span></h2><p><code>Server A</code> が <code>Server B</code> からのみ ping を通す</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----------+  Ping Request   +----------+</span><br><span class="line">|          | &lt;-------------- |          |</span><br><span class="line">| Server A |                 | Server B |</span><br><span class="line">|          | --------------&gt; |          |</span><br><span class="line">+----------+  Ping Response  +----------+</span><br></pre></td></tr></table></figure>

<h2><span id="特定ipからの-ping-を通す許可設定">特定IPからの ping を通す許可設定</span></h2><p>以下設定を <code>Server A</code> で実施する。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Server A]# iptables -A INPUT -p icmp --icmp-type 8 -s &lt;Server B の IP Address&gt; -j ACCEPT</span><br><span class="line">[Server A]# iptables -A OUTPUT -p icmp --icmp-type 0 -s &lt;Server B の IP Address&gt; -j ACCEPT</span><br><span class="line">[Server A]# service iptables restart</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><code>--icmp-type 8</code> は <code>Echo request (エコー要求)</code> を許可</li>
<li><code>--icmp-type 0</code> は <code>Echo Reply (エコー応答)</code> を許可</li>
</ul>
</blockquote>
<h2><span id="server-bから-ping実行">Server Bから ping実行</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Server B]# ping &lt;Server A の IP Address&gt;</span><br><span class="line"></span><br><span class="line">PING (&lt;Server A の IP Address&gt;): 56 data bytes</span><br><span class="line">64 bytes from (&lt;Server A の IP Address&gt;): icmp_seq&#x3D;0 ttl&#x3D;58 time&#x3D;4.411 ms</span><br><span class="line">64 bytes from (&lt;Server A の IP Address&gt;): icmp_seq&#x3D;1 ttl&#x3D;58 time&#x3D;4.079 ms</span><br><span class="line">64 bytes from (&lt;Server A の IP Address&gt;): icmp_seq&#x3D;2 ttl&#x3D;58 time&#x3D;4.027 ms</span><br><span class="line">^C</span><br><span class="line">--- (&lt;Server A の IP Address&gt;) ping statistics ---</span><br><span class="line">3 packets transmitted, 3 packets received, 0.0% packet loss</span><br><span class="line">round-trip min&#x2F;avg&#x2F;max&#x2F;stddev &#x3D; 4.027&#x2F;4.172&#x2F;4.411&#x2F;0.170 ms</span><br></pre></td></tr></table></figure>


<h2><span id="icmp-type-list">icmp-type List</span></h2><p>以下<a href="http://www.asahi-net.or.jp/~aa4t-nngk/ipttut/output/icmptypes.html">asahi-net Appendix C. ICMPタイプ</a>より参照</p>
<table>
<thead>
<tr>
<th>TYPE</th>
<th>CODE</th>
<th>意味</th>
<th>問合せ</th>
<th>エラー</th>
<th>参照先</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>Echo Reply (エコー応答)</td>
<td>x</td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>0</td>
<td>Network Unreachable (ネットワーク到達不能)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>Host Unreachable (ホスト到達不能)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>Protocol Unreachable (プロトコル到達不能)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>Port Unreachable (ポート到達不能)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>Fragmentation needed but no frag. bit set (フラグメント必要だがフラグメント禁止ビットあり)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>5</td>
<td>Source routing failed (ソースルーティング失敗)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>6</td>
<td>Destination network unknown (宛先ネットワーク発見できず)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>7</td>
<td>Destination host unknown (宛先ホスト発見できず)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>8</td>
<td>Source host isolated (送信元ホストへのルートなし) (廃)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>9</td>
<td>Destination network administratively prohibited (宛先ネットワークは設定によりアクセス禁止)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>10</td>
<td>Destination host administratively prohibited (宛先ホストは設定によりアクセス禁止)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>11</td>
<td>Network unreachable for TOS (TOS種別によりネットワーク到達不能)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>12</td>
<td>Host unreachable for TOS (TOS種別によりホスト到達不能)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>3</td>
<td>13</td>
<td>Communication administratively prohibited by filtering (フィルタリング設定により通信禁止)</td>
<td></td>
<td>x</td>
<td>RFC1812</td>
</tr>
<tr>
<td>3</td>
<td>14</td>
<td>Host precedence violation (ホスト優先順位侵害)</td>
<td></td>
<td>x</td>
<td>RFC1812</td>
</tr>
<tr>
<td>3</td>
<td>15</td>
<td>Precedence cutoff in effect (優先順位により遮断発動)</td>
<td></td>
<td>x</td>
<td>RFC1812</td>
</tr>
<tr>
<td>4</td>
<td>0</td>
<td>Source quench (輻輳発生による発信抑制)</td>
<td></td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>5</td>
<td>0</td>
<td>Redirect for network (指定ネットワークへのリダイレクト要求)</td>
<td></td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
<td>Redirect for host (指定ホストへのリダイレクト要求)</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>2</td>
<td>Redirect for TOS and network (TOSとネットワークのリダイレクト要求)</td>
<td></td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>5</td>
<td>3</td>
<td>Redirect for TOS and host (TOSとホストのリダイレクト要求)</td>
<td></td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>8</td>
<td>0</td>
<td>Echo request(エコー要求)</td>
<td>x</td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>9</td>
<td>0</td>
<td>Router advertisement - Normal router advertisement (ルータ広告 - 通常通知)</td>
<td></td>
<td></td>
<td>RFC1256</td>
</tr>
<tr>
<td>9</td>
<td>16</td>
<td>Router advertisement - Does not route common traffic (ルータ広告 - 通常トラフィックはルーティング不可)</td>
<td></td>
<td></td>
<td>RFC2002</td>
</tr>
<tr>
<td>10</td>
<td>0</td>
<td>Route selection (ルート選択)</td>
<td></td>
<td></td>
<td>RFC1256</td>
</tr>
<tr>
<td>11</td>
<td>0</td>
<td>TTL equals 0 during transit (搬送中にTTLが0に)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>11</td>
<td>1</td>
<td>TTL equals 0 during reassembly (再構成時の欠損フラグメント待機中に時間超過)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>12</td>
<td>0</td>
<td>IP header bad (catchall error) (IPヘッダ異常) (あらゆるエラーに共通)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>12</td>
<td>1</td>
<td>Required options missing (必要なオプションが欠如)</td>
<td></td>
<td>x</td>
<td>RFC1108</td>
</tr>
<tr>
<td>12</td>
<td>2</td>
<td>IP Header bad length (IPヘッダ長の異常)</td>
<td></td>
<td>x</td>
<td>RFC792</td>
</tr>
<tr>
<td>13</td>
<td>0</td>
<td>Timestamp request (obsolete) (タイムスタンプ要求) (廃)</td>
<td>x</td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>14</td>
<td></td>
<td>Timestamp reply (obsolete) (タイムスタンプ応答) (廃)</td>
<td>x</td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>15</td>
<td>0</td>
<td>Information request (obsolete) (情報要求) (廃)</td>
<td>x</td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>16</td>
<td>0</td>
<td>Information reply (obsolete) (情報応答) (廃)</td>
<td>x</td>
<td></td>
<td>RFC792</td>
</tr>
<tr>
<td>17</td>
<td>0</td>
<td>Address mask request (ネットマスク通知要求)</td>
<td>x</td>
<td></td>
<td>RFC950</td>
</tr>
<tr>
<td>18</td>
<td>0</td>
<td>Address mask reply (ネットマスク通知応答)</td>
<td>x</td>
<td></td>
<td>RFC950</td>
</tr>
<tr>
<td>20-29</td>
<td></td>
<td>Reserved for robustness experiment (信頼性試験のための予約域)</td>
<td></td>
<td></td>
<td>Zaw-Sing Su</td>
</tr>
<tr>
<td>30</td>
<td>0</td>
<td>Traceroute</td>
<td>x</td>
<td></td>
<td>RFC1393</td>
</tr>
<tr>
<td>31</td>
<td>0</td>
<td>Datagram Conversion Error (データグラム変換エラー)</td>
<td></td>
<td>x</td>
<td>RFC1475</td>
</tr>
<tr>
<td>32</td>
<td>0</td>
<td>Mobile Host Redirect (移動体ホストのリダイレクト)</td>
<td></td>
<td></td>
<td>David Johnson</td>
</tr>
<tr>
<td>33</td>
<td>0</td>
<td>IPv6 Where-Are-You (IPv6位置確認要求)</td>
<td>x</td>
<td></td>
<td>Bill Simpson</td>
</tr>
<tr>
<td>34</td>
<td>0</td>
<td>IPv6 I-Am-Here (IPv6位置確認応答)</td>
<td>x</td>
<td></td>
<td>Bill Simpson</td>
</tr>
<tr>
<td>35</td>
<td>0</td>
<td>Mobile Registration Request (移動体登録要求)</td>
<td>x</td>
<td></td>
<td>Bill Simpson</td>
</tr>
<tr>
<td>36</td>
<td>0</td>
<td>Mobile Registration Reply (移動体登録応答)</td>
<td>x</td>
<td></td>
<td>Bill Simpson</td>
</tr>
<tr>
<td>39</td>
<td>0</td>
<td>SKIP</td>
<td></td>
<td></td>
<td>Tom Markson</td>
</tr>
<tr>
<td>40</td>
<td>0</td>
<td>Photuris</td>
<td></td>
<td></td>
<td>RFC2521</td>
</tr>
</tbody></table>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-12-21T15:00:00.000Z" title="2015-12-21T15:00:00.000Z">2015-12-22</time><span class="level-item">9分 read (About 1393 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/12/21/2015-12-22-cannot-get-mail-in-outlook/">Outlook にメールが届かない件対応</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>EC2を利用してますがSESかまさずに<br>メール送信をしていた時に<br>以下のようなエラーが発生しました。</p>
<ul>
<li>エラー内容</li>
</ul>
<blockquote>
<p>Dec 18 17:24:11 ip-xxx-xx-xx-xx postfix/smtp[4827]: 380D2A27ED: to=<a href="mailto:&#x68;&#111;&#103;&#101;&#x68;&#x6f;&#103;&#101;&#x40;&#x78;&#x78;&#120;&#x78;&#x78;&#x78;&#120;&#46;&#x63;&#111;&#109;">&#x68;&#111;&#103;&#101;&#x68;&#x6f;&#103;&#101;&#x40;&#x78;&#x78;&#120;&#x78;&#x78;&#x78;&#120;&#46;&#x63;&#111;&#109;</a>, relay=xxxxxxx-com.mail.protection.outlook.com[xxx.xx.xx.xxx]:25, delay=6.1, delays=0.01/0/0.88/5.2, dsn=5.7.1, status=bounced (host xxxxxxx-com.mail.protection.outlook.com[xxx.xx.xx.xxx] said: 550 5.7.1 Service unavailable; Client host [yy.yy.yy.yyy] blocked using FBLW15; To request removal from this list please forward this message to <a href="mailto:delist@messaging.microsoft.com">delist@messaging.microsoft.com</a> (in reply to RCPT TO command))</p>
</blockquote>
<h2><span id="要約すると">要約すると</span></h2><p><code>hogehoge@xxxxxxx.com</code> 宛のメールが Outlook でブラックリスト扱いされて弾かれています ( <code>status=bounced</code> )。<br>もしブラックリストから削除したい場合は、 <code>delist@messaging.microsoft.com</code> 宛に解除申請してください。</p>
<h2><span id="もうちょっと細かく">もうちょっと細かく</span></h2><p><code>relay=xxxxxxx-com.mail.protection.outlook.com[xxx.xx.xx.xxx]:25</code><br>とある通り<br>MicroSoftがメールツールサービス Outlook が受信相手です。</p>
<p>送信元サーバIP <code>yy.yy.yy.yyy</code> のホストは <code>FBLW15</code> 基準でブラックリスト扱いされているので<br>サービスは利用できない = メールは受け取らない<br>というものです。</p>
<ul>
<li>FBLW15 … MicroSoft独自のブラックリスト</li>
</ul>
<h2><span id="対応">対応</span></h2><ul>
<li>宛先:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delist@messaging.microsoft.com</span><br></pre></td></tr></table></figure>

<ul>
<li>タイトル:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please Remove My IP yy.yy.yy.yyy from your BlockList.</span><br></pre></td></tr></table></figure>

<ul>
<li>内容<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Please remove this IP yy.yy.yy.yyy from your BlockList.</span><br><span class="line"></span><br><span class="line">Thanks.</span><br><span class="line">Kenzo Tanaka.</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h2><span id="数分後に-microsoft-customer-support-から返信が着た">数分後に Microsoft Customer Support から返信が着た</span></h2><ul>
<li>メール内容</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Hello ,</span><br><span class="line"></span><br><span class="line">Thank you for your delisting request SRX1318598611ID. Your ticket was received on (Dec 21 2015 08:14 AM UTC) and will be responded to within 24 hours.</span><br><span class="line"></span><br><span class="line">Our team will investigate the address that you have requested to be removed from our blocklist. If for any reason we are not able to remove your address, one of our technical support representatives will respond to you with additional information.</span><br><span class="line"></span><br><span class="line">Regards,</span><br><span class="line">Technical Support</span><br></pre></td></tr></table></figure>

<ul>
<li>和訳すると</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">こんにちは</span><br><span class="line"></span><br><span class="line">ブラックリスト申請の削除依頼を受け取りました。24時間以内に回答します。</span><br><span class="line"></span><br><span class="line">削除要請頂いたアドレスをについて調査します。</span><br><span class="line">何らかの理由で削除依頼を引き受けられない場合は、</span><br><span class="line">当社の技術サポートから追加情報をお届け致します。</span><br><span class="line"></span><br><span class="line">以上宜しくお願い致します。</span><br><span class="line">テクニカルサポート</span><br></pre></td></tr></table></figure>


<h2><span id="24時間待ってみる">24時間待ってみる</span></h2><p>メール着た！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Hello,</span><br><span class="line"></span><br><span class="line">Thank you for contacting Microsoft Online Services Technical Support.  This email is in reference to ticket number, 1318598611 which was opened in regards to your delisting request for yy.yy.yy.yyy</span><br><span class="line"></span><br><span class="line">The IP address you submitted has been reviewed and removed from our block lists.  Please note that there may be a 1-2 hour delay before this change propagates through our entire system.</span><br><span class="line"></span><br><span class="line">We apologize for any inconvenience this may have caused you.  As long as our spam filtering systems do not mark a majority of email from the IP address as spam-like, your messages will be allowed to flow as normal through our network.  However, should we detect an increase in spam-like activity, the IP address may be re-added to our block list.</span><br><span class="line"></span><br><span class="line">Should you have any further questions or concerns, please feel free to respond to this email.</span><br><span class="line"></span><br><span class="line">Thank you again for contacting Microsoft Online Services technical support and giving us the opportunity to serve you.</span><br></pre></td></tr></table></figure>

<ul>
<li>和訳</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">こんにちは</span><br><span class="line"></span><br><span class="line">マイクロソフト・オンライン・サービス テクニカルサポートにお問い合わせいただきありがとうございます。</span><br><span class="line">このメールはチケット番号 1318598611、IPアドレス(yy.yy.yy.yyy) をブラックリストから削除する様申請頂いた件についてです。</span><br><span class="line"></span><br><span class="line">あなたが提出されたIPアドレスを見直し、ブロックリストから削除しました。</span><br><span class="line">この変更は私たちの全システムに行き届くには 1〜2時間程掛かる見込みです。</span><br><span class="line"></span><br><span class="line">ご不便お掛けしたことをお詫び申し上げます。</span><br><span class="line">スパムフィルタリングシステムがスパムとおぼしきIPアドレスからの多くのE-mailをマークしない限り</span><br><span class="line">あなたのメッセージは当社のネットワークを通じて通常通りに許可されるでしょう。</span><br><span class="line">しかし、スパム行為が増加していることを検知する必要があり、ブロックリストに追加する可能性があります。</span><br><span class="line"></span><br><span class="line">その他質問や確認をご希望の際は、こちらのメールにご返信ください。</span><br><span class="line"></span><br><span class="line">マイクロソフト・オンライン・サービス テクニカルサポートにご連絡いただき</span><br><span class="line">お力添えできましたこと、誠に感謝致します。</span><br></pre></td></tr></table></figure>

<p>やや和訳が…アグレッシブということで受け入れてください。<br>もっと良い和訳あったら頂きたいです。</p>
<p>以上でブラックリストから解除されたそうなので、<br>マイクロソフト・テクニカル・サービスからメールが届いてから<br>4〜5時間後に再度メール送信し問題ないことが確認できました。</p>
<h2><span id="ipアドレスdnsのブラックリストチェック">IPアドレス/DNSのブラックリストチェック</span></h2><p>以下サイトで試しておくのが良いかと思います。<br>何かの間違いで登録されていた、というスパムメールとして扱われている<br>ということになるので。</p>
<ul>
<li><a href="http://www.spamhaus.org/lookup/">http://www.spamhaus.org/lookup/</a></li>
<li><a href="http://mxtoolbox.com/blacklists.aspx">http://mxtoolbox.com/blacklists.aspx</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-12-16T15:00:00.000Z" title="2015-12-16T15:00:00.000Z">2015-12-17</time><span class="level-item">3分 read (About 439 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/12/16/2015-12-17-mysql-error-2006-hy000-mysql-server-has-gone-away/">MySQLトラブルシューティング - ERROR 2006 (HY000) at line ***: MySQL server has gone away</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>DBインポート時に掲題のエラーが発生しました。</p>
<p>インポートサイズが大きすぎる為です。</p>
<p>インポートデータサイズのデフォルト値は <code>1M</code> です。</p>
<p>以下コマンドで確認できます。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;max_allowed_packet&#39;;</span><br></pre></td></tr></table></figure>

<h2><span id="対策">対策</span></h2><p>2点あります。</p>
<ul>
<li>mysqlコマンドラインから設定 (一時的)</li>
<li>my.cnf に設定 (恒久的)</li>
</ul>
<h3><span id="mysqlコマンドラインから一時的に引き上げる">mysqlコマンドラインから一時的に引き上げる</span></h3><p>再起動の必要がなく影響範囲が少なく済みます。<br>但し、再起動後、デフォルト値に戻るので<br>恒久的な対応が必要な場合<br>my.cnf に設定しmysqldを再起動する必要があります。</p>
<p>例) 10MB に設定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set global max_allowed_packet &#x3D; 1000000;</span><br></pre></td></tr></table></figure>

<h3><span id="mycnf-に-max_allowed_packet-を引き上げる様設定">my.cnf に <code>max_allowed_packet</code> を引き上げる様設定</span></h3><h5><span id="mycnf-パス探索">my.cnf パス探索</span></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># mysql --help | grep my.cnf</span><br><span class="line">                      order of preference, my.cnf, $MYSQL_TCP_PORT,</span><br><span class="line">&#x2F;etc&#x2F;my.cnf &#x2F;etc&#x2F;mysql&#x2F;my.cnf &#x2F;usr&#x2F;etc&#x2F;my.cnf ~&#x2F;.my.cnf</span><br></pre></td></tr></table></figure>

<p>以下の順で my.cnf を探しています。<br><code>/etc/my.cnf</code> → <code>/etc/mysql/my.cnf</code> → <code>/usr/etc/my.cnf</code> → <code>~/.my.cnf</code></p>
<p>個々の環境で異なるので本当に存在するかも含め設定ファイルを見定めてください。</p>
<p>おおよそ <code>/etc/my.cnf</code> が一般的かと思います。</p>
<h5><span id="mycnf-に-mysqld-に属する様に設定します">my.cnf に [mysqld] に属する様に設定します。</span></h5><p>10MBに設定してみます。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">max_allowed_packet&#x3D;10MB</span><br></pre></td></tr></table></figure>

<p>以上設定して再起動で設定反映完了です。</p>
<h2><span id="確認">確認</span></h2><p>設定が反映されているか確認します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;max_allowed_packet&#39;;</span><br><span class="line"></span><br><span class="line">+--------------------+----------+</span><br><span class="line">| Variable_name      | Value    |</span><br><span class="line">+--------------------+----------+</span><br><span class="line">| max_allowed_packet | 10485760 |</span><br><span class="line">+--------------------+----------+</span><br></pre></td></tr></table></figure>



<p>以上</p>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/15/">前</a></div><div class="pagination-next"><a href="/page/17/">次</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/15/">15</a></li><li><a class="pagination-link is-current" href="/page/16/">16</a></li><li><a class="pagination-link" href="/page/17/">17</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/20/">20</a></li></ul></nav></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="kenzo0107"></figure><p class="title is-size-4 is-block line-height-inherit">kenzo0107</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">投稿</p><a href="/archives"><p class="title">198</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">カテゴリ</p><a href="/categories"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">タグ</p><a href="/tags"><p class="title">88</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/kenzo0107" target="_blank" rel="noopener">フォローする</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/kenzo0107"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/kenzo0107"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">カテゴリ</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Go/"><span class="level-start"><span class="level-item">Go</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Terraform/"><span class="level-start"><span class="level-item">Terraform</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最近の記事</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-13T15:00:00.000Z">2020-08-14</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/13/2020-08-14-aws-kms-encrypt-decrypt/">aws-cli KMS で暗号化・復号</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-08-12T15:00:00.000Z">2020-08-13</time></p><p class="title is-6"><a class="link-muted" href="/2020/08/12/2020-08-13-external-s3-bucket/">AWS S3 Bucket の特定フォルダ以下を社外に共有する際のポイント</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Terraform/">Terraform</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-07-01T15:00:00.000Z">2020-07-02</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/01/2020-07-02-aws-iam-policy-managed-or-inline/">AWS IAM Policy はインラインでなく、管理ポリシーを積極的に使おう</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Terraform/">Terraform</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-06-05T15:00:00.000Z">2020-06-06</time></p><p class="title is-6"><a class="link-muted" href="/2020/06/05/2020-06-06-backlog-api-go/">Backlog API in Go 作りました</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Go/">Go</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-05-31T15:00:00.000Z">2020-06-01</time></p><p class="title is-6"><a class="link-muted" href="/2020/05/31/2020-06-01-terraform-sensitive-data/">aws_ssm_parameter の value を ignore_change に指定しない</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Terraform/">Terraform</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">タグ</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/htaccess/"><span class="tag">.htaccess</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ALB/"><span class="tag">ALB</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AWS/"><span class="tag">AWS</span><span class="tag is-grey-lightest">28</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ansible/"><span class="tag">Ansible</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AntiVirus/"><span class="tag">AntiVirus</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Apache/"><span class="tag">Apache</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Chef/"><span class="tag">Chef</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CodeBuild/"><span class="tag">CodeBuild</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cookie/"><span class="tag">Cookie</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Corosync/"><span class="tag">Corosync</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Datadog/"><span class="tag">Datadog</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ECR/"><span class="tag">ECR</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ECS/"><span class="tag">ECS</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ElastiCache/"><span class="tag">ElastiCache</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Elasticsearch/"><span class="tag">Elasticsearch</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Email/"><span class="tag">Email</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FTPS/"><span class="tag">FTPS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Fluentd/"><span class="tag">Fluentd</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GKE/"><span class="tag">GKE</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GitHub-Actions/"><span class="tag">GitHub Actions</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go/"><span class="tag">Go</span><span class="tag is-grey-lightest">23</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GooglePlay/"><span class="tag">GooglePlay</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hubot/"><span class="tag">Hubot</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Jenkins/"><span class="tag">Jenkins</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kibana/"><span class="tag">Kibana</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LINE-Notify/"><span class="tag">LINE Notify</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Lambda/"><span class="tag">Lambda</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Let-s-encrypt/"><span class="tag">Let&#039;s encrypt</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MachineLearning/"><span class="tag">MachineLearning</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Monitoring/"><span class="tag">Monitoring</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nginx/"><span class="tag">Nginx</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenSSL/"><span class="tag">OpenSSL</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Outlook/"><span class="tag">Outlook</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PHP/"><span class="tag">PHP</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Pacemaker/"><span class="tag">Pacemaker</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Prometheus/"><span class="tag">Prometheus</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ProxySQL/"><span class="tag">ProxySQL</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Puppeteer/"><span class="tag">Puppeteer</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag is-grey-lightest">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Rails/"><span class="tag">Rails</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RaspberryPI/"><span class="tag">RaspberryPI</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reactio/"><span class="tag">Reactio</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ruby/"><span class="tag">Ruby</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/S3/"><span class="tag">S3</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSL/"><span class="tag">SSL</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Security/"><span class="tag">Security</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SendGrid/"><span class="tag">SendGrid</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Slack/"><span class="tag">Slack</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SonarQube/"><span class="tag">SonarQube</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/StatsBot/"><span class="tag">StatsBot</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Swift/"><span class="tag">Swift</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Terraform/"><span class="tag">Terraform</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Twilio/"><span class="tag">Twilio</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Unity/"><span class="tag">Unity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vagrant/"><span class="tag">Vagrant</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vault/"><span class="tag">Vault</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WAF/"><span class="tag">WAF</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Zabbix/"><span class="tag">Zabbix</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/awk/"><span class="tag">awk</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/casperjs/"><span class="tag">casperjs</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cpu/"><span class="tag">cpu</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csv/"><span class="tag">csv</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flask/"><span class="tag">flask</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/i-node/"><span class="tag">i-node</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iftop/"><span class="tag">iftop</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ipinfo/"><span class="tag">ipinfo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iptable/"><span class="tag">iptable</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kibana/"><span class="tag">kibana</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macos/"><span class="tag">macos</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/no-ip/"><span class="tag">no-ip</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ping/"><span class="tag">ping</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pip/"><span class="tag">pip</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reCAPTCHA/"><span class="tag">reCAPTCHA</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sftp/"><span class="tag">sftp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spam/"><span class="tag">spam</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vim/"><span class="tag">vim</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wget/"><span class="tag">wget</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/yum/"><span class="tag">yum</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zsh/"><span class="tag">zsh</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="長生村本郷Engineers&#039;Blog" height="28"></a><p class="size-small"><span>&copy; 2020 Kenzo Tanaka</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("ja");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://kenzo0107.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: ''
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Zurück nach oben" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(无标题)","posts":"投稿","pages":"页面","categories":"カテゴリ","tags":"タグ"});
        });</script></body></html>