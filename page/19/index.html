<div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-09-18T15:00:00.000Z" title="2015-09-18T15:00:00.000Z">2015-09-19</time><span class="level-item">2分 read (About 349 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/09/18/2015-09-19-install-td-agent2-centos7/">3分で出来る！ AWS EC2(CentOS7)に td-agent2インストール</a></h1><div class="content"><h2><span id="環境">環境</span></h2><ul>
<li>AWS EC2</li>
<li>CentOS Linux release 7.1.1503 (Core)</li>
</ul>
<h2><span id="td-agent2-インストール">td-agent2 インストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo curl -L http:&#x2F;&#x2F;toolbelt.treasuredata.com&#x2F;sh&#x2F;install-redhat-td-agent2.sh | sh</span><br></pre></td></tr></table></figure>

<h2><span id="起動サービス登録">起動/サービス登録</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start td-agent</span><br><span class="line">$ sudo chkconfig td-agent on</span><br></pre></td></tr></table></figure>

<p><code>systemctl enable</code>するとchkconfig使ってと怒られます。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl enable td-agent</span><br><span class="line"></span><br><span class="line">td-agent.service is not a native service, redirecting to &#x2F;sbin&#x2F;chkconfig.</span><br><span class="line">Executing &#x2F;sbin&#x2F;chkconfig td-agent on</span><br><span class="line">The unit files have no [Install] section. They are not meant to be enabled</span><br><span class="line">using systemctl.</span><br><span class="line">Possible reasons for having this kind of units are:</span><br><span class="line">1) A unit may be statically enabled by being symlinked from another unit&#39;s</span><br><span class="line">   .wants&#x2F; or .requires&#x2F; directory.</span><br><span class="line">2) A unit&#39;s purpose may be to act as a helper for some other unit which has</span><br><span class="line">   a requirement dependency on it.</span><br><span class="line">3) A unit may be started when needed via activation (socket, path, timer,</span><br><span class="line">   D-Bus, udev, scripted systemctl call, ...).</span><br><span class="line">[root@ip-172-31-19-253 log]#</span><br></pre></td></tr></table></figure>

<h2><span id="試験">試験</span></h2><p>設定ファイル (/etc/td-agent/td-agent.conf)を見ると<br>デフォルト設定では、<br><code>httpプロトコル</code>で<code>port:8888</code>からLoggingしtd-agent.log(/var/log/td-agent/td-agent.log)に流すようにしています。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># HTTP input</span><br><span class="line"># POST http:&#x2F;&#x2F;localhost:8888&#x2F;&lt;tag&gt;?json&#x3D;&lt;json&gt;</span><br><span class="line"># POST http:&#x2F;&#x2F;localhost:8888&#x2F;td.myapp.login?json&#x3D;&#123;&quot;user&quot;%3A&quot;me&quot;&#125;</span><br><span class="line"># @see http:&#x2F;&#x2F;docs.fluentd.org&#x2F;articles&#x2F;in_http</span><br><span class="line">&lt;source&gt;</span><br><span class="line">  type http</span><br><span class="line">  port 8888</span><br><span class="line">&lt;&#x2F;source&gt;</span><br><span class="line"></span><br><span class="line">## live debugging agent</span><br><span class="line">&lt;source&gt;</span><br><span class="line">  type debug_agent</span><br><span class="line">  bind 127.0.0.1</span><br><span class="line">  port 24230</span><br><span class="line">&lt;&#x2F;source&gt;</span><br></pre></td></tr></table></figure>

<p>以下のようにコマンドを実行してtd-agent.logを確認してみる。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X POST -d &#39;json&#x3D;&#123;&quot;json&quot;:&quot;TEST!!&quot;&#125;&#39; http:&#x2F;&#x2F;localhost:8888&#x2F;debug.test</span><br><span class="line"></span><br><span class="line">$ sudo tail -f &#x2F;var&#x2F;log&#x2F;td-agent&#x2F;td-agent.log</span><br><span class="line"></span><br><span class="line">2015-09-19 17:34:50 +0900 debug.test: &#123;&quot;json&quot;:&quot;TEST!!&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>上記のように正しくロギングされていることが確認できました。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-09-13T15:00:00.000Z" title="2015-09-13T15:00:00.000Z">2015-09-14</time><span class="level-item">1分 read (About 152 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/09/13/2015-09-14-nginx-redirect-https/">Nginx ssl.conf設定 特定ページのみhttpsへリダイレクトさせる設定</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>Go RevelフレームをNginx上で利用しています。</p>
<p>その際に設定したssl設定、及び、<br>特定ページのみhttpsへリダイレクトする様な<br>設定をする必要があったので以下まとめました。</p>
<script src="//gist.github.com/kenzo0107/bab265d0e8c761576e24.js"></script>


<h3><span id="https通信したいのページは以下です">https通信したいのページは以下です。</span></h3><ul>
<li>/register</li>
<li>/mypage</li>
<li>/login</li>
<li>/logout</li>
</ul>
<p>https通信したいページをlocationの正規表現(~)でprefixを引っ掛けて<br>http通信の場合、https通信に301リダイレクトさせてます。</p>
<p>以上</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-08-29T15:00:00.000Z" title="2015-08-29T15:00:00.000Z">2015-08-30</time><span class="level-item"><a class="link-muted" href="/categories/Go/">Go</a></span><span class="level-item">2分 read (About 320 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/08/29/2015-08-30-go-revel-fw-jquery/">Go Revelフレームワーク jQuery非同期処理</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>Go RevelフレームワークでAjax非同期処理を実装します。</p>
<h2><span id="csrf-対策">CSRF 対策</span></h2><p>以下コマンドにより<br>RevelフレームワークでCSFR対策する為のライブラリをインストール</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go get github.com&#x2F;cbonello&#x2F;revel-csrf</span><br></pre></td></tr></table></figure>

<ul>
<li>app/init.go</li>
</ul>
<p>ajax実行時にCSRFチェックする為、init.goでのチェックを外すように設定</p>
<a href="https://gist.github.com/kenzo0107/2cc980f35c8753f7ccdf" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://github.githubassets.com/images/modules/gists/gist-og-image.png"></div><div class="descriptions"><div class="og-title">init.go</div><div class="og-description">GitHub Gist: instantly share code, notes, and snippets.</div></div></div></a>



<p>以下CSRFのFilter設定</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line">    revel.Filters = []revel.Filter&#123;</span><br><span class="line">        ...</span><br><span class="line">        ...</span><br><span class="line">        csrf.CSRFFilter,               <span class="comment">// CSRF prevention.</span></span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<p><code>conf/routes</code> で実行するAPIのURLはAjax実行時にCSRFチェックする為、<br>init.goではチェックを対象外とする様に設定</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">csrf.ExemptedFullPath(<span class="string">"/api_execute"</span>)</span><br></pre></td></tr></table></figure>


<h2><span id="view側の設定">View側の設定</span></h2><ul>
<li>views/header.html</li>
</ul>
<p><code>&lt;head&gt;〜&lt;/head&gt;</code> 内にCSRFチェック用ハッシュ値をmeta情報として埋め込みます。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"csrf-token"</span> <span class="attr">content</span>=<span class="string">"&#123;&#123; .csrf_token &#125;&#125;"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2><span id="jqueryファイル">jQueryファイル</span></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setAjaxToken</span>(<span class="params"> token </span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ajax --- start --------------------------------------------------</span></span><br><span class="line">    $.ajaxSetup(&#123;</span><br><span class="line">    	crossDomain: <span class="literal">false</span>,</span><br><span class="line">    	beforeSend: <span class="function"><span class="keyword">function</span>(<span class="params">xhr, settings</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!csrfSafeMethod(settings.type)) &#123;</span><br><span class="line">                xhr.setRequestHeader(<span class="string">"X-CSRFToken"</span>, token );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="built_in">document</span>).on(<span class="string">"click"</span>, <span class="string">".ajax_execute"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">	event.preventDefault();</span><br><span class="line"></span><br><span class="line">    	setAjaxToken( postData[<span class="string">'_token'</span>] );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> ajaxParamas = &#123;&#125;;</span><br><span class="line">    	ajaxParamas[<span class="string">"type"</span>]		= <span class="string">"POST"</span>;</span><br><span class="line">    	ajaxParamas[<span class="string">"url"</span>]		= action;</span><br><span class="line">    	ajaxParamas[<span class="string">"data"</span>]		= postData;</span><br><span class="line">    	ajaxParamas[<span class="string">"cache"</span>]	= <span class="literal">false</span>;</span><br><span class="line">    	ajaxParamas[<span class="string">"dataType"</span>]	= <span class="string">"json"</span>;</span><br><span class="line"></span><br><span class="line">        $.ajax(ajaxParamas)</span><br><span class="line">        .success( <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"(^-^) OK"</span>)</span><br><span class="line">        &#125;).error ( <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"(&gt;_&lt;) NG"</span>)</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>簡単…とは行ってない気がしますが<br>CSRF対策ができました。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-08-20T15:00:00.000Z" title="2015-08-20T15:00:00.000Z">2015-08-21</time><span class="level-item">3分 read (About 499 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/08/20/2015-08-21-fluentd-failpattern/">fluentd設定ハマった所あるある</a></h1><div class="content"><p>以下随時追加。</p>
<h2><span id="環境">環境</span></h2><ul>
<li>CentOS Linux release 7.1.1503 (Core)</li>
<li>Fluentd 0.12.12</li>
<li>Nginx 1.8.0</li>
</ul>
<h2><span id="permission-denined">Permission denined</span></h2><ul>
<li>パーミッションエラー！</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># tail -f &#x2F;var&#x2F;log&#x2F;td-agent&#x2F;td-agent.log</span><br><span class="line"></span><br><span class="line">2015-08-19 14:17:14 +0900 [error]: Permission denied @ xxxxxxx - &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log</span><br><span class="line">  2015-08-19 14:17:14 +0900 [error]: suppressed same stacktrace</span><br></pre></td></tr></table></figure>

<h3><span id="対策">対策</span></h3><p>td-agent実行ユーザを<code>root</code>に変更する。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim &#x2F;etc&#x2F;init.d&#x2F;td-agent</span><br><span class="line"></span><br><span class="line">- TD_AGENT_USER&#x3D;td-agent</span><br><span class="line">- TD_AGENT_GROUP&#x3D;td-agent</span><br><span class="line"></span><br><span class="line">+ TD_AGENT_USER&#x3D;root</span><br><span class="line">+ TD_AGENT_GROUP&#x3D;root</span><br></pre></td></tr></table></figure>

<p>デーモンリロード</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<h3><span id="動作確認">動作確認</span></h3><p>以下のように<code>tail</code>が正しく実行できていることが確認できます。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># tail -f &#x2F;var&#x2F;log&#x2F;td-agent&#x2F;td-agent.log</span><br><span class="line"></span><br><span class="line">2015-08-19 14:17:15 +0900 [info]: following tail of &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</span><br><span class="line">2015-08-19 14:17:15 +0900 [info]: following tail of &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log</span><br></pre></td></tr></table></figure>


<h2><span id="warn-pattern-not-match">[warn]: pattern not match</span></h2><p>これかなりハマりました。</p>
<p>Nginxのlogを流すときに以下のようにfomatするように書かれている記事を多く見たので<br>設定してみたらエラー発生(; &gt;_&lt;)</p>
<ul>
<li>/etc/td-agent/td-agent.conf</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;source&gt;</span><br><span class="line">  type tail</span><br><span class="line">  format nginx</span><br><span class="line">  path &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</span><br><span class="line">  pos_file &#x2F;var&#x2F;log&#x2F;td-agent&#x2F;nginx-access.pos</span><br><span class="line">  tag nginx.access</span><br><span class="line">&lt;&#x2F;source&gt;</span><br></pre></td></tr></table></figure>

<h3><span id="対策">対策</span></h3><p>以下のように修正</p>
<ul>
<li>/etc/td-agent/td-agent.conf</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;source&gt;</span><br><span class="line">  type tail</span><br><span class="line">  format &#x2F;^(?&lt;remote&gt;[^ ]*) (?&lt;host&gt;[^ ]*) (?&lt;user&gt;[^ ]*) \[(?&lt;time&gt;[^\]]*)\] &quot;(?&lt;method&gt;\S+)(?: +(?&lt;path&gt;[^ ]*) +\S*)?&quot; (?&lt;code&gt;[^ ]*) (?&lt;size&gt;[^ ]*)(?: &quot;(?&lt;referer&gt;[^\&quot;]*)&quot; &quot;(?&lt;agent&gt;[^\&quot;]*)&quot; &quot;(?&lt;forwarder&gt;[^\&quot;]*)&quot;)?&#x2F;</span><br><span class="line">  time_format %d&#x2F;%b&#x2F;%Y:%H:%M:%S %z</span><br><span class="line">  path &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</span><br><span class="line">  pos_file &#x2F;var&#x2F;log&#x2F;td-agent&#x2F;nginx-access.pos</span><br><span class="line">  tag nginx.access</span><br><span class="line">&lt;&#x2F;source&gt;</span><br></pre></td></tr></table></figure>

<p>td-agent再起動</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart td-agent</span><br></pre></td></tr></table></figure>

<p>これで大丈夫。</p>
<h2><span id="buffer_path-重複">buffer_path 重複</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[error]: failed to configure sub output redshift: Other &#39;&#39; plugin already use same buffer_path: type &#x3D; , buffer_path &#x3D; *</span><br></pre></td></tr></table></figure>

<p>元々の設定は以下の様にしていました。<br>td-agent の送信先にトラブルがあり buffer が溜まり重複しエラーとなっていました。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buffer_path &#x2F;logs&#x2F;td-agent&#x2F;nginx&#x2F;logs</span><br></pre></td></tr></table></figure>

<p>例）以下の様な tag があった場合、buffer_path は同じく <code>/logs/td-agent/nginx/logs</code> となってしまう</p>
<p>hogehoge.20170101.log<br>hogehoge.20170102.log</p>
<h3><span id="対策">対策</span></h3><p>tag_parts を用い、以下の様に tag 毎に buffer_path をユニークにすることで解決</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buffer_path &#x2F;logs&#x2F;td-agent&#x2F;nginx&#x2F;logs_$&#123;tag_parts[0]&#125;_$&#123;tag_parts[1]&#125;</span><br></pre></td></tr></table></figure>


<p>引き続き何か発生したら追記していきます。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-08-19T15:00:00.000Z" title="2015-08-19T15:00:00.000Z">2015-08-20</time><span class="level-item"><a class="link-muted" href="/categories/Go/">Go</a></span><span class="level-item">4分 read (About 532 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/08/19/2015-08-20-beginner-gopher/">Go初心者におすすめ本</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>身の回りであまりGoを積極的にやっている人がいないので<br>やってみたいなぁ、気になってはいる、<br>という方に本をおすすめしてみたいと思いました。</p>
<h2><span id="この一冊">この一冊！</span></h2><p>以下をチョイスしました！</p>
<a href="https://www.amazon.co.jp/exec/obidos/ASIN/4774166278/kenzo0107-22/" class="link-preview" target="_blnak"><div class="link-area"><div class="og-image"><img></div><div class="descriptions"><div class="og-title">WEB+DB PRESS Vol.82 | 山口 徹, Jxck, 佐々木 大輔, 横路 隆, 加来 純一, 山本 伶, 大平 武志, 米川 健一, 坂本 登史文, 若原 祥正, 和久田 龍, 平栗 遵宜, 伊藤 直也, 佐藤 太一, 高橋 俊幸, 海野 弘成, 五嶋 壮晃, 佐藤 歩, 吉村 総一郎, 橋本 翔, 舘野 祐一, 中島 聡, 渡邊 恵太, はまちや2, 竹原, 河合 宜文, WEB+DB PRESS編集部 |本 | 通販 | Amazon</div><div class="og-description">Amazonで山口 徹, Jxck, 佐々木 大輔, 横路 隆, 加来 純一, 山本 伶, 大平 武志, 米川 健一, 坂本 登史文, 若原 祥正, 和久田 龍, 平栗 遵宜, 伊藤 直也, 佐藤 太一, 高橋 俊幸, 海野 弘成, 五嶋 壮晃, 佐藤 歩, 吉村 総一郎, 橋本…</div></div></div></a>

<h2><span id="よかった点">よかった点</span></h2><ul>
<li>全部で34ページ！1日で読み終わり、逆引きとしても利用できる。(Goのオフィシャルのチュートリアルをまとめてくれてる感じ)</li>
<li>Goの成り立ちを簡潔に説明しており、クロスコンパイルや並列処理サポートなどがありGoの使いどころがわかる。</li>
<li>ちょうど「Web API デザインの鉄則」という特集があり、API開発にはちょうど良い内容の一冊だった。</li>
</ul>
<p>特に本を紹介して自分にお金が入ることはないので<br>斜めから見ずにまず本見てみてください♪</p>
<h2><span id="goを使いたくなる記事">Goを使いたくなる記事</span></h2><h4><span id="jsonシリアライズし秒間のレスポンス回数測定">JSONシリアライズし秒間のレスポンス回数測定</span></h4><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20150820/20150820002200.png" width="100%">
</div>


<p>以下Qiita記事でまとめてくれていました。</p>
<p><a href="https://qiita.com/2KB/items/7a743033d8d1a87f1b72">「最速」フルスタックWebフレームワーク「revel」の紹介</a></p>
<h2><span id="個人的に好きな所">個人的に好きな所</span></h2><ul>
<li>while や do/while 、参考演算子がなくforのみ、とか冗長なコーディングを許さない</li>
<li>gofmtでフォーマット化してくれる。いつもコミット前にやってます。</li>
<li>ライブラリ増えてる。 Pythonの<code>pip install</code>みたく <code>go get</code>でインストール可。</li>
<li>ネイティブなのでアプリケーションが大きくなってもさほど遅くならない。</li>
</ul>
<p>以上<br>Gopherとお話できる機会が増えると何よりです。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-08-19T15:00:00.000Z" title="2015-08-19T15:00:00.000Z">2015-08-20</time><span class="level-item">5分 read (About 714 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/08/19/2015-08-20-install-kibana-on-centos7/">Kibana4 インストール on CentOS7</a></h1><div class="content"><h2><span id="前提">前提</span></h2><ul>
<li>Nginx インストール済み</li>
</ul>
<h2><span id="環境">環境</span></h2><ul>
<li>CentOS Linux release 7.0.1406 (Core)</li>
<li>Nginx 1.9.3</li>
<li>Kibana 4.1.1</li>
</ul>
<h2><span id="kibana-インストール">Kibana インストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class="line">$ sudo wget https:&#x2F;&#x2F;download.elastic.co&#x2F;kibana&#x2F;kibana&#x2F;kibana-4.1.1-linux-x64.tar.gz</span><br><span class="line">$ sudo tar xvzf kibana-4.1.1-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>

<h2><span id="kibana-設定ファイル修正">Kibana 設定ファイル修正</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi &#x2F;usr&#x2F;local&#x2F;src&#x2F;kibana-4.1.1-linux-x64&#x2F;config&#x2F;kibana.yml</span><br></pre></td></tr></table></figure>

<ul>
<li>host指定</li>
</ul>
<p>デフォルトでは <code>0.0.0.0</code> となっています。<br>今回は同サーバに構築するので localhost とし保存します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- host: &quot;0.0.0.0&quot;</span><br><span class="line">+ host: &quot;localhost&quot;</span><br></pre></td></tr></table></figure>

<p>上記の設定により、kibanaが<code>localhost</code>にアクセスできるようになります。</p>
<h2><span id="kibana-実行パス作成">Kibana 実行パス作成</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir -p &#x2F;opt&#x2F;kibana</span><br><span class="line">$ sudo cp -R &#x2F;usr&#x2F;local&#x2F;src&#x2F;kibana-4.1.1-linux-x64&#x2F;* &#x2F;opt&#x2F;kibana&#x2F;</span><br></pre></td></tr></table></figure>

<p>上記設定により以下コマンドでkibana実行可能になります。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;opt&#x2F;kibana&#x2F;bin&#x2F;kibana</span><br></pre></td></tr></table></figure>

<p>上記でも十分ですが、再起動した際にはkibanaは停止してしまいます。<br>なので、起動スクリプトを作成し、サービス登録します。</p>
<h2><span id="起動スクリプト作成">起動スクリプト作成</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;kibana4.service</span><br></pre></td></tr></table></figure>

<ul>
<li>kibana4.service</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">ExecStart&#x3D;&#x2F;opt&#x2F;kibana&#x2F;bin&#x2F;kibana</span><br><span class="line">Restart&#x3D;always</span><br><span class="line">StandardOutput&#x3D;syslog</span><br><span class="line">StandardError&#x3D;syslog</span><br><span class="line">SyslogIdentifier&#x3D;kibana4</span><br><span class="line">User&#x3D;root</span><br><span class="line">Group&#x3D;root</span><br><span class="line">Environment&#x3D;NODE_ENV&#x3D;production</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>

<p>上記保存します。</p>
<h2><span id="起動サービス登録">起動/サービス登録</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start kibana4</span><br><span class="line">$ sudo systemctl enable kibana4</span><br></pre></td></tr></table></figure>


<h2><span id="nginx-インストール">Nginx インストール</span></h2><p>以下参考にしてください。</p>
<a href="http://kenzo0107.hatenablog.com/entry/2015/08/20/232126" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="http://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20150820/20150820232103.png"></div><div class="descriptions"><div class="og-title">CentOS7 に Nginx インストール - 長生村本郷Engineers&#39;Blog</div><div class="og-description">Kibana構築用に書いときました。 環境 CentOS7 Nginxインストール Nginx用リポジトリ作成 # vim /etc/yum.repos.d/nginx.repo 以下追記 [nginx] name=nginx repo baseurl=http://nginx.…</div></div></div></a>



<h2><span id="nginx設定ファイル修正">Nginx設定ファイル修正</span></h2><p>リーバスプロキシでKibana4用ポート(5601)へ向ける。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  ec2-xx-xx-xxx-xxx.ap-northeast-1.compute.amazonaws.com;</span><br><span class="line"></span><br><span class="line">    auth_basic &quot;Restricted Access&quot;;</span><br><span class="line">    auth_basic_user_file &#x2F;etc&#x2F;nginx&#x2F;htpasswd.users;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;localhost:5601;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection &#39;upgrade&#39;;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_cache_bypass $http_upgrade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上設定保存後、Nginx再起動</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart nginx</span><br></pre></td></tr></table></figure>


<h2><span id="アクセスして確認">アクセスして確認</span></h2><p>以下のように表示されれば問題ありません。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20150820/20150820233520.png" width="100%">
</div>

<p>以上</p>
<h2><span id="参考記事">参考記事</span></h2><p><a href="https://enakai00.hatenablog.com/entry/20130917/1379374797">Systemd入門(4) - serviceタイプUnitの設定ファイル</a></p>
<h4><span id="起動スクリプトについて-各項目説明">起動スクリプトについて 各項目説明</span></h4><h5><span id="unit-について">[Unit] について</span></h5><table>
<thead>
<tr>
<th align="left"><em>オプション</em></th>
<th align="left"><em>説明</em></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Description</td>
<td align="left">Unitの説明文</td>
</tr>
<tr>
<td align="left">Documentation</td>
<td align="left">ドキュメントのURI</td>
</tr>
<tr>
<td align="left">Requires</td>
<td align="left">このUnitが必要とする前提Unit</td>
</tr>
<tr>
<td align="left">Wants</td>
<td align="left">このUnitが必要とする前提Unit</td>
</tr>
<tr>
<td align="left">After</td>
<td align="left">このUnitより先に起動するべきUnit</td>
</tr>
<tr>
<td align="left">Before</td>
<td align="left">このUnitより後に起動するべきUnit</td>
</tr>
</tbody></table>
<h5><span id="install-について">[Install] について</span></h5><table>
<thead>
<tr>
<th align="left"><em>オプション</em></th>
<th align="left"><em>説明</em></th>
</tr>
</thead>
<tbody><tr>
<td align="left">WantedBy</td>
<td align="left">enable時にこのUnitの.wantsディレクトリにリンク作成</td>
</tr>
<tr>
<td align="left">RequiredBy</td>
<td align="left">enable時にこのUnitの.requiredディレクトリにリンク作成</td>
</tr>
<tr>
<td align="left">Also</td>
<td align="left">enable/disable時に同時にenable/disableするUnit</td>
</tr>
<tr>
<td align="left">Alias</td>
<td align="left">enable時にこのUnitの別名を用意</td>
</tr>
</tbody></table>
<p>↓この本とってもお世話になりました♪</p>
<a href="https://www.amazon.co.jp/exec/obidos/ASIN/4774169838/kenzo0107-22/" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img></div><div class="descriptions"><div class="og-title">サーバ/インフラエンジニア養成読本 ログ収集~可視化編 [現場主導のデータ分析環境を構築!] (Software Design plus) | 鈴木 健太, 吉田 健太郎, 大谷 純, 道井 俊介 |本 | 通販 | Amazon</div><div class="og-description">Amazonで鈴木 健太, 吉田 健太郎, 大谷 純, 道井 俊介のサーバ/インフラエンジニア養成読本 ログ収集~可視化編 [現場主導のデータ分析環境を構築!] (Software Design plus)。アマゾンならポイント還元本が多数。鈴木 健太, 吉田 健太郎, 大谷 純…</div></div></div></a>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-08-19T15:00:00.000Z" title="2015-08-19T15:00:00.000Z">2015-08-20</time><span class="level-item">2分 read (About 282 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/08/19/2015-08-20-install-nginx-on-centos7/">CentOS7 に Nginx インストール</a></h1><div class="content"><p>Kibana構築用に書いときました。</p>
<h2><span id="環境">環境</span></h2><ul>
<li>CentOS7</li>
</ul>
<h2><span id="nginxインストール">Nginxインストール</span></h2><ul>
<li>Nginx用リポジトリ作成</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim &#x2F;etc&#x2F;yum.repos.d&#x2F;nginx.repo</span><br></pre></td></tr></table></figure>

<ul>
<li>以下追記</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[nginx]</span><br><span class="line">name&#x3D;nginx repo</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;nginx.org&#x2F;packages&#x2F;mainline&#x2F;centos&#x2F;7&#x2F;$basearch&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line">enabled&#x3D;1</span><br></pre></td></tr></table></figure>

<h4><span id="nginx-モジュールインストール">Nginx モジュールインストール</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install --enablerepo&#x3D;nginx nginx</span><br></pre></td></tr></table></figure>

<h5><span id="サービス登録">サービス登録</span></h5><p>サーバ起動時・再起動時にNginxが起動するようにします。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl disable httpd</span><br><span class="line">$ sudo systemctl enable nginx</span><br><span class="line">$ sudo systemctl start nginx</span><br><span class="line">$ systemctl status nginx</span><br><span class="line"></span><br><span class="line">nginx.service - nginx - high performance web server</span><br><span class="line">   Loaded: loaded (&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service; enabled)</span><br><span class="line">   Active: active (running) since Mon 2015-08-03 06:07:44 UTC; 2s ago</span><br><span class="line">     Docs: http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;</span><br><span class="line">  Process: 12642 ExecStart&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx -c &#x2F;etc&#x2F;nginx&#x2F;nginx.conf (code&#x3D;exited, status&#x3D;0&#x2F;SUCCESS)</span><br><span class="line">  Process: 12641 ExecStartPre&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx -t -c &#x2F;etc&#x2F;nginx&#x2F;nginx.conf (code&#x3D;exited, status&#x3D;0&#x2F;SUCCESS)</span><br><span class="line"> Main PID: 12645 (nginx)</span><br><span class="line">   CGroup: &#x2F;system.slice&#x2F;nginx.service</span><br><span class="line">           ├─12645 nginx: master process &#x2F;usr&#x2F;sbin&#x2F;nginx -c &#x2F;etc&#x2F;nginx&#x2F;nginx....</span><br><span class="line">           └─12646 nginx: worker process</span><br><span class="line"></span><br><span class="line">Aug 03 06:07:44 ip-172-31-19-253 systemd[1]: Starting nginx - high performan....</span><br><span class="line">Aug 03 06:07:44 ip-172-31-19-253 nginx[12641]: nginx: the configuration file...k</span><br><span class="line">Aug 03 06:07:44 ip-172-31-19-253 nginx[12641]: nginx: configuration file &#x2F;et...l</span><br><span class="line">Aug 03 06:07:44 ip-172-31-19-253 systemd[1]: Failed to read PID from file &#x2F;r...t</span><br><span class="line">Aug 03 06:07:44 ip-172-31-19-253 systemd[1]: Started nginx - high performanc....</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br></pre></td></tr></table></figure>

<h2><span id="アクセス確認">アクセス確認</span></h2><p>http://&lt;IPアドレス or ドメイン&gt;</p>
<p>以下のように表示されればOK</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20150820/20150820232103.png" width="100%">
</div>

<p>以上です。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-08-18T15:00:00.000Z" title="2015-08-18T15:00:00.000Z">2015-08-19</time><span class="level-item"><a class="link-muted" href="/categories/Go/">Go</a></span><span class="level-item">2分 read (About 225 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/08/18/2015-08-19-go-get-executable-file-not-found/">go get で 「exec: </a></h1><div class="content"><h2><span id="結論">結論</span></h2><p>bzrモジュールインストールした後、再度<code>go get</code>して問題なく動作しました。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y bzr</span><br></pre></td></tr></table></figure>



<h2><span id="概要">概要</span></h2><p>EC2のCentOS7で<br>以下のように <code>go get</code> した際に<code>bzrが見当たらない</code>というエラーが発生した。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ go get launchpad.net&#x2F;goamz&#x2F;aws</span><br><span class="line"></span><br><span class="line">[centos@ip-xxx-xx-xx-xx src]$ go get launchpad.net&#x2F;goamz&#x2F;aws</span><br><span class="line">go: missing Bazaar command. See http:&#x2F;&#x2F;golang.org&#x2F;s&#x2F;gogetcmd</span><br><span class="line">package launchpad.net&#x2F;goamz&#x2F;aws: exec: &quot;bzr&quot;: executable file not found in $PATH</span><br></pre></td></tr></table></figure>

<p>ちょこっとしたつまづきでした。</p>
<h2><span id="ちなみに">ちなみに</span></h2><p><code>bzr</code>はgitと同様、分散バージョン管理システムです。</p>
<p>今回インストールしようとしたPackageがBazaarで管理していたから必要になったのでしょう。</p>
<p>以下参照<br><a href="http://doc.bazaar.canonical.com/beta/ja/user-reference/index.html">Bazaarユーザーリファレンス</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-08-18T15:00:00.000Z" title="2015-08-18T15:00:00.000Z">2015-08-19</time><span class="level-item"><a class="link-muted" href="/categories/Go/">Go</a></span><span class="level-item">2分 read (About 250 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/08/18/2015-08-19-go-revel-fw-tls-handshake-error/">Golang Revelフレームワークエラー 「server.go:1775: http: TLS handshake error from 127.0.0.1:36799: tls: first record does not look like a TLS handshake」対応</a></h1><div class="content"><h2><span id="結論">結論</span></h2><p>[prod]モード以外で <code>http.ssl = true</code> とし起動すると発生するエラーでした。<br>その為、[prod]以外では <code>http.ssl = false</code> として起動することとしました。</p>
<h2><span id="概要">概要</span></h2><p>テスト環境で <code>app.conf</code> にて<code>[test]モード</code>を追加し<br>そこでオレオレSSL証明書作成してhttpsリンクの動作確認をしようとしてました。</p>
<p>ですが、起動こそするものの一向にアクセスできず汗</p>
<p>devモードではアクセス出来るのでその差分を見たところ、上記の結論に至りました。</p>
<h2><span id="エラー内容">エラー内容</span></h2><p>revel 起動しurlにアクセスすると以下のようなTLSハンドシェイクができずアクセスできない状況になる。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ revel run myapp test</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">INFO  2015&#x2F;08&#x2F;19 14:48:38 harness.go:165: Listening on :9000</span><br><span class="line">2015&#x2F;08&#x2F;19 14:48:40 server.go:1775: http: TLS handshake error from 127.0.0.1:36799: tls: first record does not look like a TLS handshake</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2015/08/18/2015-08-19-gosql-driver-mysql-created_at-utc/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20150819/20150819234635.gif" alt="go-sql-driver/mysqlでcreated_at (datetime) がUTCで登録されてしまう件"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2015-08-18T15:00:00.000Z" title="2015-08-18T15:00:00.000Z">2015-08-19</time><span class="level-item"><a class="link-muted" href="/categories/Go/">Go</a></span><span class="level-item">数秒 read (About 96 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/08/18/2015-08-19-gosql-driver-mysql-created_at-utc/">go-sql-driver/mysqlでcreated_at (datetime) がUTCで登録されてしまう件</a></h1><div class="content"><h2><span id="環境">環境</span></h2><ul>
<li>go-sql-driver/mysql version 1.2</li>
</ul>
<h2><span id="結論">結論</span></h2><p>以下のように <code>parseTime=true</code>と<code>loc=Asia%2FTokyo</code>を設定する。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db, err :&#x3D; sql.Open(&quot;mysql&quot;, &quot;user:passward@&#x2F;dbname?parseTime&#x3D;true&amp;loc&#x3D;Asia%2FTokyo&quot;)</span><br></pre></td></tr></table></figure>

<p><code>loc=xxxx</code>の指定がない場合、<code>local</code>が指定され、<br>datetimeにtime.Now()を指定してINSERTしても<br>UTC時間に書き直されてしまう。</p>
<p>ちょっとハマりました。</p>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/18/">前</a></div><div class="pagination-next"><a href="/page/20/">次</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/18/">18</a></li><li><a class="pagination-link is-current" href="/page/19/">19</a></li><li><a class="pagination-link" href="/page/20/">20</a></li></ul></nav>