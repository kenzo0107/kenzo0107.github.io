<!doctype html>
<html lang="ja"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>長生村本郷Engineers&#039;Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="長生村本郷Engineers&#039;Blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="長生村本郷Engineers&#039;Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="tech"><meta property="og:type" content="blog"><meta property="og:title" content="長生村本郷Engineers&#039;Blog"><meta property="og:url" content="https://kenzo0107.github.io/"><meta property="og:site_name" content="長生村本郷Engineers&#039;Blog"><meta property="og:description" content="tech"><meta property="og:locale" content="ja_JP"><meta property="og:image" content="https://kenzo0107.github.io/img/og_image.png"><meta property="article:author" content="Kenzo Tanaka"><meta property="article:tag" content="aws golang"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://kenzo0107.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://kenzo0107.github.io"},"headline":"長生村本郷Engineers'Blog","image":["https://kenzo0107.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Kenzo Tanaka"},"publisher":{"@type":"Organization","name":"長生村本郷Engineers'Blog","logo":{"@type":"ImageObject","url":"https://kenzo0107.github.io/img/logo.svg"}},"description":"tech"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-162026478-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-162026478-1');</script><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><script data-ad-client="ca-pub-6265337967545472" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="長生村本郷Engineers'Blog" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="長生村本郷Engineers&#039;Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/2013/12/31/PrivacyPolicy/">PrivacyPolicy</a><a class="navbar-item" href="/2013/12/31/about/">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/kenzo0107"><i class="fab fa-github"></i></a><a class="navbar-item search" title="検索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main"><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/08/08/2016-08-09-allow-ip-under-the-maintenance/"><img class="fill" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160809/20160809105400.gif" alt="メンテ時に社内Wifi IPのみサイトアクセス許可する"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">2016-08-09</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/08/08/2016-08-09-allow-ip-under-the-maintenance/">メンテ時に社内Wifi IPのみサイトアクセス許可する</a></h1><div class="content"><p>備忘録です。</p>
<p>サイトメンテナンスする際の手順をまとめています。</p>
<h2><span id="手順">手順</span></h2><h3><span id="maintenancehtml">maintenance.html</span></h3><p>DocumentRoot に maintenance.html を配置</p>
<h3><span id="htaccess-にてアクセス制限">.htaccess にてアクセス制限</span></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ErrorDocument 503 /maintenance.html</span><br><span class="line"></span><br><span class="line">&lt;IfModule mod_rewrite.c&gt;</span><br><span class="line">  RewriteEngine On</span><br><span class="line">  RewriteCond %&#123;REQUEST_URI&#125; !^.*\.(js|css|gif|jpg|png|ico)$</span><br><span class="line">  RewriteCond %&#123;REQUEST_URI&#125; !^/cron/.*$</span><br><span class="line">  RewriteCond %&#123;REQUEST_URI&#125; !=/maintenance.html</span><br><span class="line">  # 社内</span><br><span class="line">  RewriteCond %&#123;REMOTE_ADDR&#125; !=&lt;社内Wifi IP&gt;</span><br><span class="line">  RewriteCond %&#123;REMOTE_ADDR&#125; !=&lt;社内Wifi IP&gt;</span><br><span class="line">  RewriteRule ^.*$ - [R=503,L]</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>

<p>以上です。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/08/03/2016-08-04-detect-face-triming-sample/"><img class="fill" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160809/20160809105400.gif" alt="複数画像ファイルから顔検知し顔部分をトリミングしたサンプルを集める"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">2016-08-04</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/08/03/2016-08-04-detect-face-triming-sample/">複数画像ファイルから顔検知し顔部分をトリミングしたサンプルを集める</a></h1><div class="content"><h2><span id="前回">前回</span></h2><p>画像ファイルを指定し<br>顔検知させる機能を実装しました。</p>
<a href="http://kenzo0107.hatenablog.com/entry/2016/08/01/215648" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160801/20160801143015.png"></div><div class="descriptions"><div class="og-title">顔検出 3分クッキング on MacOSX  - 長生村本郷Engineers&#39;Blog</div><div class="og-description">以下に移行しました。 kenzo0107.github.io</div></div></div></a>

<h2><span id="今回">今回</span></h2><p>まずはサンプル画像を集めます。<br>自分はネット上から BeautifulSoup でスクレイピングして落としてみました。<br>(スクリプトまとめたら公開します)</p>
<p>適当に 13 枚。<br>ゆくゆくは機械学習したいのでもっと欲しいところですが<br>今回はスクリプトの紹介がメインなので<br>この程度で。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160804/20160804142005.png" width="100%">
</div>

<h2><span id="顔部分トリミング">顔部分トリミング</span></h2><p>スクリプトです。(for Python 3)</p>
<script src="//gist.github.com/kenzo0107/517258ab06715f73c4a3457e87fd25a5.js"></script>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// clone</span><br><span class="line">$ git clone https://gist.github.com/kenzo0107/517258ab06715f73c4a3457e87fd25a5</span><br><span class="line">$ cd 517258ab06715f73c4a3457e87fd25a5</span><br><span class="line"></span><br><span class="line">// スクリプト実行</span><br><span class="line">$ python collect_face_samples.py -p &lt;サンプル画像が格納されているディレクトリ&gt;</span><br></pre></td></tr></table></figure>

<p>実際スクリプト実行した様子です。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160804/20160804143008.png" width="100%">
</div>

<p><code>_trimming</code> フォルダにトリミングされた画像群が格納されているのがわかります。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160804/20160804142513.png" width="100%">
</div>

<p>以下 No 順に格納されていきます。</p>
<table>
<thead>
<tr>
<th>No</th>
<th>Item</th>
<th>Explain</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>_resize</td>
<td>大小さまざまな画像サイズを一定して高さ 500 以下の画像にリサイズします。</td>
</tr>
<tr>
<td>2</td>
<td>_addbox</td>
<td>顔周りに囲い画像が追加された画像が格納されます。各画像でどこが顔として検知されたかの確認用です。</td>
</tr>
<tr>
<td>2</td>
<td>_trimming</td>
<td>_addbox に格納されているファイルの顔部分をトリミングした画像を 64×64 サイズにリサイズし<br>且つ、数度回転させた画像が格納されています。</td>
</tr>
</tbody></table>
<p>これでサンプル集めが捗れば何よりです。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">2016-07-29</span><span class="level-item">Updated&nbsp;<time dateTime="2020-05-07T03:41:26.324Z" title="5/7/2020, 3:41:26 AM">2020-05-07</time></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/07/28/2016-07-29-error-key-read-uudecode/">cat id_rsa.pub &gt;&gt; authorized_keys したつもりが error key_read: uudecode が出るエラー対応</a></h1><div class="content"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tail -f &#x2F;var&#x2F;log&#x2F;secure</span><br></pre></td></tr></table></figure>

<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160729/20160729111616.png" width="100%">
</div>

<h2><span id="結論">結論</span></h2><p>「/n」 が入ってしまっていました。<br>「/n」削除すれば問題なくなりました。</p>
<p>多少編集した際に混入させてしまったのかも。。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/07/27/2016-07-28-setup-python2-python3-on-macos/"><img class="fill" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160728/20160728142804.jpg" alt="MacOSX に Python2, Python3 仮想環境構築"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">2016-07-28</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/07/27/2016-07-28-setup-python2-python3-on-macos/">MacOSX に Python2, Python3 仮想環境構築</a></h1><div class="content"><h2><span id="経緯">経緯</span></h2><p>MacOSX デフォルトでは python 2 系。</p>
<p>python 2.7 は 2020 年までのサポート なので<br>python 3 系 に慣れておこうということで<br>3 系環境を構築しようと思いました。</p>
<p>ですが<br><a target="_blank" rel="noopener" href="http://dlib.net/">dlib</a> など Python 2 系でないとうまく設定ができなかった経緯があり<br>(※自分の不手際の可能性もありますが)<br>両方残そうということで両仮想環境を構築します。</p>
<h2><span id="環境">環境</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sw_vers</span><br><span class="line"></span><br><span class="line">ProductName:    Mac OS X</span><br><span class="line">ProductVersion: 10.11.5</span><br><span class="line">BuildVersion:   15F34</span><br></pre></td></tr></table></figure>

<h2><span id="homebrew-インストール">Homebrew インストール</span></h2><p>以下オフィシャルサイト参照してください。</p>
<p><a target="_blank" rel="noopener" href="http://brew.sh/index_ja.html">Homebrew Ja</a></p>
<h2><span id="python2-3-インストール">Python2, 3 インストール</span></h2><p>2016/07/28 現在、 python = 2.7.10, python3 = 3.4.3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install python python3 pyenv</span><br></pre></td></tr></table></figure>

<h2><span id="設定ファイル">設定ファイル</span></h2><p>.bashrc もしくは .zshrc に追記します。</p>
<p>以下仮に .bashrc とします。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vi ~/.bashrc</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export PYENV_ROOT=&quot;$HOME/.pyenv&quot;</span><br><span class="line">export PATH=&quot;$PYENV_ROOT/bin:$PATH&quot;</span><br><span class="line">eval &quot;$(pyenv init -)&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>設定読み込み</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ source ~/.bashrc</span><br></pre></td></tr></table></figure>

<h2><span id="virtualenv-インストール">virtualenv インストール</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo easy_install virtualenv</span><br></pre></td></tr></table></figure>

<h2><span id="仮想環境構築">仮想環境構築</span></h2><ul>
<li>python2 での仮想環境構築</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ which python</span><br><span class="line"></span><br><span class="line">/usr/local/bin/python2.7</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ virtualenv -p /usr/local/bin/python2.7 ~/py2env</span><br></pre></td></tr></table></figure>

<ul>
<li>python3 での仮想環境構築</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ which python3</span><br><span class="line"></span><br><span class="line">/usr/local/bin/python3</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ virtualenv -p /usr/local/bin/python3 ~/py3env</span><br></pre></td></tr></table></figure>

<h2><span id="仮想環境切り替え">仮想環境切り替え</span></h2><ul>
<li>Python 2.7 仮想環境へ切り替え</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ source ~/py2env/bin/active</span><br></pre></td></tr></table></figure>

<ul>
<li>Python 3.4 仮想環境へ切り替え</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ source ~/py3env/bin/active</span><br></pre></td></tr></table></figure>

<p>今更ですが備忘録的まとめでした。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/07/13/2016-07-14-zabbix-reactio/"><img class="fill" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160728/20160728142804.jpg" alt="Zabbix + Reactio 連携"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">2016-07-14</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/07/13/2016-07-14-zabbix-reactio/">Zabbix + Reactio 連携</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>Reactio の無料化によりその機能が解放され、様々な監視・アラートツールとの連携が可能になりました。<br>これを機に Zabbix + Reactio 連携したのでまとめました。</p>
<p><a target="_blank" rel="noopener" href="http://blog.reactio.jp/entry/2016/07/04/090000">Reactio が無料になります</a></p>
<h2><span id="環境">環境</span></h2><ul>
<li>Zabbix 3.0</li>
<li>CentOS Linux release 7.2.1511 (Core)</li>
</ul>
<p>Zabbix 3.0 がインストールされ起動されていることを前提とします。</p>
<h2><span id="zabbix-管理画面で-host-設定">Zabbix 管理画面で Host 設定</span></h2><p><span style="color:#A9E2F3">※既に設定されている場合はスキップしてください。</span></p>
<p>Configuration &gt; Hosts &gt; create</p>
<ul>
<li>Host name: Project1</li>
</ul>
<img src="http://i.imgur.com/12vbmdE.png" width="400px">

<h2><span id="reactio-プロジェクト作成">Reactio プロジェクト作成</span></h2><p>プロジェクト毎にインシデントを管理します。</p>
<p>https://<code>&lt;Organization ID&gt;</code>.reactio.jp/settings/project</p>
<p>Zabbix 管理画面で設定している Host 名を Project 名とします。</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/f9YS11z.png" width="100%">
</div>

<h2><span id="reactio-api-発行">Reactio API 発行</span></h2><p>プロジェクト作成ページと同ページ内にある API 項目の 「+」ボタンクリックし API KEY 発行します。</p>
<div style="text-align:center;">
<img src="http://i.imgur.com/knN5mkT.png" width="100%">
</div>

<div style="text-align:center;">
<img src="http://i.imgur.com/HvjKrvQ.png" width="100%">
</div>

<h2><span id="zabbix-reactio-インストール">zabbix-reactio インストール</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/lib/zabbix/alertscripts</span><br><span class="line">$ git clone http://github.com/zabbix-reactio</span><br></pre></td></tr></table></figure>

<h2><span id="zabbix-db-情報-と-reactio-で作成した-project-と-発行した-api-key-を設定ファイルに設定">Zabbix DB 情報 と Reactio で作成した Project と 発行した API KEY を設定ファイルに設定</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/lib/zabbix/alertscripts/zabbix-reactio</span><br><span class="line">$ vi config.inc</span><br></pre></td></tr></table></figure>

<ul>
<li>db_info に DB 情報設定</li>
<li><code>&lt;Organization ID&gt;</code> 設定</li>
<li>Project = API KEY 設定</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[db_info]</span><br><span class="line">host = &lt;DB Host&gt;</span><br><span class="line">user = &lt;DB user&gt;</span><br><span class="line">pass = &lt;DB pass&gt;</span><br><span class="line">db   = &lt;DB name&gt;</span><br><span class="line"></span><br><span class="line">[reactio_url]</span><br><span class="line">default = https://&lt;Organization ID&gt;.reactio.jp/api/v1/incidents</span><br><span class="line"></span><br><span class="line">[api_key]</span><br><span class="line">Project1 = &lt;Project1&#x27;s API KEY&gt;</span><br><span class="line">Project2 = &lt;Project2&#x27;s API KEY&gt;</span><br><span class="line">Project3 = &lt;Project3&#x27;s API KEY&gt;</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2><span id="db-カラム追加">DB カラム追加</span></h2><ul>
<li>Zabbix alerts テーブルに Reactio Incident ID カラムを追加します。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/lib/zabbix/alertscripts/zabbix-reactio</span><br><span class="line">$ mysql -h &lt;DB Host&gt; -u &lt;DB user&gt; -p&lt;DB pass&gt; &lt;DB name&gt; -e &quot;`cat add_reactioincidentid.sql`&quot;</span><br><span class="line">$ mysql -h &lt;DB Host&gt; -u &lt;DB user&gt; -p&lt;DB pass&gt; &lt;DB name&gt; -e &quot;SHOW COLUMNS FROM alerts&quot;</span><br><span class="line"></span><br><span class="line">+---------------------+---------------------+------+-----+---------+-------+</span><br><span class="line">| Field               | Type                | Null | Key | Default | Extra |</span><br><span class="line">+---------------------+---------------------+------+-----+---------+-------+</span><br><span class="line">| alertid             | bigint(20) unsigned | NO   | PRI | NULL    |       |</span><br><span class="line">| actionid            | bigint(20) unsigned | NO   | MUL | NULL    |       |</span><br><span class="line">| eventid             | bigint(20) unsigned | NO   | MUL | NULL    |       |</span><br><span class="line">| userid              | bigint(20) unsigned | YES  | MUL | NULL    |       |</span><br><span class="line">| clock               | int(11)             | NO   | MUL | 0       |       |</span><br><span class="line">| mediatypeid         | bigint(20) unsigned | YES  | MUL | NULL    |       |</span><br><span class="line">| sendto              | varchar(100)        | NO   |     |         |       |</span><br><span class="line">| subject             | varchar(255)        | NO   |     |         |       |</span><br><span class="line">| message             | text                | NO   |     | NULL    |       |</span><br><span class="line">| status              | int(11)             | NO   | MUL | 0       |       |</span><br><span class="line">| retries             | int(11)             | NO   |     | 0       |       |</span><br><span class="line">| error               | varchar(128)        | NO   |     |         |       |</span><br><span class="line">| esc_step            | int(11)             | NO   |     | 0       |       |</span><br><span class="line">| alerttype           | int(11)             | NO   |     | 0       |       |</span><br><span class="line">| reactio_incident_id | int(11)             | NO   |     | 0       |       |    ← 追加されているのが確認できます</span><br><span class="line">+---------------------+---------------------+------+-----+---------+-------+</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Reacito では全てのインシデントは ID で管理されています。<br>Zabbix で障害アラート通知時に Reactio インシデント作成 API をコールし インシデント ID を保存します。</p>
<p>このインシデント ID は Zabbix で障害回復アラート通知時に Reatio インシデントステータス更新 API をコールする際に利用します。</p>
</blockquote>
<h2><span id="zabbix-media-types-reactio-作成">Zabbix Media types: Reactio 作成</span></h2><p>Administration &gt; Media types <code>Create media type</code> ボタンクリック</p>
<img src="http://i.imgur.com/iSOhzpP.png" width="400px">

<img src="http://i.imgur.com/0OXYfbW.png" width="400px">

<p>以下値を入力し <code>Add</code> ボタンクリック</p>
<table>
<thead>
<tr>
<th><em>Item</em></th>
<th><em>Value</em></th>
</tr>
</thead>
<tbody><tr>
<td>Name</td>
<td>Reactio</td>
</tr>
<tr>
<td>Type</td>
<td>Script</td>
</tr>
<tr>
<td>Script name</td>
<td>zabbix-reactio/reactio.php</td>
</tr>
<tr>
<td>Script Parameters 1</td>
<td>{ALERT.SUBJECT}</td>
</tr>
<tr>
<td>Script Parameters 2</td>
<td>{ALERT.MESSAGE}</td>
</tr>
</tbody></table>
<h2><span id="zabbix-users-reactio-作成">Zabbix Users: Reactio 作成</span></h2><p>Administration &gt; Users <code>Create media type</code> ボタンクリック</p>
<img src="http://i.imgur.com/Bf5bqkc.png" width="400px">

<ul>
<li>Reactio ユーザ作成</li>
</ul>
<img src="http://i.imgur.com/n8aZiyV.png" width="400px">

<ul>
<li>Media タブをクリックし Media 情報入力</li>
</ul>
<img src="http://i.imgur.com/6yAyEe5.png" width="400px">

<img src="http://i.imgur.com/VOKOpZI.png" width="400px">

<ul>
<li>Permission タブをクリックし Zabbix Super Admin 選択</li>
</ul>
<img src="http://i.imgur.com/cpZkPUT.png" width="200px">

<ul>
<li>Add ボタン クリックし一覧に表示されることを確認</li>
</ul>
<img src="http://i.imgur.com/5ubxAKL.png" width="800px">

<h2><span id="zabbix-actions-reactio-notification-作成">Zabbix Actions: Reactio Notification 作成</span></h2><p>Configuration &gt; Actions Create ボタンクリック</p>
<img src="http://i.imgur.com/DDQcmrG.png" width="400px">

<ul>
<li>Action タブ選択し Action 情報入力</li>
</ul>
<img src="http://i.imgur.com/6hi0LPf.png" width="400px">

<table>
<thead>
<tr>
<th><em>Item</em></th>
<th><em>Value</em></th>
</tr>
</thead>
<tbody><tr>
<td>Name</td>
<td>Reactio Notification</td>
</tr>
<tr>
<td>Default subject</td>
<td>PROBLEM alert - {TRIGGER.NAME} is {TRIGGER.STATUS}</td>
</tr>
<tr>
<td>Default message</td>
<td>HOST: {HOST.NAME}<br>TRIGGER_NAME: {TRIGGER.NAME}<br>TRIGGER_STATUS: {TRIGGER.STATUS}<br><b>TRIGGER_SEVERITY: {TRIGGER.SEVERITY}<br>DATETIME: {DATE} / {TIME}<br>ITEM_ID: {ITEM.ID1}<br>ITEM_NAME: {ITEM.NAME1}<br>ITEM_KEY: {ITEM.KEY1}<br>ITEM_VALUE: {ITEM.VALUE1}<br>EVENT_ID: {EVENT.ID}<br>TRIGGER_URL: {TRIGGER.URL}</b></td>
</tr>
<tr>
<td>Recovery message</td>
<td>チェック</td>
</tr>
<tr>
<td>Recovery subject</td>
<td>RECOVERY alert - {TRIGGER.NAME} is {TRIGGER.STATUS}</td>
</tr>
<tr>
<td>Recovery message</td>
<td>HOST: {HOST.NAME}<br>TRIGGER_NAME: {TRIGGER.NAME}<br>TRIGGER_STATUS: {TRIGGER.STATUS}<br>TRIGGER_SEVERITY: {TRIGGER.SEVERITY}<br>DATETIME: {DATE} / {TIME}<br>ITEM_ID: {ITEM.ID1}<br>ITEM_NAME: {ITEM.NAME1}<br>ITEM_KEY: {ITEM.KEY1}<br>ITEM_VALUE: {ITEM.VALUE1}<br>EVENT_ID: {EVENT.ID}<br>TRIGGER_URL: {TRIGGER.URL}</td>
</tr>
<tr>
<td>Enabled</td>
<td>チェック</td>
</tr>
</tbody></table>
<p>以下項目から判断して Reactio API を叩いてます。</p>
<ul>
<li>subject の PROBLEM/RECOVERY</li>
<li>HOST: {HOST.NAME}</li>
<li>EVENT_ID: {EVENT.ID}</li>
</ul>
<p><span style="color:red">メッセージを整形する場合でも、 上記項目は残しておくようにしてください。</span></p>
<ul>
<li>Operations タブ選択し Operations 情報入力</li>
</ul>
<img src="https://i.imgur.com/r7MXmVg.png" width="300px">

<img src="https://i.imgur.com/Sx36MPZ.png" width="400px">

<img src="https://i.imgur.com/bv5hcoM.png" width="400px">

<p>以上 Zabbix で Reactio 連携設定完了しました。</p>
<h2><span id="実行結果">実行結果</span></h2><ul>
<li>インシデント作成できた！</li>
<li>作成したインシデントのステータスが更新された！</li>
</ul>
<div style="text-align:center;">
<img src="https://i.imgur.com/zWJpmAi.png" width="100%">
</div>

<h2><span id="今後">今後</span></h2><p>当方、運用し始めです。<br>障害レベルによってメッセージを変更したりと今後更新検討致します。</p>
<p>是非以下も合わせて Zabbix-Slack 連携もご利用ください。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/kenzo0107/zabbix3-slack">zabbix3-slack</a></p>
<p>以上<br>ご清聴ありがとうございました。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">2016-07-12</span><span class="level-item">Updated&nbsp;<time dateTime="2020-05-07T03:41:26.222Z" title="5/7/2020, 3:41:26 AM">2020-05-07</time></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/07/11/2016-07-12-setup-raspberrypi3b-jessie/">Raspberry Pi 3 B に Raspberry Jessie セットアップ</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>Amazon Prime 会員の無料体験版で<br>Raspberry Pi 3 B 買いました♪</p>
<p>開発 Ready な状態を作るべく<br>そのセットアップ方法をまとめました。</p>
<h2><span id="環境">環境</span></h2><ul>
<li>MacBook Pro : MacOSX 10.11.5</li>
<li>Wifi 環境</li>
</ul>
<h2><span id="買ったもの">買ったもの</span></h2><p>以下最低限必要なものです。</p>
<p>計 8,459円</p>
<ul>
<li>Raspberry Pi 3 Model B (ケース付き): 5,980円</li>
</ul>
<a href="https://www.amazon.co.jp/exec/obidos/ASIN/B01CSFZ4JG/kenzo0107-22/" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img></div><div class="descriptions"><div class="og-title">Amazon.co.jp： Raspberry Pi3 Model B ボード＆ケースセット 3ple Decker対応 (Clear)-Physical Computing Lab: パソコン・周辺機器</div><div class="og-description">Amazon.co.jp： Raspberry Pi3 Model B ボード＆ケースセット 3ple Decker対応 (Clear)-Physical Computing Lab: パソコン・周辺機器</div></div></div></a>

<ul>
<li>SD カード (32GB) : 1,080円</li>
</ul>
<a href="https://www.amazon.co.jp/exec/obidos/ASIN/B008UR8TS0/kenzo0107-22/" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img></div><div class="descriptions"><div class="og-title">Amazon | 旧モデル Transcend microSDHCカード 4GB Class10 TS4GUSDHC10 | トランセンドジャパン | パソコン・周辺機器 通販</div><div class="og-description">旧モデル Transcend microSDHCカード 4GB Class10 TS4GUSDHC10がパソコン・周辺機器ストアでいつでもお買い得。当日お急ぎ便対象商品は、当日お届け可能です。アマゾン配送商品は、通常配送無料（一部除く）。</div></div></div></a>

<ul>
<li>電源 (2.5A対応): 1,399円</li>
</ul>
<a href="https://www.amazon.co.jp/exec/obidos/ASIN/B01E6YLFAO/kenzo0107-22/" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img></div><div class="descriptions"><div class="og-title">Amazon | KuGi Raspberry Pi 3 Model B チャージャー ラズベリー・パイ 3 Model B 超小型パソコン 適用 充電器 5V 2.5A アダプタ Raspberry Pi 2 Model B &amp; Pi Model B+ とも対応 ブラック | KuGi | パソコン・周辺機器 通販</div><div class="og-description">KuGi Raspberry Pi 3 Model B チャージャー ラズベリー・パイ 3 Model B 超小型パソコン 適用 充電器 5V 2.5A アダプタ Raspberry Pi 2 Model B &amp; Pi Model B+ とも対応 ブラックがパソコン・周辺機器スト…</div></div></div></a>

<p>電源はPCのUSBポートからでも良いかな、と思ってましたが<br>Pi3Bの推奨電流が 2.5 A となった為、2.5 A 対応電源が必要になりました。</p>
<p>その他</p>
<p>大体持ち合わせてるのでは、と思います。<br>会社のゴミ山に捨ててあるのではないでしょうか。</p>
<ul>
<li>HDMI ケーブル : 691円</li>
</ul>
<a href="https://www.amazon.co.jp/exec/obidos/ASIN/B00HQY7U56/kenzo0107-22/" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img></div><div class="descriptions"><div class="og-title">Amazon | エレコム HDMI ケーブル スーパースリム 1m ハイスピード 【 Nintendo Switch 対応 】 4K 3DフルHD イーサネット対応 ブラック DH-HD14SS10BK | エレコム | 家電＆カメラ</div><div class="og-description">エレコム HDMI ケーブル スーパースリム 1m ハイスピード 【 Nintendo Switch 対応 】 4K 3DフルHD イーサネット対応 ブラック DH-HD14SS10BKが家電＆カメラストアでいつでもお買い得。当日お急ぎ便対象商品は、当日お届け可能です。アマゾン配…</div></div></div></a>

<ul>
<li>USBキーボード : 530円</li>
</ul>
<a href="https://www.amazon.co.jp/exec/obidos/ASIN/B005LL9J9G/kenzo0107-22/" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img></div><div class="descriptions"><div class="og-title">Amazon | サンワサプライ 有線USBキーボード 標準日本語配列 メンブレン ブラック SKB-L1UBK | サンワサプライ | パソコン用キーボード 通販</div><div class="og-description">サンワサプライ 有線USBキーボード 標準日本語配列 メンブレン ブラック SKB-L1UBKがパソコン用キーボードストアでいつでもお買い得。当日お急ぎ便対象商品は、当日お届け可能です。アマゾン配送商品は、通常配送無料（一部除く）。</div></div></div></a>

<ul>
<li>USBマウス : 698円</li>
</ul>
<a href="https://www.amazon.co.jp/exec/obidos/ASIN/B005EJH6RW/kenzo0107-22/" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img></div><div class="descriptions"><div class="og-title">Amazon | Amazonベーシック マウス USB有線 ブラック | Amazonベーシック(AmazonBasics) | パソコン・周辺機器 通販</div><div class="og-description">Amazonベーシック マウス USB有線 ブラックがパソコン・周辺機器ストアでいつでもお買い得。当日お急ぎ便対象商品は、当日お届け可能です。アマゾン配送商品は、通常配送無料（一部除く）。</div></div></div></a>


<p>その他含めても 10,378円。こりゃやるっきゃない。</p>
<p>早速セットアップ手順へ</p>
<h2><span id="sdカード-フォーマット">SDカード フォーマット</span></h2><h3><span id="sd-カードフォーマットアプリ-インストール">SD カードフォーマットアプリ インストール</span></h3><p>以下サイトからSDカードフォーマッターアプリをダウンロードしフォーマットします。</p>
<p><a target="_blank" rel="noopener" href="https://www.sdcard.org/downloads/formatter/">SD Memory Card Formatter</a></p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160710/20160710180905.png" width="100%">
</div>

<p>Macであれば <code>for Mac</code> を選択し<br>同意してダウンロードします。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160710/20160710181230.png" width="100%">
</div>

<h3><span id="ファイルシステム確認">ファイルシステム確認</span></h3><p>フォーマットするSDカードがどれか知る必要がある為、<br>SDカードを差し込む前にターミナルから以下実行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> df -h</span></span><br></pre></td></tr></table></figure>

<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160710/20160710182258.png" width="100%">
</div>

<h4><span id="sdカードをmacに差し込む">SDカードをMacに差し込む</span></h4><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160710/20160710181732.jpg" width="100%">
</div>

<p>※MacBook AirではSDカード差し込み口がないのでカードリーダで読込みます。</p>
<a href="https://www.amazon.co.jp/exec/obidos/ASIN/B00WFTCE0I/kenzo0107-22/" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img></div><div class="descriptions"><div class="og-title">Amazon | サンワサプライ アウトレット USB3.0 カードリーダー ブラック ADR-3ML35BK 箱にキズ、汚れのあるアウトレット 品です。 | サンワサプライ | 外付メモリカードリーダー 通販</div><div class="og-description">サンワサプライ アウトレット USB3.0 カードリーダー ブラック ADR-3ML35BK 箱にキズ、汚れのあるアウトレット 品です。が外付メモリカードリーダーストアでいつでもお買い得。当日お急ぎ便対象商品は、当日お届け可能です。アマゾン配送商品は、通常配送無料（一部除く）。</div></div></div></a>

<p>もう一度 <code>df -h</code> すると<br>新たに追加されたのが SDカード のファイルシステムです。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160710/20160710183107.png" width="100%">
</div>

<h3><span id="sdformatter-でフォーマット">SDFormatter でフォーマット</span></h3><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160710/20160710184814.png" width="100%">
</div>

<p>※ 自分は名前を「RASP3B」としました。</p>
<p>もう一度 <code>df -h</code></p>
<p>ディスクイメージ名が変更されているのがわかります。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160710/20160710185115.png" width="100%">
</div>

<p>以上でSDカードフォーマット完了です。</p>
<h2><span id="ディスクイメージに-raspbian-jessie-latest-os-を書き込み">ディスクイメージに Raspbian Jessie (Latest OS) を書き込み</span></h2><h3><span id="raspbian-jessie-ダウンロード">Raspbian Jessie ダウンロード</span></h3><p>オフィシャルサイトから最新 Raspbian OS をインストールします。<br>数分掛かります。</p>
<p><a target="_blank" rel="noopener" href="https://www.raspberrypi.org/downloads/raspbian/">Raspbian</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ~/Downloads</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> unzip 2016-05-27-raspbian-jessie.zip</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls -al 2016-05-27-raspbian-jessie.*</span></span><br><span class="line">-rw-r--r--@ 1 kenzo  staff  4019191808  5 27 20:50 2016-05-27-raspbian-jessie.img</span><br><span class="line">-rw-r--r--@ 1 kenzo  staff  1393896178  7 10 19:27 2016-05-27-raspbian-jessie.zip</span><br></pre></td></tr></table></figure>

<h3><span id="アンマウント">アンマウント</span></h3><p>先ほど確認した ファイルシステム名 <code>/dev/disk2s1</code> から <code>s1</code> を取り除いた、<br>イメージ対象をアンマウントする</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> diskutil umountDisk /dev/disk2</span></span><br></pre></td></tr></table></figure>

<h3><span id="ダウンロードしたイメージを書き込み">ダウンロードしたイメージを書き込み</span></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo dd <span class="keyword">if</span>=/Users/&lt;User&gt;/Downloads/2016-05-27-raspbian-jessie.img of=/dev/rdisk2 bs=1m</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>disk2</code> に <code>r</code> を頭に足すとアンバッファモードで実行し速度アップします。</li>
<li>bs=1m … 1度に書き込むサイズ</li>
</ul>
<p>257 秒かかった 汗</p>
<p>以上で Raspberry Pi に挿す SDカード が作成できました。</p>
<h3><span id="sdカード取り出し">SDカード取り出し</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ diskutil eject &#x2F;dev&#x2F;disk2</span><br></pre></td></tr></table></figure>

<h2><span id="raspberry-pi-3-に-各種接続">Raspberry PI 3 に 各種接続</span></h2><p><span style="color:red">全て接続し終わるまでRaspberry Pi に電流を流さないでください。</span></p>
<h3><span id="sdカード挿入">SDカード挿入</span></h3><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711220046.png" width="100%">
</div>

<h3><span id="usbキーボードマウス-sdカード-電源-接続">USBキーボード・マウス、SDカード、電源 接続</span></h3><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711220523.png" width="100%">
</div>

<p>全てが深く刺さっているのを確認した後<br>いよいよ電源を電源アダプタに接続します。</p>
<p>ついた！</p>
<p>なにやら読み込みが始まった！</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711221146.jpg" width="100%">
</div>

<p>※我が家はテレビがディスプレイ代わりです。</p>
<p>おぉ〜GUIのトップ画面がでてきた！</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711221153.jpg" width="100%">
</div>

<p>まず成功♪</p>
<h2><span id="raspberry-pi-各種設定">Raspberry Pi 各種設定</span></h2><h4><span id="menu-gt-preferences-gt-raspberry-pi-configuration-クリック">Menu &gt; Preferences &gt; Raspberry Pi Configuration  クリック</span></h4><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711230714.jpg" width="100%">
</div>

<h4><span id="sdカードの全容量を利用可能にする">SDカードの全容量を利用可能にする</span></h4><ul>
<li><code>System</code> タブの <code>Expand Filesystem</code> ボタンクリック</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711231408.png" width="100%">
</div>

<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711231657.png" width="100%">
</div>

<p>以上でSDカードの全容量を利用可能になります。</p>
<h4><span id="locale設定">Locale設定</span></h4><ul>
<li><code>Localisation</code> タブの <code>Set Locale</code> ボタンをクリックします。</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711231758.png" width="100%">
</div>

<ul>
<li><code>Language</code> : ja (Japanese) 選択</li>
<li><code>Country</code> : JP (Japan) 選択</li>
<li><code>Character Set</code> : UTF-8 選択</li>
</ul>
<p>上記選択し <code>OK</code> ボタンクリック</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711232125.png" width="100%">
</div>

<h4><span id="timezone設定">Timezone設定</span></h4><ul>
<li><code>Localisation</code> タブ &gt; <code>Set Timezone</code> ボタン クリック</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711232531.png" width="100%">
</div>

<p>再度 <code>Set Timezone</code> ボタンをクリックすると Asia/Tokyo が選択されています。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711232604.jpg" width="100%">
</div>

<h4><span id="キーボード設定">キーボード設定</span></h4><ul>
<li><p><code>Localisation</code> タブの <code>Set Keyboard</code> ボタンをクリック</p>
</li>
<li><p><code>Country</code> : <code>Japan</code> 選択</p>
</li>
<li><p><code>Variant</code> : <code>Japanese</code> 選択</p>
</li>
</ul>
<p>以上選択し<code>OK</code> ボタンクリック</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711232741.jpg" width="100%">
</div>

<h4><span id="wifi-設定">Wifi 設定</span></h4><ul>
<li>Wifi 選択しパスフレーズ入力し Wifi接続</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711233030.png" width="100%">
</div>

<ul>
<li>Wifi 接続が確認できます</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711233304.png" width="100%">
</div>

<h3><span id="macos-raspberry-pi-ssh-接続">MacOS → Raspberry Pi SSH 接続</span></h3><ul>
<li>Raspberry Pi で Terminal 起動</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ifconfig</span></span><br></pre></td></tr></table></figure>

<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160712/20160712000448.png" width="100%">
</div>

<ul>
<li>Mac から raspberry pi に SSH接続</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[MacOSX local]$ ssh pi@192.168.xxx.xxx</span><br><span class="line">pi@192.168.11.18's password: &lt;デフォルトパスワードは "raspberry"&gt;</span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line">individual files in /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Last login: Mon Jul 11 23:08:51 2016</span><br></pre></td></tr></table></figure>

<p>SSH ログインが確認できました！</p>
<h2><span id="追記-2016-07-08">追記 (2016-07-08)</span></h2><p>あとあと気づいたのだけど<br>わざわざ画面をiPhoneで撮影せずとも<br>Remote Desktop して綺麗なものを取ればよかった。。</p>
<p>ということで<br>SSH ついでに Remote Desktop 機能を要する tightvncserver インストール</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install tightvncserver</span><br><span class="line">$ vncserver</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 起動</span><br><span class="line">$ vncserver :1</span><br></pre></td></tr></table></figure>

<ul>
<li>設定したホスト名を指定してRemote Desktop し画面共有</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vnc://raspberrypi.local:5901</span><br></pre></td></tr></table></figure>

<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160712/20160712002819.png" width="100%">
</div>


<h3><span id="ブラウザを開いてみる">ブラウザを開いてみる</span></h3><p>インターネットに接続されているのがわかります。</p>
<p>ただし<br>日本語がもれなく豆腐。。</p>
<p>Zabbix でも以前日本語フォントがなくて同様の事象がありました。。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711233353.jpg" width="100%">
</div>

<p>日本語フォントをインストールする必要があります。</p>
<h2><span id="raspberry-pi-に日本語フォントインストール">Raspberry Pi に日本語フォントインストール</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get update</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install fonts-vlgothic</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install ibus-mozc</span></span><br><span class="line"></span><br><span class="line">// 再起動</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo shutdown -r now</span></span><br></pre></td></tr></table></figure>

<h2><span id="もう一度ブラウザを開いてみる">もう一度ブラウザを開いてみる</span></h2><ul>
<li>日本語がちゃんと表示されています。</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711235220.jpg" width="100%">
</div>

<ul>
<li>日本語入力できるよう、<code>日本語 - Mozc</code> 選択</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711235039.png" width="100%">
</div>


<p>以上でセットアップ完了です。</p>
<p>ご清聴ありがとうございました。</p>
<a href="https://www.amazon.co.jp/exec/obidos/ASIN/B0155WN7CK/kenzo0107-22/" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img></div><div class="descriptions"><div class="og-title">Amazon | Raspberry Pi RASPBERRYPI-DISPLAY | LCD表示器 | 産業・研究開発用品 通販</div><div class="og-description">Raspberry Pi RASPBERRYPI-DISPLAYがLCD表示器ストアでいつでもお買い得。当日お急ぎ便対象商品は、当日お届け可能です。アマゾン配送商品は、通常配送無料（一部除く）。</div></div></div></a>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/07/10/2016-07-11-install-pip-on-centos5/"><img class="fill" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160711/20160711114558.jpg" alt="CentOS5 系 に pip インストール"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">2016-07-11</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/07/10/2016-07-11-install-pip-on-centos5/">CentOS5 系 に pip インストール</a></h1><div class="content"><p>2017 年 3 月にサポート終了する CentOS5 ですが<br>今なお利用されているサーバは多々あるかと思います。</p>
<h2><span id="今回の目的">今回の目的</span></h2><p>デフォルトインストールされている Python 2.4.3 を残した状態で<br>Python 2.6 をインストールし、pip の上位バージョンを利用できるようにする、<br>ことを目的とします。</p>
<h2><span id="epel-リポジトリ追加">EPEL リポジトリ追加</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rpm -Uvh http://ftp.iij.ad.jp/pub/linux/fedora/epel/5/x86_64/epel-release-5-4.noarch.rpm</span><br></pre></td></tr></table></figure>

<h2><span id="通常アップデートで-epel-からアップグレードするのを避ける様設定">通常アップデートで EPEL からアップグレードするのを避ける様設定</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/yum.repos.d/epel.repo</span><br><span class="line"></span><br><span class="line">[epel]</span><br><span class="line">...</span><br><span class="line">enabled=0</span><br></pre></td></tr></table></figure>

<h2><span id="epel-リポジトリから-python26-インストール">EPEL リポジトリから python26 インストール</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install python26 -y --enablerepo=epel</span><br></pre></td></tr></table></figure>

<h2><span id="バージョン確認">バージョン確認</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">python26 -V</span></span><br><span class="line">Python 2.6.8</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">python -V</span></span><br><span class="line">Python 2.4.3</span><br></pre></td></tr></table></figure>

<p>あくまで python26 は pip を利用するようにする為に共存させています。</p>
<h2><span id="pip-インストール">pip インストール</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">wget --no-check-certificate https://bootstrap.pypa.io/ez_setup.py</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo python26 ez_setup.py --insecure</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo easy_install-2.6 pip</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pip --version</span><br><span class="line">pip 8.1.2 from /usr/lib/python2.6/site-packages/pip-8.1.2-py2.6.egg (python 2.6)</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">2016-06-27</span><span class="level-item">Updated&nbsp;<time dateTime="2020-05-07T03:41:26.122Z" title="5/7/2020, 3:41:26 AM">2020-05-07</time></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/06/26/2016-06-27-each-table-mysql/">MySQL テーブル単位の容量確認</a></h1><div class="content"><ul>
<li>SQL</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use zabbix</span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">mysql&gt; select</span><br><span class="line">    -&gt; table_name, engine, table_rows as tbl_rows, avg_row_length as rlen,</span><br><span class="line">    -&gt; floor((data_length+index_length)&#x2F;1024&#x2F;1024) as allMB,  #総容量</span><br><span class="line">    -&gt; floor((data_length)&#x2F;1024&#x2F;1024) as dMB,  #データ容量</span><br><span class="line">    -&gt; floor((index_length)&#x2F;1024&#x2F;1024) as iMB   #インデックス容量</span><br><span class="line">    -&gt; from information_schema.tables</span><br><span class="line">    -&gt; where table_schema&#x3D;database()</span><br><span class="line">    -&gt; order by (data_length+index_length) desc;</span><br></pre></td></tr></table></figure>

<ul>
<li>実行結果</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">+----------------------------+--------+----------+-------+-------+------+------+</span><br><span class="line">| table_name                 | engine | tbl_rows | rlen  | allMB | dMB  | iMB  |</span><br><span class="line">+----------------------------+--------+----------+-------+-------+------+------+</span><br><span class="line">| history                    | InnoDB | 23815217 |    51 |  1802 | 1179 |  623 |</span><br><span class="line">| history_uint               | InnoDB | 21709131 |    51 |  1646 | 1075 |  571 |</span><br><span class="line">| trends_uint                | InnoDB |    45152 |   650 |    28 |   28 |    0 |</span><br><span class="line">| trends                     | InnoDB |    30965 |   914 |    27 |   27 |    0 |</span><br><span class="line">| history_str                | InnoDB |   129224 |   109 |    19 |   13 |    5 |</span><br><span class="line">| items                      | InnoDB |     2242 |   708 |     2 |    1 |    0 |</span><br><span class="line">| images                     | InnoDB |      144 | 11036 |     1 |    1 |    0 |</span><br><span class="line">| items_applications         | InnoDB |     2468 |    66 |     0 |    0 |    0 |</span><br><span class="line">| triggers                   | InnoDB |      805 |   223 |     0 |    0 |    0 |</span><br><span class="line">| graphs_items               | InnoDB |      948 |   103 |     0 |    0 |    0 |</span><br><span class="line">| functions                  | InnoDB |      833 |    98 |     0 |    0 |    0 |</span><br><span class="line">| events                     | InnoDB |      718 |   114 |     0 |    0 |    0 |</span><br><span class="line">| alerts                     | InnoDB |       88 |   930 |     0 |    0 |    0 |</span><br><span class="line">| graphs                     | InnoDB |      329 |   248 |     0 |    0 |    0 |</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>ちなみに上記は Zabbix DBの結果<br>history (履歴) にデータが肥大化傾向にあるので<br>パーティション や Zabbix housekeeping での<br>保存期間設定を調整するなど必要なことがわかります。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/06/26/2016-06-27-ssl-qualys-get-a-plus/"><img class="fill" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160627/20160627140744.png" alt="2016年5月現在、SSL評価Fを取らない為に"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">2016-06-27</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/06/26/2016-06-27-ssl-qualys-get-a-plus/">2016年5月現在、SSL評価Fを取らない為に</a></h1><div class="content"><p>それは、ある日 <a target="_blank" rel="noopener" href="https://www.ssllabs.com/ssltest/index.html">QUALYS SSL LABS</a> で SSL チェックしたとき</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160627/20160627140744.png" width="100%">
</div>

<p>F になってる…</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160627/20160627141207.jpg" width="100%">
</div>

<p>常に A+ を保っていたのに…</p>
<p>どうやら 2016/5/3 時点で新たに脆弱性が発見されたとのこと。</p>
<a href="https://oss.sios.com/security/general-security-20160504" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://tech-lab.sios.jp/wp-content/uploads/2018/05/sios_tech_lab_image.png"></div><div class="descriptions"><div class="og-title">SIOS Tech. Lab - エンジニアのためになる技術トピックス</div><div class="og-description">サイオステクノロジーのエンジニアが クラウド、OSS、認証に関する様々な情報を提供します。</div></div></div></a>

<p>今回指摘されている <code>CVE-2016-2107</code> :</p>
<blockquote>
<p>AES-NI CBC MAC チェックで MITM 攻撃者がパディングオラクル攻撃可能なことがわかりました。この問題は、CVE-2013-0169(Lucky 13 パディング)の修正のために導入された箇所の不具合から発生しました。</p>
</blockquote>
<p>上記対応策をまとめました。</p>
<h2><span id="対応策">対応策</span></h2><ul>
<li>OpenSSL version up</li>
</ul>
<p>※試験 OS 環境: CentOS7</p>
<p>以下記事では 「OpenSSL のバージョンを 1.0.2h/1.0.1t にあげてください。」とありますが、</p>
<p><a target="_blank" rel="noopener" href="https://oss.sios.com/security/general-security-20160504">general-security-20160504</a></p>
<p>段階的に試した所<br>以下コマンドで openssl のバージョンアップをした所<br>エラーが消え B となりました。</p>
<p>事前に Nginx を 1.11.1 にアップデートした為でしょうか汗</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># yum upgrade openssl -y</span><br><span class="line"></span><br><span class="line"># openssl version</span><br><span class="line">OpenSSL 1.0.1e-fips 11 Feb 2013</span><br></pre></td></tr></table></figure>

<ul>
<li>ssl_ciphers の設定変更</li>
</ul>
<p>config generator で 生成される ssl_ciphers ディレクティブをそのまま設定すると評価が B 止まりでした。</p>
<p><a target="_blank" rel="noopener" href="https://ssl-config.mozilla.org/">https://ssl-config.mozilla.org/</a></p>
<p>諸々含めたくない暗号化法があるようです。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssl_ciphers &#x27;ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS&#x27;;</span><br></pre></td></tr></table></figure>

<p>_以下最終的に設定した ssl_ciphers_ すると A+ に戻りました。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssl_ciphers &#x27;ECDH !aNULL !eNULL !SSLv2 !SSLv3&#x27;;</span><br></pre></td></tr></table></figure>

<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160627/20160627143218.png" width="100%">
</div>

<p>OpenSSL の脆弱性はチェックし続けていかねば</p>
<h2><span id="補足">補足</span></h2><p>HTTP Strict Transport Security を 有効化 (常時 SSL) にしないと<br>A+ は取れません。</p>
<p>常時 SSL はパフォーマンスにも影響するので<br>せめて A まで取る、という指針を決めてから着手してください。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2016/06/26/2016-06-27-versionup-nginx/"><img class="fill" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160627/20160627150549.png" alt="Nginx 1.9.6 → 1.11.1 へバージョンアップ 脆弱性対応"></a></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">2016-06-27</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/06/26/2016-06-27-versionup-nginx/">Nginx 1.9.6 → 1.11.1 へバージョンアップ 脆弱性対応</a></h1><div class="content"><p>脆弱性 CVE-2016-4450 に対応した Nginx 1.11.1 が 2016-05-31 リリースされたということで<br>早速バージョンアップを試みました。</p>
<p><a target="_blank" rel="noopener" href="https://oss.sios.com/yorozu-blog/nginx-release-information-20160601">SIOS Tech. Lab - エンジニアのためになる技術トピックス</a></p>
<p>ダウンタイムゼロで実行できました。</p>
<h2><span id="現状の-nginx-configure-確認">現状の Nginx configure 確認</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># nginx -V</span><br><span class="line">nginx version: nginx/1.9.6</span><br><span class="line"></span><br><span class="line">configure arguments: --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-http_auth_request_module --with-http_xslt_module=dynamic --with-http_image_filter_module=dynamic --with-http_geoip_module=dynamic --with-http_perl_module=dynamic --add-dynamic-module=njs-1c50334fbea6/nginx --with-threads --with-stream --with-stream_ssl_module --with-http_slice_module --with-mail --with-mail_ssl_module --with-file-aio --with-ipv6 --with-http_v2_module --with-cc-opt=&#x27;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic&#x27;</span><br></pre></td></tr></table></figure>

<h2><span id="httpnginxorgendownloadhtmltitle-より-nginx-1111-をダウンロード">[ より nginx-1.11.1 をダウンロード</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># cd /usr/local/src</span><br><span class="line"># wget http://nginx.org/download/nginx-1.11.1.tar.gz</span><br><span class="line"># tar xvf nginx-1.11.1.tar.gz</span><br><span class="line"># cd nginx-1.11.1</span><br></pre></td></tr></table></figure>

<h2><span id="nginx-1111-で利用モジュールやサードパーティgeoip-develをインストール">Nginx 1.11.1 で利用モジュールやサードパーティ(GeoIP-devel)をインストール</span></h2><p>以下実行しないと nginx の configure が通りませんでした。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install pcre-devel zlib-devel openssl-devel libxml2-devel libxslt-devel gd-devel perl-ExtUtils-Embed GeoIP-devel -y</span><br></pre></td></tr></table></figure>

<ul>
<li>gd-devel がインストールされていない場合の Nginx configure error</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./configure: error: the HTTP image filter module requires the GD library.</span><br><span class="line">You can either do not enable the module or install the libraries.</span><br></pre></td></tr></table></figure>

<ul>
<li>libxslt-devel がインストールされていない場合の Nginx configure error</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./configure: error: the HTTP XSLT module requires the libxml2/libxslt</span><br><span class="line">libraries. You can either do not enable the module or install the libraries.</span><br></pre></td></tr></table></figure>

<h2><span id="configure">configure</span></h2><p>「現状の Nginx configure 確認」で取得した configure parameter から<br>「–add-dynamic-module=njs-1c50334fbea6/nginx」を削除</p>
<ul>
<li><code>--add-dynamic-module=njs-1c50334fbea6/nginx</code> を指定した場合の Nginx configure error</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adding module in njs-1c50334fbea6/nginx</span><br><span class="line">./configure: error: no njs-1c50334fbea6/nginx/config was found</span><br></pre></td></tr></table></figure>

<p>「–add-dynamic-module=njs-1c50334fbea6/nginx」を削除して configure 実施</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-http_auth_request_module --with-http_xslt_module=dynamic --with-http_image_filter_module=dynamic --with-http_geoip_module=dynamic --with-http_perl_module=dynamic --with-threads --with-stream --with-stream_ssl_module --with-http_slice_module --with-mail --with-mail_ssl_module --with-file-aio --with-ipv6 --with-http_v2_module --with-cc-opt=&#x27;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic&#x27;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">checking for GeoIP library ... found</span><br><span class="line">checking for GeoIP IPv6 support ... found</span><br><span class="line">creating objs/Makefile</span><br><span class="line"></span><br><span class="line">Configuration summary</span><br><span class="line">  + using threads</span><br><span class="line">  + using system PCRE library</span><br><span class="line">  + using system OpenSSL library</span><br><span class="line">  + md5: using OpenSSL library</span><br><span class="line">  + sha1: using OpenSSL library</span><br><span class="line">  + using system zlib library</span><br><span class="line"></span><br><span class="line">  nginx path prefix: &quot;/etc/nginx&quot;</span><br><span class="line">  nginx binary file: &quot;/usr/sbin/nginx&quot;</span><br><span class="line">  nginx modules path: &quot;/usr/lib64/nginx/modules&quot;</span><br><span class="line">  nginx configuration prefix: &quot;/etc/nginx&quot;</span><br><span class="line">  nginx configuration file: &quot;/etc/nginx/nginx.conf&quot;</span><br><span class="line">  nginx pid file: &quot;/var/run/nginx.pid&quot;</span><br><span class="line">  nginx error log file: &quot;/var/log/nginx/error.log&quot;</span><br><span class="line">  nginx http access log file: &quot;/var/log/nginx/access.log&quot;</span><br><span class="line">  nginx http client request body temporary files: &quot;/var/cache/nginx/client_temp&quot;</span><br><span class="line">  nginx http proxy temporary files: &quot;/var/cache/nginx/proxy_temp&quot;</span><br><span class="line">  nginx http fastcgi temporary files: &quot;/var/cache/nginx/fastcgi_temp&quot;</span><br><span class="line">  nginx http uwsgi temporary files: &quot;/var/cache/nginx/uwsgi_temp&quot;</span><br><span class="line">  nginx http scgi temporary files: &quot;/var/cache/nginx/scgi_temp&quot;</span><br></pre></td></tr></table></figure>

<h2><span id="ビルド">ビルド</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># make</span><br><span class="line"># make install</span><br></pre></td></tr></table></figure>

<h2><span id="nginx-バージョン確認">Nginx バージョン確認</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># nginx -V</span><br><span class="line"></span><br><span class="line">nginx version: nginx/1.11.1</span><br><span class="line"></span><br><span class="line">configure arguments: --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-http_auth_request_module --with-http_xslt_module=dynamic --with-http_image_filter_module=dynamic --with-http_geoip_module=dynamic --with-http_perl_module=dynamic --with-threads --with-stream --with-stream_ssl_module --with-http_slice_module --with-mail --with-mail_ssl_module --with-file-aio --with-ipv6 --with-http_v2_module --with-cc-opt=&#x27;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic&#x27;</span><br></pre></td></tr></table></figure>

<h2><span id="構文チェック">構文チェック</span></h2><p>こける。。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># nginx -t</span><br><span class="line"></span><br><span class="line">nginx: [emerg] unknown directive &quot;geoip_country&quot; in /etc/nginx/nginx.conf:15</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test failed</span><br></pre></td></tr></table></figure>

<p>サードパーティに依存するディレクティブについては<br><code>load_module</code> で SharedObject(*.so) を呼び出す必要があります。</p>
<ul>
<li>/etc/nignx/nginx.conf の冒頭に以下追加</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load_module &quot;modules/ngx_http_geoip_module.so&quot;;</span><br></pre></td></tr></table></figure>

<h2><span id="再度構文チェック">再度構文チェック</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># nginx -t</span><br><span class="line"></span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br></pre></td></tr></table></figure>

<h2><span id="nginx-設定再読み込み">Nginx 設定再読み込み</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl reload nginx</span><br></pre></td></tr></table></figure>

<p>以上で Nginx バージョンアップが無事完了しました。</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/19/">前</a></div><div class="pagination-next"><a href="/page/21/">次</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/19/">19</a></li><li><a class="pagination-link is-current" href="/page/20/">20</a></li><li><a class="pagination-link" href="/page/21/">21</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/34/">34</a></li></ul></nav></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="長生村本郷Engineers&#039;Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Kenzo Tanaka</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("ja");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="トップに戻る" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="何かを入力してください..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"何かを入力してください...","untitled":"(無題)","posts":"投稿","pages":"ページ","categories":"カテゴリ","tags":"タグ"});
        });</script></body></html>