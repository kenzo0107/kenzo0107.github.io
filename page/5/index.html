<div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-09-11T15:00:00.000Z" title="2018-09-11T15:00:00.000Z">2018-09-12</time><span class="level-item">2分 read (About 314 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/09/11/2018-09-12-s3-5-aws-lb/">S3 に5分毎に出力される AWS LB ログファイルを時間帯を指定してまとめてダウンロード</a></h1><div class="content"><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>AWS で LB のログを S3 に保存設定をしている場合に、
インシデントがあった時間帯のログがまとめて欲しいという時に
awscli でまとめてログ取得しています。</p>

<p>その時の手順を備忘録としてまとめました。</p></div><a class="article-more button is-small size-small" href="/2018/09/11/2018-09-12-s3-5-aws-lb/#more">Read More</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-09-07T15:00:00.000Z" title="2018-09-07T15:00:00.000Z">2018-09-08</time><span class="level-item">1分 read (About 153 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/09/07/2018-09-08-cpu/">プロセスの起動経過時間・CPU使用時間</a></h1><div class="content"><p>備忘録です。</p>

<p>プロセスがいつ頃から起動しているものか、全然再起動してないと再起動するのもやや不安になるので<br/>
一旦確認しておこう、という気持ちから以下コマンドを使っています。</p></div><a class="article-more button is-small size-small" href="/2018/09/07/2018-09-08-cpu/#more">Read More</a></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2018/08/19/2018-08-20-raspberrypi-bluebutton-line-notify-google-home/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20180820/20180820223225.jpg" alt="食洗機かけ終わったかわからなくなる問題を RaspberryPI + BlueButton + LINE Notify + Google Home で解決した話"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-08-19T15:00:00.000Z" title="2018-08-19T15:00:00.000Z">2018-08-20</time><span class="level-item">11分 read (About 1703 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/08/19/2018-08-20-raspberrypi-bluebutton-line-notify-google-home/">食洗機かけ終わったかわからなくなる問題を RaspberryPI + BlueButton + LINE Notify + Google Home で解決した話</a></h1><div class="content"><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p><b>食洗機かけ終わったかどうかわからなくなる問題</b>が我が家で多発していました。</p>

<p>それを RaspberryPI + BluetButton + LINE Notify + Google Home で解決した話です。</p></div><a class="article-more button is-small size-small" href="/2018/08/19/2018-08-20-raspberrypi-bluebutton-line-notify-google-home/#more">Read More</a></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2018/08/14/2018-08-15-ffmpeg-nginx-rtmp-on-raspberrypi/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20180815/20180815181451.png" alt="子供の笑顔と笑い声を聞く為に ffmpeg + Nginx + RTMP on RaspberryPI"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-08-14T15:00:00.000Z" title="2018-08-14T15:00:00.000Z">2018-08-15</time><span class="level-item">14分 read (About 2122 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/08/14/2018-08-15-ffmpeg-nginx-rtmp-on-raspberrypi/">子供の笑顔と笑い声を聞く為に ffmpeg + Nginx + RTMP on RaspberryPI</a></h1><div class="content"><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>RaspberryPI 上で rtmp モジュール付きの nginx をビルドし<br/>
WebCamera で撮影した 動画+音声付き を HLS 配信する際の手順をまとめました。</p></div><a class="article-more button is-small size-small" href="/2018/08/14/2018-08-15-ffmpeg-nginx-rtmp-on-raspberrypi/#more">Read More</a></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2018/08/13/2018-08-14-flask-service-worker-on-heroku-pwa/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20180814/20180814131355.png" alt="Flask+Service Worker on Heroku で PWA チュートリアル"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-08-13T15:00:00.000Z" title="2018-08-13T15:00:00.000Z">2018-08-14</time><span class="level-item">9分 read (About 1416 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/08/13/2018-08-14-flask-service-worker-on-heroku-pwa/">Flask+Service Worker on Heroku で PWA チュートリアル</a></h1><div class="content"><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>自分にとっては <a href="https://dev.to/">dev.to</a> でバズった Service Worker。<br>その概要と機能性をなぞってみようとチュートリアル的に学んだ内容をまとめました。</p>
<p>掲題の通り、Flask + Service Worker を Heroku で動作させ、PWA(Progressive Web Apps) してみました。</p></div><a class="article-more button is-small size-small" href="/2018/08/13/2018-08-14-flask-service-worker-on-heroku-pwa/#more">Read More</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-07-31T15:00:00.000Z" title="2018-07-31T15:00:00.000Z">2018-08-01</time><span class="level-item">3分 read (About 474 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/07/31/2018-08-01-face-detector/">顔検出 3分クッキング on MacOSX</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>ラズパイ使って家族と判断したら<br>「こんにちはご主人様」<br>家族以外なら<br>「通報しまーす」<br>と話してくれるおもちゃを<br>作ろうと思ってます。</p>
<p>その前段の前段として<br>静止画で顔検出してみます。</p>
<p>ちなみに顔検出と顔認識は意味が全く異なります。</p>
<ul>
<li>顔検出 … 顔部分を検出すること。</li>
<li>顔認識 … 特定の人物の顔と判断すること。</li>
</ul>
<p>環境構築は前回記事を参照してください。</p>
<a href="https://kenzo0107.hatenablog.com/entry/2016/07/28/143429" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160728/20160728142804.jpg"></div><div class="descriptions"><div class="og-title">MacOSX に Python2, Python3 仮想環境構築 - 長生村本郷Engineers&#39;Blog</div><div class="og-description">経緯 MacOSX デフォルトでは python 2系。 python 2.7 は 2020年までのサポート なので python 3 系 に慣れておこうということで 3 系環境を構築しようと思いました。 ですが dlib など Python 2系でないとうまく設定ができなかった…</div></div></div></a>





<h2><span id="環境">環境</span></h2><ul>
<li>MacOSX 10.11.5</li>
<li>Python 3</li>
</ul>
<h2><span id="cv2-インストール">CV2 インストール</span></h2><ul>
<li>homebrew で cv2 インストール</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew tap homebrew/science</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> brew install opencv3 --with-python3</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Python 3 を利用する</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ source ~&#x2F;py3env&#x2F;bin&#x2F;active</span><br><span class="line">(py3env)$</span><br></pre></td></tr></table></figure>

<ul>
<li>cv2.so を pip の site-package へコピー</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(py3env)$ cd ~&#x2F;py3env&#x2F;lib&#x2F;python3.4&#x2F;site-packages</span><br><span class="line">(py3env)$ cp &#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;opencv3&#x2F;3.1.0_3&#x2F;lib&#x2F;python3.4&#x2F;site-packages&#x2F;cv2.so .</span><br></pre></td></tr></table></figure>

<ul>
<li>cv2 import 確認</li>
</ul>
<p>Version が表示されれば成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(py3env)$ python -c &#39;import cv2; print(cv2.__version__)&#39;</span><br><span class="line">3.1.0</span><br></pre></td></tr></table></figure>

<h2><span id="スクリプトインストール">スクリプトインストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(py3env)$ cd ~&#x2F;py3env</span><br><span class="line">(py3env)$ git clone https:&#x2F;&#x2F;gist.github.com&#x2F;kenzo0107&#x2F;5d174797a5a222295b5a39f6fa435777</span><br><span class="line">(py3env)$ cp .&#x2F;5d174797a5a222295b5a39f6fa435777&#x2F;trimming.py .</span><br></pre></td></tr></table></figure>

<h2><span id="スクリプト実行">スクリプト実行</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(py3env)$ python trimming.py &lt;img_path&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Before</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160801/20160801143015.png" width="100%">
</div>
</li>
<li><p>After</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20160801/20160801143033.png" width="100%">
</div>


</li>
</ul>
<p>革パンも顔認識されてしまう…</p>
<p>が、一応まずできました。</p>
<h2><span id="今回のスクリプト要点">今回のスクリプト要点</span></h2><ul>
<li>正確な検知数を向上させるべく、スクリプト上の以下 detectMultiScale メソッドのパラメータを調整します。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">facerect &#x3D; cascade.detectMultiScale(image_gray, scaleFactor&#x3D;1.02, minNeighbors&#x3D;3, minSize&#x3D;(7,7))</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><em>Item</em></th>
<th><em>Value</em></th>
</tr>
</thead>
<tbody><tr>
<td>scaleFactor</td>
<td>画像解析する際に随時縮小し解析するその尺度</td>
</tr>
<tr>
<td>minNeighbors</td>
<td>最小<a href="http://opencv.jp/opencv-2.2/py/objdetect_cascade_classification.html" target="_blank">近傍矩形</a>数</td>
</tr>
<tr>
<td>minSize</td>
<td>顔部分を認識するためのサイズ (縦,横)</td>
</tr>
</tbody></table>
<p>まず最初の第一歩ができました♪</p>
</div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2018/07/29/2018-07-30-datadog_ntp_alert/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20180730/20180730133759.jpg" alt="Datadog NTP 監視でアラート鳴りまくり対応"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-07-29T15:00:00.000Z" title="2018-07-29T15:00:00.000Z">2018-07-30</time><span class="level-item">3分 read (About 482 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/07/29/2018-07-30-datadog_ntp_alert/">Datadog NTP 監視でアラート鳴りまくり対応</a></h1><div class="content"><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>サーバ時刻の監視を Datadog で実施する際、標準時刻の参照先が異なることで<br>不要なアラートが発生する事象がありました。</p>
<p>Datadog はデフォルトで  <code>pool.ntp.org</code> を参照しています。</p>
<p>AWS EC2 に設定した Chrony ではデフォルトで <code>ntp.nict.jp</code> を参照する様にしていた為、ある日突然アラートがなりまくる事象がありました。</p>
<p>この対策として、<br> Datadog と Chrony の参照先を統一して管理する様に設定しました。</p></div><a class="article-more button is-small size-small" href="/2018/07/29/2018-07-30-datadog_ntp_alert/#more">Read More</a></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2018/07/10/2018-07-11-cleanup_docker_no_required_resource/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20180711/20180711135636.png" alt="Docker 不要リソースお掃除 compose"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-07-10T15:00:00.000Z" title="2018-07-10T15:00:00.000Z">2018-07-11</time><span class="level-item">3分 read (About 404 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/07/10/2018-07-11-cleanup_docker_no_required_resource/">Docker 不要リソースお掃除 compose</a></h1><div class="content"><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>ECS EC2 で一部コンテナが 起動開始→失敗→起動開始→失敗 を繰り返し<br>サーバが容量不足 <code>no space left</code> に陥る事象がありました。</p>
<p>その時の対応をまとめました。</p></div><a class="article-more button is-small size-small" href="/2018/07/10/2018-07-11-cleanup_docker_no_required_resource/#more">Read More</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-06-23T15:00:00.000Z" title="2018-06-23T15:00:00.000Z">2018-06-24</time><span class="level-item">4分 read (About 604 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/06/23/2018-06-24-maintenance_aws_elasticache/">ElastiCache メンテナンス対応 ~2018年梅雨~</a></h1><div class="content"><p>2018年6月頃 AWS ElastiCache のメンテナンス通知が大量発生した時の備忘録です。</p>
<div class="twitter-wrapper"><blockquote class="twitter-tweet"><a href="https://twitter.com/fujiwara/status/1008956888086503425"></a></blockquote></div><script async defer src="//platform.twitter.com/widgets.js" charset="utf-8"></script></div><a class="article-more button is-small size-small" href="/2018/06/23/2018-06-24-maintenance_aws_elasticache/#more">Read More</a></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2018/06/05/2018-06-06-rails-redis-threadsafe/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20180606/20180606115540.jpg" alt="Rails × Redis でスレッドセーフなアクセス数ランキング実装"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-06-05T15:00:00.000Z" title="2018-06-05T15:00:00.000Z">2018-06-06</time><span class="level-item">7分 read (About 1055 words)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/06/05/2018-06-06-rails-redis-threadsafe/">Rails × Redis でスレッドセーフなアクセス数ランキング実装</a></h1><div class="content"><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>メディアサイトで記事ページへアクセス数ランキングを実装しました。</p>
<ul>
<li>Rails 5.1</li>
<li>Redis (AWS ElastiCache 3.2.10)</li>
</ul>
<p>その際にマルチスレッド環境を考慮してスレッドセーフな実装を心がけました。</p></div><a class="article-more button is-small size-small" href="/2018/06/05/2018-06-06-rails-redis-threadsafe/#more">Read More</a></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/4/">前</a></div><div class="pagination-next"><a href="/page/6/">次</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/4/">4</a></li><li><a class="pagination-link is-current" href="/page/5/">5</a></li><li><a class="pagination-link" href="/page/6/">6</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/20/">20</a></li></ul></nav>