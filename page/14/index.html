<!doctype html>
<html lang="ja"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>長生村本郷Engineers&#039;Blog</title><meta description="tech"><meta property="og:type" content="blog"><meta property="og:title" content="長生村本郷Engineers&#039;Blog"><meta property="og:url" content="https://kenzo0107.github.io/"><meta property="og:site_name" content="長生村本郷Engineers&#039;Blog"><meta property="og:description" content="tech"><meta property="og:locale" content="ja_JP"><meta property="og:image" content="https://kenzo0107.github.io/img/og_image.png"><meta property="article:author" content="Kenzo Tanaka"><meta property="article:tag" content="aws golang"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://kenzo0107.github.io"},"headline":"長生村本郷Engineers'Blog","image":["https://kenzo0107.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Kenzo Tanaka"},"description":"tech"}</script><link rel="alternative" href="/atom.xml" title="長生村本郷Engineers&#039;Blog" type="application/atom+xml"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-162026478-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-162026478-1');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script data-ad-client="ca-pub-6265337967545472" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="長生村本郷Engineers&#039;Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/2013/12/31/PrivacyPolicy/">PrivacyPolicy</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/kenzo0107"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><a class="image" href="/2017/07/06/2017-07-07-flask/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170707/20170707233203.png" alt="Flask Python3 で 戸田市 tocoちゃんバスあと何分？ Webアプリ作成♪"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-07-06T15:00:00.000Z" title="2017-07-06T15:00:00.000Z">$2017-07-07</time></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/07/06/2017-07-07-flask/">Flask Python3 で 戸田市 tocoちゃんバスあと何分？ Webアプリ作成♪</a></h1><div class="content"><h2><span id="flaskフラスク-とは">Flask(フラスク) とは</span></h2><p><a href="http://flask.pocoo.org/">Flask Official Site</a> を参照すると冒頭に以下の文章があります。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Flask is a microframework for Python based on Werkzeug, Jinja 2 and good intentions</span><br></pre></td></tr></table></figure>

<p>Flask は Python の小規模なフレームワークで、 Werkzug や Jinja 2 をベースとしています。</p>
<ul>
<li>Made by Armin Ronacher (Australian)</li>
<li>Bottle（ボトル）に対する言葉遊びで命名。（Flask: フラスコ）</li>
<li>2010年のエイプリルフールのジョークが始まり</li>
<li><a href="http://www.sejuku.net/blog/3713">2017年大注目のPython！WEBフレームワーク3つを徹底比較</a> を見ると次第に人気が高まっている（給与も良さそう？）</li>
</ul>
<h2><span id="何がいいの">何がいいの？</span></h2><p>最小限の構成で簡単な Web アプリケーションが作成できることです。<br>django, Rails でも簡単に出来なくもないですが、さらに手順は短く容易です。</p>
<h3><span id="チュートリアル">チュートリアル</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello World!"</span></span><br></pre></td></tr></table></figure>

<h2><span id="flaskを利用する判断基準">Flaskを利用する判断基準</span></h2><ul>
<li>大規模なプロジェクトでない。（ファイル構成は自分 or チームで決定する必要がある為）</li>
<li>DB を使わない。使うにしても複雑なDB設計でない。</li>
<li>利用するライブラリが Python 製でそのgatewayとして利用したい。</li>
</ul>
<h2><span id="手始めに">手始めに！</span></h2><p>初心者向け記事は多数あるので割愛し<br>学習がてら Web アプリケーション作ったのでそちらをどうぞ♪</p>
<p>実際動くものとそのソースを見た方がイメージ湧くと思います。</p>
<p><a href="http://toda-tocochan-bus.tk">tocoちゃんバス あと何分？</a></p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170707/20170707232036.png" width="100%">
</div>

<p>戸田市のローカルバス toco ちゃんバスの停留所を指定しあと何分で来るかをカウントダウンするアプリです。<br>自分が使うので作ったら割と広まってきて嬉しい限り♪</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">※ちなみに戸田市役所に確認し非公式ではありますが公開許可をいただいております。</span><br><span class="line">※戸田市役所ご担当者様より「可能であれば最新の迂回情報なども載せていただけたら〜」という要望も頂きました♪</span><br></pre></td></tr></table></figure>

<h2><span id="ソースはこちら">ソースはこちら♪</span></h2><a href="https://github.com/kenzo0107/toda-tocochan-bus" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://avatars0.githubusercontent.com/u/6197906?s=400&v=4"></div><div class="descriptions"><div class="og-title">kenzo0107/toda-tocochan-bus</div><div class="og-description">Contribute to kenzo0107/toda-tocochan-bus development by creating an account on GitHub.</div></div></div></a>

<p>ソースを参照頂けるとやってみたことがわかりやすいと思います。</p>
<h3><span id="やってみたこと">やってみたこと</span></h3><ul>
<li>docker で flask ローカル開発環境作成</li>
<li>config ファイルからデータ呼び出し (config.py)</li>
<li>session 機能</li>
<li>Bootstrap 適用</li>
<li>superagent.js で非同期通信</li>
<li>flickity.js でフリッカブルに</li>
</ul>
<h3><span id="本番動作環境">本番動作環境</span></h3><ul>
<li>さくらVPS CentOS 6</li>
<li>httpd2.4 + wsgi + virtualenv + python3</li>
</ul>
<p>さくらVPSには CakePHP や SpringBoot のプロジェクトが乗っかっていたりとやりたい放題の環境として所持しています。</p>
<h3><span id="開発期間">開発期間</span></h3><p>ほぼほぼ 1週間。仕事の昼休みと日曜大工で 10時間足らずで公開出来ました。<br>どちらかというと js 側の学習コストが掛かった感じ。</p>
<h2><span id="総評">総評</span></h2><p>今回作成したユーザ情報を管理しない、<br>DBを持たないアプリにはうってつけでした。<br>構成が複雑になりすぎず丁度良かったです。</p>
<p>やはり大きな規模のプロジェクトには django が適しています。</p>
<p>個人的に戸田市役所に電話してWebアプリ公開の許可を頂く、<br>という承認申請が出来、地域貢献できる喜びが非常に大きかったです。</p>
<p>今後、バージョンアップしたいと思います。</p>
<p>Flask 利用に際して参考になれば何よりです。</p>
<p>以上です。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image" href="/2017/06/12/2017-06-13-update-apache-php/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170613/20170613223736.jpg" alt="Apache 2.2.15 → 2.4.25   PHP 5.6 → 7 へアップデート on CentOS 6.9"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-06-12T15:00:00.000Z" title="2017-06-12T15:00:00.000Z">$2017-06-13</time></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/06/12/2017-06-13-update-apache-php/">Apache 2.2.15 → 2.4.25   PHP 5.6 → 7 へアップデート on CentOS 6.9</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>PHP5 利用していますか？</p>
<p>PHP5.6 のセキュリティサポート期限は <code>31 Dec 2018</code> 迄<br>※ <a href="http://php.net/supported-versions.php">Supported Versions</a> 参考</p>
<p>Apache/PHP アップデート、腰が重かったのですが<br>個人契約サーバなら誰にも迷惑かけないしいいか♪</p>
<p>ということで<br>放置気味にされた Apache2.2.15/PHP5.6 の個人のサーバを<br>アップデートすべく実施した内容をまとめました。</p>
<h2><span id="三行まとめ">三行まとめ</span></h2><ul>
<li>SoftwareCollection を利用し現存Apache/PHPを残したまま、アップデート版を共存させ切り替え。のち古い Apache/PHP 削除</li>
<li>必要モジュール (MySQLi, PHPRedis)インストール</li>
<li>PHP 7 で廃止された PHP5.6 機能やシンタックスを修正</li>
</ul>
<h2><span id="softwarecollection-とは">SoftwareCollection とは？</span></h2><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170613/20170613224451.png" width="100%">
</div>


<p><a href="https://www.softwarecollections.org/en/">公式サイト</a> によると<br>以下の様に説明されています。</p>
<ul>
<li><p>英語</p>
<blockquote>
<p>Software Collections give you the power to build, install, and use multiple versions of software on the same system, without affecting system-wide installed packages.</p>
</blockquote>
</li>
<li><p>日本語</p>
<blockquote>
<p>ソフトウェアコレクションは、システム全体でインストールされたパッケージに影響を与えることなく、同じシステム上に複数のバージョンのソフトウェアを構築、インストール、使用する能力を提供します。</p>
</blockquote>
</li>
</ul>
<p>同じシステム上に複数バージョンのソフトウェアをインストールできる様になる、<br>ということです。</p>
<h2><span id="softwarecollection-インストール">SoftwareCollection インストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install centos-release-scl</span><br></pre></td></tr></table></figure>

<h2><span id="httpd24-関連のモジュールインストール">httpd24 関連のモジュールインストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum-config-manager --enable rhel-server-rhscl-6-rpms</span><br><span class="line">$ sudo yum install httpd24-httpd httpd24-httpd-devel httpd24-mod_proxy_html httpd24-mod_session httpd24-mod_ssl</span><br><span class="line">$ sudo scl enable httpd24 bash</span><br><span class="line">$ sudo service httpd graceful</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ httpd -v</span><br><span class="line">Server version: Apache&#x2F;2.4.25 (Red Hat)</span><br><span class="line">Server built:   Apr 12 2017 06:35:50</span><br></pre></td></tr></table></figure>

<h2><span id="rhscl-リポジトリ利用可設定">RHSCL リポジトリ利用可設定</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum-config-manager --enable rhel-server-rhscl-7-rpms</span><br></pre></td></tr></table></figure>

<h2><span id="php7-関連モジュールをインストール">php7 関連モジュールをインストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y scl-utils</span><br><span class="line"># yum install -y https:&#x2F;&#x2F;dl.fedoraproject.org&#x2F;pub&#x2F;epel&#x2F;epel-release-latest-7.noarch.rpm</span><br><span class="line"># yum install -y http:&#x2F;&#x2F;rpms.remirepo.net&#x2F;enterprise&#x2F;remi-release-7.rpm</span><br><span class="line"># yum install -y php70</span><br><span class="line"># yum install -y php70-php-mysqlnd</span><br><span class="line"># yum install -y php70-php-curl</span><br><span class="line"># yum install -y php70-php-simplexml</span><br><span class="line"># yum install -y php70-php-devel php70-php-gd php70-php-json php70-php-mcrypt php70-php-mbstring php70-php-opcache php70-php-pear php70-php-pecl-apcu php70-php-pecl-geoip php70-php-pecl-imagick php70-php-pecl-json-post php70-php-pecl-memcache php70-php-pecl-xmldiff php70-php-pecl-zip php70-php-pspell php70-php-soap php70-php-tidy php70-php-xml php70-php-xmlrpc</span><br></pre></td></tr></table></figure>

<h2><span id="mysqli-インストール">mysqli インストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum --enablerepo&#x3D;remi-php70 install php-mysqli</span><br></pre></td></tr></table></figure>

<h2><span id="php7-用-phpredis-インストール">PHP7 用 phpredis インストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class="line"># git clone https:&#x2F;&#x2F;github.com&#x2F;phpredis&#x2F;phpredis.git</span><br><span class="line"># cd phpredis</span><br><span class="line"># git checkout php7</span><br><span class="line"># phpize</span><br><span class="line"># .&#x2F;configure</span><br><span class="line"># make</span><br><span class="line"># make install</span><br><span class="line"># echo &#39;extension&#x3D;redis.so&#39; &gt; &#x2F;etc&#x2F;opt&#x2F;rh&#x2F;rh-php70&#x2F;php.d&#x2F;redis.ini</span><br></pre></td></tr></table></figure>

<h2><span id="php-fpm-再起動">php-fpm 再起動</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># &#x2F;etc&#x2F;init.d&#x2F;php70-php-fpm restart</span><br></pre></td></tr></table></figure>

<h2><span id="httpd-再起動">httpd 再起動</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># &#x2F;etc&#x2F;init.d&#x2F;httpd24-httpd restart</span><br></pre></td></tr></table></figure>

<p>ここまでで PHP7 で動作する環境が整っているかと思います。<br>エラーログを見ながら修正に当たってください。</p>
<h2><span id="php-7-で廃止された構文を修正">PHP 7 で廃止された構文を修正</span></h2><h3><span id="php-parse-error-syntax-error-unexpected-new-t_new">PHP Parse error:  syntax error, unexpected ‘new’ (T_NEW)</span></h3><ul>
<li><code>&amp;= new &lt;クラス名&gt;</code> の指定が不可となり、 <code>= new &lt;クラス名&gt;</code> にする必要があります。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;&#x3D; new Class</span><br><span class="line">↓</span><br><span class="line">&#x3D; new Class</span><br></pre></td></tr></table></figure>

<h3><span id="php-fatal-error-cannot-use-string-as-class-name-as-it-is-reserved">PHP Fatal error:  Cannot use ‘String’ as class name as it is reserved</span></h3><ul>
<li>PHP7 では class String, Int と型名の Class を作成できなくなりました。</li>
</ul>
<p>自分は以下の様に修正しました。<br>※ 適宜プロジェクトのコーディングルールに則ってご変更ください。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class String &#123;</span><br><span class="line">↓</span><br><span class="line">class Stringer &#123;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class Int &#123;</span><br><span class="line">↓</span><br><span class="line">class Intger &#123;</span><br></pre></td></tr></table></figure>

<p>プロジェクトによってはもっと色々出てくると思いますので<br>適宜修正ください。</p>
<h2><span id="総評">総評</span></h2><p>放置されがちになるミドルウェアのアップデートは小まめにやっておきたいですね。<br>脆弱性の定期的な棚卸しせねば</p>
<p>業務でアップデートするのであれば<br>アップデートする環境を別途用意してアップデートする、<br>そこでミドルウェア、アプリケーションのコードレベルでのアップデート手順をまとめ<br>本番環境で実施。</p>
<p>機能(url)毎に正しく動いたものだけプロキシで PHP7 へ流す<br>というのもアリかなと思います。</p>
<p>以上です。</p>
<h2><span id="参考">参考</span></h2><ul>
<li><a href="http://php.net/manual/ja/migration70.php">PHP 5.6.x から PHP 7.0.x への移行</a></li>
<li><a href="https://itpropartners.com/blog/9235/">PHP5.6からPHP７にアップデートする上で気をつけるコト</a></li>
</ul>
</div></article></div><div class="card"><div class="card-image"><a class="image" href="/2017/06/12/2017-06-04-install-php7-pecl-pear-on-macos/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170604/20170604224801.png" alt="Install PHP7, PECL, PEAR on MacOS"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-06-12T15:00:00.000Z" title="2017-06-12T15:00:00.000Z">$2017-06-13</time></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/06/12/2017-06-04-install-php7-pecl-pear-on-macos/">Install PHP7, PECL, PEAR on MacOS</a></h1><div class="content"><p>備忘録です。<br>忘れない為の自分への一筆。</p>
<h2><span id="php-7-インストール">PHP 7 インストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ brew update</span><br><span class="line">$ brew install homebrew&#x2F;php&#x2F;php70</span><br><span class="line">$ echo &#39;export PATH&#x3D;&quot;$(brew --prefix homebrew&#x2F;php&#x2F;php70)&#x2F;bin:$PATH&quot;&#39; &gt;&gt; ~&#x2F;.bashrc</span><br><span class="line">$ source ~&#x2F;.bashrc</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ php -v</span><br><span class="line"></span><br><span class="line">PHP 7.0.19 (cli) (built: May 21 2017 11:56:11) ( NTS )</span><br><span class="line">Copyright (c) 1997-2017 The PHP Group</span><br><span class="line">Zend Engine v3.0.0, Copyright (c) 1998-2017 Zend Technologies</span><br></pre></td></tr></table></figure>

<h2><span id="php-7-で-pecl-pear-インストール">PHP 7 で Pecl, Pear インストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -O http:&#x2F;&#x2F;pear.php.net&#x2F;go-pear.phar</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">$ sudo php -d detect_unicode&#x3D;0 go-pear.phar</span><br><span class="line"></span><br><span class="line">Below is a suggested file layout for your new PEAR installation.  To</span><br><span class="line">change individual locations, type the number in front of the</span><br><span class="line">directory.  Type &#39;all&#39; to change all of them or simply press Enter to</span><br><span class="line">accept these locations.</span><br><span class="line"></span><br><span class="line"> 1. Installation base ($prefix)                   : &#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;php70&#x2F;7.0.19_11</span><br><span class="line"> 2. Temporary directory for processing            : &#x2F;tmp&#x2F;pear&#x2F;install</span><br><span class="line"> 3. Temporary directory for downloads             : &#x2F;tmp&#x2F;pear&#x2F;install</span><br><span class="line"> 4. Binaries directory                            : &#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;php70&#x2F;7.0.19_11&#x2F;bin</span><br><span class="line"> 5. PHP code directory ($php_dir)                 : &#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;php70&#x2F;7.0.19_11&#x2F;share&#x2F;pear</span><br><span class="line"> 6. Documentation directory                       : &#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;php70&#x2F;7.0.19_11&#x2F;docs</span><br><span class="line"> 7. Data directory                                : &#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;php70&#x2F;7.0.19_11&#x2F;data</span><br><span class="line"> 8. User-modifiable configuration files directory : &#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;php70&#x2F;7.0.19_11&#x2F;cfg</span><br><span class="line"> 9. Public Web Files directory                    : &#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;php70&#x2F;7.0.19_11&#x2F;www</span><br><span class="line">10. System manual pages directory                 : &#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;php70&#x2F;7.0.19_11&#x2F;man</span><br><span class="line">11. Tests directory                               : &#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;php70&#x2F;7.0.19_11&#x2F;tests</span><br><span class="line">12. Name of configuration file                    : &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;7.0&#x2F;pear.conf</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; インストール先指定</span><br><span class="line">1-12, &#39;all&#39; or Enter to continue: (「1」と入力しEnter)</span><br><span class="line"></span><br><span class="line">(Use $prefix as a shortcut for &#39;&#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;php70&#x2F;7.0.19_11&#39;, etc.)</span><br><span class="line">Installation base ($prefix) [&#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;php70&#x2F;7.0.19_11] : (「&#x2F;usr&#x2F;local&#x2F;pear」と入力しEnter)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Below is a suggested file layout for your new PEAR installation.  To</span><br><span class="line">change individual locations, type the number in front of the</span><br><span class="line">directory.  Type &#39;all&#39; to change all of them or simply press Enter to</span><br><span class="line">accept these locations.</span><br><span class="line"></span><br><span class="line"> 1. Installation base ($prefix)                   : &#x2F;usr&#x2F;local&#x2F;pear</span><br><span class="line"> 2. Temporary directory for processing            : &#x2F;tmp&#x2F;pear&#x2F;install</span><br><span class="line"> 3. Temporary directory for downloads             : &#x2F;tmp&#x2F;pear&#x2F;install</span><br><span class="line"> 4. Binaries directory                            : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;bin</span><br><span class="line"> 5. PHP code directory ($php_dir)                 : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;share&#x2F;pear</span><br><span class="line"> 6. Documentation directory                       : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;docs</span><br><span class="line"> 7. Data directory                                : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;data</span><br><span class="line"> 8. User-modifiable configuration files directory : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;cfg</span><br><span class="line"> 9. Public Web Files directory                    : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;www</span><br><span class="line">10. System manual pages directory                 : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;man</span><br><span class="line">11. Tests directory                               : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;tests</span><br><span class="line">12. Name of configuration file                    : &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;7.0&#x2F;pear.conf</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; バイナリディレクトリ指定</span><br><span class="line">1-12, &#39;all&#39; or Enter to continue: (「4」と入力しEnter)</span><br><span class="line"></span><br><span class="line">(Use $prefix as a shortcut for &#39;&#x2F;usr&#x2F;local&#x2F;pear&#39;, etc.)</span><br><span class="line">Binaries directory [$prefix&#x2F;bin] : &#x2F;usr&#x2F;local&#x2F;bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Below is a suggested file layout for your new PEAR installation.  To</span><br><span class="line">change individual locations, type the number in front of the</span><br><span class="line">directory.  Type &#39;all&#39; to change all of them or simply press Enter to</span><br><span class="line">accept these locations.</span><br><span class="line"></span><br><span class="line"> 1. Installation base ($prefix)                   : &#x2F;usr&#x2F;local&#x2F;pear</span><br><span class="line"> 2. Temporary directory for processing            : &#x2F;tmp&#x2F;pear&#x2F;install</span><br><span class="line"> 3. Temporary directory for downloads             : &#x2F;tmp&#x2F;pear&#x2F;install</span><br><span class="line"> 4. Binaries directory                            : &#x2F;usr&#x2F;local&#x2F;bin</span><br><span class="line"> 5. PHP code directory ($php_dir)                 : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;share&#x2F;pear</span><br><span class="line"> 6. Documentation directory                       : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;docs</span><br><span class="line"> 7. Data directory                                : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;data</span><br><span class="line"> 8. User-modifiable configuration files directory : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;cfg</span><br><span class="line"> 9. Public Web Files directory                    : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;www</span><br><span class="line">10. System manual pages directory                 : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;man</span><br><span class="line">11. Tests directory                               : &#x2F;usr&#x2F;local&#x2F;pear&#x2F;tests</span><br><span class="line">12. Name of configuration file                    : &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;7.0&#x2F;pear.conf</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 以上で基本設定が済んだのでインストールを開始する</span><br><span class="line">1-12, &#39;all&#39; or Enter to continue: (何も入力せずEnter)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; インストールが開始されます。</span><br><span class="line">Beginning install...</span><br><span class="line">Configuration written to &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;7.0&#x2F;pear.conf...</span><br><span class="line">Initialized registry...</span><br><span class="line">Preparing to install...</span><br><span class="line">installing phar:&#x2F;&#x2F;&#x2F;Users&#x2F;kenzo.tanaka&#x2F;azure&#x2F;go-pear.phar&#x2F;PEAR&#x2F;go-pear-tarballs&#x2F;Archive_Tar-1.4.2.tar...</span><br><span class="line">installing phar:&#x2F;&#x2F;&#x2F;Users&#x2F;kenzo.tanaka&#x2F;azure&#x2F;go-pear.phar&#x2F;PEAR&#x2F;go-pear-tarballs&#x2F;Console_Getopt-1.4.1.tar...</span><br><span class="line">installing phar:&#x2F;&#x2F;&#x2F;Users&#x2F;kenzo.tanaka&#x2F;azure&#x2F;go-pear.phar&#x2F;PEAR&#x2F;go-pear-tarballs&#x2F;PEAR-1.10.4.tar...</span><br><span class="line">installing phar:&#x2F;&#x2F;&#x2F;Users&#x2F;kenzo.tanaka&#x2F;azure&#x2F;go-pear.phar&#x2F;PEAR&#x2F;go-pear-tarballs&#x2F;Structures_Graph-1.1.1.tar...</span><br><span class="line">installing phar:&#x2F;&#x2F;&#x2F;Users&#x2F;kenzo.tanaka&#x2F;azure&#x2F;go-pear.phar&#x2F;PEAR&#x2F;go-pear-tarballs&#x2F;XML_Util-1.4.2.tar...</span><br><span class="line">install ok: channel:&#x2F;&#x2F;pear.php.net&#x2F;Archive_Tar-1.4.2</span><br><span class="line">install ok: channel:&#x2F;&#x2F;pear.php.net&#x2F;Console_Getopt-1.4.1</span><br><span class="line">install ok: channel:&#x2F;&#x2F;pear.php.net&#x2F;Structures_Graph-1.1.1</span><br><span class="line">install ok: channel:&#x2F;&#x2F;pear.php.net&#x2F;XML_Util-1.4.2</span><br><span class="line">install ok: channel:&#x2F;&#x2F;pear.php.net&#x2F;PEAR-1.10.4</span><br><span class="line">PEAR: Optional feature webinstaller available (PEAR&#39;s web-based installer)</span><br><span class="line">PEAR: Optional feature gtkinstaller available (PEAR&#39;s PHP-GTK-based installer)</span><br><span class="line">PEAR: Optional feature gtk2installer available (PEAR&#39;s PHP-GTK2-based installer)</span><br><span class="line">PEAR: To install optional features use &quot;pear install pear&#x2F;PEAR#featurename&quot;</span><br><span class="line"></span><br><span class="line">The &#39;pear&#39; command is now at your service at &#x2F;usr&#x2F;local&#x2F;bin&#x2F;pear</span><br><span class="line"></span><br><span class="line">** The &#39;pear&#39; command is not currently in your PATH, so you need to</span><br><span class="line">** use &#39;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;pear&#39; until you have added</span><br><span class="line">** &#39;&#x2F;usr&#x2F;local&#x2F;bin&#39; to your PATH environment variable.</span><br><span class="line"></span><br><span class="line">Run it without parameters to see the available actions, try &#39;pear list&#39;</span><br><span class="line">to see what packages are installed, or &#39;pear help&#39; for help.</span><br><span class="line"></span><br><span class="line">For more information about PEAR, see:</span><br><span class="line"></span><br><span class="line">  http:&#x2F;&#x2F;pear.php.net&#x2F;faq.php</span><br><span class="line">  http:&#x2F;&#x2F;pear.php.net&#x2F;manual&#x2F;</span><br><span class="line"></span><br><span class="line">Thanks for using go-pear!</span><br></pre></td></tr></table></figure>


<h2><span id="pecl-インストール確認">PECL インストール確認</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ which pecl</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;pecl</span><br><span class="line"></span><br><span class="line">$ pecl version</span><br><span class="line">PEAR Version: 1.10.4</span><br><span class="line">PHP Version: 7.0.19</span><br><span class="line">Zend Engine Version: 3.0.0</span><br><span class="line">Running on: Darwin pc-12-332.local 16.5.0 Darwin Kernel Version 16.5.0: Fri Mar  3 16:52:33 PST 2017; root:xnu-3789.51.2~3&#x2F;RELEASE_X86_64 x86_64</span><br></pre></td></tr></table></figure>

<h2><span id="pear-インストール確認">PEAR インストール確認</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ which pear</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;pear</span><br><span class="line"></span><br><span class="line">PEAR Version: 1.10.4</span><br><span class="line">PHP Version: 7.0.19</span><br><span class="line">Zend Engine Version: 3.0.0</span><br><span class="line">Running on: Darwin pc-12-332.local 16.5.0 Darwin Kernel Version 16.5.0: Fri Mar  3 16:52:33 PST 2017; root:xnu-3789.51.2~3&#x2F;RELEASE_X86_64 x86_64</span><br></pre></td></tr></table></figure>

<p>以上です。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image" href="/2017/05/15/2017-05-16-gke-kubernetes-hubot/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170604/20170604224801.png" alt="無料枠で運用！ GKE + Kubernetes で Hubot 〜独自ネットワーク作成、設定ファイルから起動編〜"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-05-15T15:00:00.000Z" title="2017-05-15T15:00:00.000Z">$2017-05-16</time></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/05/15/2017-05-16-gke-kubernetes-hubot/">無料枠で運用！ GKE + Kubernetes で Hubot 〜独自ネットワーク作成、設定ファイルから起動編〜</a></h1><div class="content"><p>前回手元のMacからコンテナクラスタ → Deployment → LB 作成する手順をまとめました。</p>
<a href="http://kenzo0107.hatenablog.com/entry/2017/05/10/012945" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="http://i.imgur.com/Vvmetu1.png"></div><div class="descriptions"><div class="og-title">無料枠で運用！ GKE + Kubernetes で Hubot 〜CLIから実行編〜 - 長生村本郷Engineers&#39;Blog</div><div class="og-description">概要 無料枠を使って Slack 連携する Hubot を GKE で構築します。 おまけで JIRA 連携も Google Cloud SDK のインストール方法と初期化 Mac OS X 用クイックスタート を参照して SDK をダウンロードします。 Mac OS X (x8…</div></div></div></a>


<p>但し、8080ポートがフルオープンとなってしまい、誰でもアクセスが可能であるという、<br>セキュリティ的に非常によろしくない状態でした。</p>
<p>その為、今回は以下実施します。</p>
<ul>
<li>独自ネットワーク(ファイアウォール)作成</li>
<li>独自ネットワーク上にクラスタ作成</li>
<li>設定ファイルでコンテナ起動・更新</li>
</ul>
<p>前回の独自ネットワーク設定していないクラスタは削除して問題ないです。お任せします <code>m(_ _)m</code></p>
<h2><span id="前回同様の-git-repository-用意">前回同様の Git Repository 用意</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/kenzo0107/hubot-slack-on-docker</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> hubot-slack-on-docker</span></span><br></pre></td></tr></table></figure>

<h2><span id="network-作成">Network 作成</span></h2><ul>
<li><code>hubot-network</code> というネットワークを作成します。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ gcloud compute networks create hubot-network</span><br></pre></td></tr></table></figure>

<h2><span id="ファイアウォール作成">ファイアウォール作成</span></h2><ul>
<li>作成したネットワークに特定 IP からのみ 8080 ポートアクセス許可</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ gcloud compute firewall-rules create hubot-rule --network hubot-network --allow tcp:8080 --source-ranges xxx.xxx.xxx.xxx,yyy.yyy.yyy.yyy.yyy</span><br></pre></td></tr></table></figure>

<h2><span id="container-clusters-作成">Container Clusters 作成</span></h2><ul>
<li>作成したネットワーク指定しクラスタ作成</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ gcloud container clusters create hubot-cluster-free \</span><br><span class="line">      --machine-type f1-micro \</span><br><span class="line">      --disk-size&#x3D;30 \</span><br><span class="line">      --num-nodes&#x3D;3 \</span><br><span class="line">      --network&#x3D;hubot-network \</span><br><span class="line">      --cluster-ipv4-cidr&#x3D;10.0.0.0&#x2F;14</span><br></pre></td></tr></table></figure>

<ul>
<li><span style="color: #ff0000">cluster-ipv4-cidr オプション必須！</span><br>指定しクラスタ内の Pod のIPアドレスの範囲指定しています。<br>※サブネットマスク(10.0.0.0/14 の “/14” 部分)指定は9〜19で指定する必要があります。</li>
</ul>
<p>例) –cluster-ipv4-cidr=10.0.0.0/8 指定した場合のエラー</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR: (gcloud.container.clusters.create) ResponseError: code&#x3D;400, message&#x3D;cluster.cluster_ipv4_cidr CIDR block size must be no bigger than &#x2F;9 and no smaller than &#x2F;19, found &#x2F;8.</span><br></pre></td></tr></table></figure>

<h2><span id="ノード数を-1-に変更">ノード数を 1 に変更</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ gcloud container clusters resize hubot-cluster-free --size&#x3D;1</span><br></pre></td></tr></table></figure>

<h2><span id="deployment-作成">Deployment 作成</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl create -f gke-deployment.yml</span><br></pre></td></tr></table></figure>

<h3><span id="deployment-replicaset-pod-一覧表示">Deployment, Replicaset, Pod 一覧表示</span></h3><ul>
<li>ラベル付けした <code>app: hubot</code> を条件指定</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl get deployments,replicasets,pods --selector app&#x3D;hubot</span><br></pre></td></tr></table></figure>

<h3><span id="フォーマットを-yaml-形式で出力">フォーマットを yaml 形式で出力</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl get deployment deployment-hubot -o yaml</span><br></pre></td></tr></table></figure>

<h2><span id="サービス公開する為-loadbalancer-付加">サービス公開する為、LoadBalancer 付加</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl create -f gke-lb.yml</span><br></pre></td></tr></table></figure>

<h2><span id="サービス一覧表示">サービス一覧表示</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl get svc</span><br><span class="line">NAME           CLUSTER-IP     EXTERNAL-IP     PORT(S)          AGE</span><br><span class="line">kubernetes     10.3.240.1     &lt;none&gt;          443&#x2F;TCP          20m</span><br><span class="line">loadbalancer   10.3.241.129   zz.zzz.zzz.zzz   8080:31628&#x2F;TCP   4m</span><br></pre></td></tr></table></figure>

<p>※EXTERNAL-IP : <code>zz.zzz.zzz.zzz</code> はグローバルIP</p>
<h2><span id="いざ-テスト">いざ、テスト !</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ curl \</span><br><span class="line">-X POST \</span><br><span class="line">-H &quot;Content-Type: application&#x2F;json&quot; \</span><br><span class="line">-d \</span><br><span class="line">&#39;&#123;</span><br><span class="line"> &quot;webhookEvent&quot;:&quot;jira:issue_updated&quot;,</span><br><span class="line"> &quot;comment&quot;:&#123;</span><br><span class="line">   &quot;author&quot;:&#123;</span><br><span class="line">     &quot;name&quot;:&quot;himuko&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;body&quot;:&quot;[~kenzo.tanaka] 東京03 秋山 ケンコバ 劇団ひとり&quot;</span><br><span class="line"> &#125;,</span><br><span class="line"> &quot;issue&quot;: &#123;</span><br><span class="line">   &quot;key&quot;:&quot;key&quot;,</span><br><span class="line">   &quot;fields&quot;:&#123;</span><br><span class="line">     &quot;summary&quot;:&quot;summary&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#39; \</span><br><span class="line">http:&#x2F;&#x2F;zz.zzz.zzz.zzz:8080&#x2F;hubot&#x2F;jira-comment-dm</span><br></pre></td></tr></table></figure>

<ul>
<li>できた！<br>[f:id:kenzo0107:20170516220548p:plain]</li>
</ul>
<h2><span id="更新ローリングアップデート">更新（ローリングアップデート）</span></h2><p>ReplicationController を利用することで無停止で更新します。</p>
<p>実際に以下の様にして更新しているのが確認できます。</p>
<ul>
<li>既存の Running 中のコンテナの個数分、更新したイメージからビルドしたコンテナを起動</li>
<li>更新版コンテナがRunning状態になったら既存コンテナを削除</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ローカルで更新した Docker Container を コミット</span><br><span class="line">macOS%$ docker commit 12f77feb09b4 gcr.io&#x2F;hubot-167007&#x2F;hubot:latest</span><br><span class="line">&#x2F;&#x2F; Google Container Registory にプッシュ</span><br><span class="line">macOS%$ gcloud docker -- push gcr.io&#x2F;hubot-167007&#x2F;hubot:latest</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Pod 表示</span><br><span class="line">macOS%$ kubectl get pods</span><br><span class="line">NAME                                                      READY     STATUS    RESTARTS   AGE</span><br><span class="line">deployment-hubot-cfe7528ee0b5059b14a30b942597e5ef-z8nws   1&#x2F;1       Running   1          1d</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; push したImageを元にローリングアップデート</span><br><span class="line">macOS%$ kubectl rolling-update deployment-hubot-cfe7528ee0b5059b14a30b942597e5ef-z8nws --image&#x3D;gcr.io&#x2F;hubot-167007&#x2F;hubot:latest</span><br></pre></td></tr></table></figure>

<h2><span id="後片付け">後片付け</span></h2><ul>
<li>Deployment 削除</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl delete -f gke-deployment.yml</span><br></pre></td></tr></table></figure>

<ul>
<li>LoadBalancer 削除</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl delete -f gke-lb.yml</span><br></pre></td></tr></table></figure>

<h2><span id="総評">総評</span></h2><p>ネットワークのファイアウォール設定してコンテナ起動したが動かなかった所、かなり詰まりました (; <del>_</del>)<br>Stackoverflow にたまたま同様のイシューをあげている方がおり参考にさせて頂きました。<br>助かった汗</p>
<p>これから Nginx + Rails 等、よくありそうなケースで GKE + Kubernetes を試して運用してみたいと思います。<br>まとまったらまた追記します！</p>
<h2><span id="参考">参考</span></h2><p><a href="http://stackoverflow.com/questions/38057066/unable-to-launch-a-gke-google-container-engine-cluster-with-a-custom-network">Unable to launch a GKE (Google Container Engine) cluster with a custom network</a></p>
</div></article></div><div class="card"><div class="card-image"><a class="image" href="/2017/05/09/2017-05-10-gke-kubernetes-hubot-cli/"><img class="thumbnail" src="http://i.imgur.com/Vvmetu1.png" alt="無料枠で運用！ GKE + Kubernetes で Hubot 〜CLIから実行編〜"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-05-09T15:00:00.000Z" title="2017-05-09T15:00:00.000Z">$2017-05-10</time></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/05/09/2017-05-10-gke-kubernetes-hubot-cli/">無料枠で運用！ GKE + Kubernetes で Hubot 〜CLIから実行編〜</a></h1><div class="content"><h2><span id="概要">概要</span></h2><ul>
<li>無料枠を使って Slack 連携する Hubot を GKE で構築します。</li>
<li>おまけで JIRA 連携も</li>
</ul>
<h2><span id="google-cloud-sdk-のインストール方法と初期化">Google Cloud SDK のインストール方法と初期化</span></h2><p><a href="https://cloud.google.com/sdk/docs/quickstart-mac-os-x">Mac OS X 用クイックスタート</a> を参照して SDK をダウンロードします。</p>
<ul>
<li>Mac OS X (x86_64), (x86) かは以下コマンドで確認</li>
</ul>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ uname -m</span><br><span class="line"></span><br><span class="line">x86_64</span><br></pre></td></tr></table></figure>

<h2><span id="kubectl-のインストール">kubectl のインストール</span></h2><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ gcloud components update kubectl</span><br></pre></td></tr></table></figure>

<h2><span id="gcloud-デフォルト設定">gcloud デフォルト設定</span></h2><p>以下は作成したプロジェクト、リージョン、ゾーンを設定してます。<br>今後 gcloud コマンド実行時に region 指定等しなくて良くなります。</p>
<ul>
<li>作成したプロジェクトID : <code>hubot-167007</code></li>
<li>us-west 利用で無料枠を使う為に US リージョンに設定してます。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ gcloud auth login</span><br><span class="line">macOS%$ gcloud config set project hubot-167007</span><br><span class="line">macOS%$ gcloud config set compute&#x2F;region us-west1</span><br><span class="line">macOS%$ gcloud config set compute&#x2F;zone us-west1-b</span><br></pre></td></tr></table></figure>


<p><a href="https://cloud.google.com/free/">Google Cloud Platform の無料階層</a> 参照してください。</p>
<h2><span id="クラスタ作成">クラスタ作成</span></h2><ul>
<li>無料枠を利用するべく f1-micro で 30GB 設定</li>
<li>でも作成時は 3 ノード必須</li>
<li>作成完了後、リサイズで 1 ノードに</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ gcloud container clusters create hubot-cluster-free \</span><br><span class="line">      --machine-type f1-micro \</span><br><span class="line">      --disk-size&#x3D;30 \</span><br><span class="line">      --num-nodes&#x3D;3</span><br><span class="line"></span><br><span class="line">Creating cluster hubot-cluster-free...done.</span><br><span class="line">Created [https:&#x2F;&#x2F;container.googleapis.com&#x2F;v1&#x2F;projects&#x2F;hubot-167007&#x2F;zones&#x2F;us-west1-b&#x2F;clusters&#x2F;hubot-cluster-free].</span><br><span class="line">kubeconfig entry generated for hubot-cluster-free.</span><br><span class="line">NAME                ZONE        MASTER_VERSION  MASTER_IP       MACHINE_TYPE  NODE_VERSION  NUM_NODES  STATUS</span><br><span class="line">hubot-cluster-free  us-west1-b  1.5.7           35.xxx.xxx.xxx  f1-micro      1.5.7         3          RUNNING</span><br></pre></td></tr></table></figure>

<ul>
<li>コンソールを見ると作成中であることが確認できます。</li>
</ul>
<p><img src="http://i.imgur.com/O3LQy9q.png" alt="Imgur"></p>
<ul>
<li>以下コマンドで確認可</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">macOS% $ kubectl get nodes</span><br><span class="line">NAME                                                STATUS    AGE       VERSION</span><br><span class="line">gke-hubot-cluster-free-default-pool-a3b110d2-9k6s   Ready     59s       v1.5.7</span><br><span class="line">gke-hubot-cluster-free-default-pool-a3b110d2-lqxg   Ready     1m        v1.5.7</span><br><span class="line">gke-hubot-cluster-free-default-pool-a3b110d2-xqs8   Ready     1m        v1.5.7</span><br></pre></td></tr></table></figure>

<ul>
<li>1 ノードにリサイズ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ gcloud container clusters resize hubot-cluster-free --size&#x3D;1</span><br><span class="line"></span><br><span class="line">Pool [default-pool] for [hubot-cluster-free] will be resized to 1.</span><br><span class="line"></span><br><span class="line">Do you want to continue (Y&#x2F;n)?  y</span><br><span class="line"></span><br><span class="line">Resizing hubot-cluster-free...done.</span><br><span class="line">Updated [https:&#x2F;&#x2F;container.googleapis.com&#x2F;v1&#x2F;projects&#x2F;hubot-167007&#x2F;zones&#x2F;us-west1-b&#x2F;clusters&#x2F;hubot-cluster-free].</span><br></pre></td></tr></table></figure>

<p><img src="http://i.imgur.com/KTGg91y.png" alt="Imgur"></p>
<p>リサイズできるなら初めから 1 ノードで作らせて欲しい (&gt;_&lt;)</p>
<p>コンソール上だとやっぱりダメ (T_T)</p>
<p><img src="http://i.imgur.com/TpNz2yj.png" alt="Imgur"></p>
<h2><span id="認証情報-取得">認証情報 取得</span></h2><ul>
<li>コンテナクラスタの認証情報を取得し、kubectlを利用してコンテナ クラスタ上にコンテナを作成できるようになります。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ gcloud container clusters get-credentials hubot-cluster-free</span><br><span class="line"></span><br><span class="line">Fetching cluster endpoint and auth data.</span><br><span class="line">kubeconfig entry generated for hubot-cluster-free.</span><br></pre></td></tr></table></figure>

<ul>
<li>コンテナクラスタ情報表示</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ gcloud container clusters describe hubot-cluster-free</span><br></pre></td></tr></table></figure>

<h2><span id="ローカルの-docker-起動">ローカルの Docker 起動</span></h2><p>[<a href="https://github.com/kenzo0107/hubot-slack-on-docker:embed:cite]">https://github.com/kenzo0107/hubot-slack-on-docker:embed:cite]</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ git clone https:&#x2F;&#x2F;github.com&#x2F;kenzo0107&#x2F;hubot-slack-on-docker</span><br><span class="line">macOS%$ cd hubot-slack-on-docker</span><br><span class="line">macOS%$ docker-compose up -d</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ docker ps</span><br><span class="line"></span><br><span class="line">CONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                              NAMES</span><br><span class="line">12f77feb09b4        hubotslackondocker_hubot   &quot;&#x2F;bin&#x2F;sh -c &#39;bash ...&quot;   24 minutes ago      Up 24 minutes       6379&#x2F;tcp, 0.0.0.0:8080-&gt;8080&#x2F;tcp   hubotslackondocker_hubot_1</span><br></pre></td></tr></table></figure>

<h2><span id="hubot-動作確認">Hubot 動作確認</span></h2><p>Slack上に Hubot が登場していて <code>hello</code> と呼びかけると <code>Hi</code> と返してくれたら成功です。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170510/20170510012328.png" width="100%">
</div>

<h2><span id="container-id-から-イメージをcommit">CONTAINER ID から イメージをcommit</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ docker commit 12f77feb09b4 gcr.io&#x2F;hubot-167007&#x2F;hubot:latest</span><br><span class="line"></span><br><span class="line">macOS%$ docker images</span><br><span class="line">REPOSITORY                       TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">gcr.io&#x2F;hubot-167007&#x2F;hubot        latest              2f7336b3a3ce        3 seconds ago       484 MB</span><br></pre></td></tr></table></figure>



<h2><span id="gke-registory-に-push">gke registory に push</span></h2><p>参考: <a href="https://cloud.google.com/container-registry/docs/pushing?hl=ja&_ga=1.49491107.421538973.1494071894">Container Registry への push</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ gcloud docker -- push gcr.io&#x2F;hubot-167007&#x2F;hubot:latest</span><br><span class="line"></span><br><span class="line">The push refers to a repository [gcr.io&#x2F;hubot-167007&#x2F;hubot]</span><br><span class="line">0569b419082b: Pushed</span><br><span class="line">a7637cfcdfba: Pushed</span><br><span class="line">9f0bdbb7b1fa: Pushed</span><br><span class="line">f1d85eafc75a: Pushed</span><br><span class="line">c2c2b58591f2: Pushed</span><br><span class="line">51c94eacef50: Pushed</span><br><span class="line">69e7fcf7ba41: Pushed</span><br><span class="line">293d09ca6a9d: Pushed</span><br><span class="line">247e72dfcaf5: Pushed</span><br><span class="line">8c2bc9bf1f19: Pushed</span><br><span class="line">40907ce0d959: Pushed</span><br><span class="line">bfba578a7fbe: Pushed</span><br><span class="line">561cbcaac156: Pushed</span><br><span class="line">293a1e72e88b: Pushed</span><br><span class="line">ae09eb3da3dc: Pushed</span><br><span class="line">c06c14d7f919: Pushed</span><br><span class="line">e14577d2cac5: Layer already exists</span><br><span class="line">e8829d5bbd2c: Layer already exists</span><br><span class="line">674ce3c5d814: Layer already exists</span><br><span class="line">308b39a73046: Layer already exists</span><br><span class="line">638903ee8579: Layer already exists</span><br><span class="line"></span><br><span class="line">latest: digest: sha256:0c3b29d18b64c1f8ecc1a1bf67462c84d5915a4a708fe87df714d09198eb5fa1 size: 4704</span><br></pre></td></tr></table></figure>

<ul>
<li>latest が被ると過去のイメージのタグが奪われます。容量の無駄になるので削除しましょう。</li>
</ul>
<p><img src="http://i.imgur.com/YlADlds.png" alt="Imgur"></p>
<h2><span id="deployments-作成">Deployments 作成</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl run pod-hubot \</span><br><span class="line">      --image&#x3D;gcr.io&#x2F;hubot-167007&#x2F;hubot:latest \</span><br><span class="line">      --env&#x3D;&quot;HUBOT_SLACK_TOKEN&#x3D;xoxb-xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxx&quot; \</span><br><span class="line">      --env&#x3D;&quot;HUBOT_SLACK_TEAM&#x3D;xxxxxx.slack.com&quot; \</span><br><span class="line">      --env&#x3D;&quot;HUBOT_SLACK_BOTNAME&#x3D;hubot&quot; \</span><br><span class="line">      --env&#x3D;&quot;HUBOT_JIRA_URL&#x3D;https:&#x2F;&#x2F;&lt;jira_server_domain_or_ip&gt;&quot; \</span><br><span class="line">      --port&#x3D;8080 \</span><br><span class="line">      --restart&#x3D;&#39;Always&#39;</span><br><span class="line"></span><br><span class="line">deployment &quot;pod-hubot&quot; created</span><br></pre></td></tr></table></figure>

<ul>
<li>deployments 状態確認</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl get deployments</span><br><span class="line">NAME        DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">pod-hubot   1         1         1            0           10s</span><br></pre></td></tr></table></figure>

<ul>
<li>Pod 状態確認</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl get pods</span><br><span class="line"></span><br><span class="line">NAME                         READY     STATUS             RESTARTS   AGE</span><br><span class="line">pod-hubot-1713414922-b2dkq   0&#x2F;1       ImagePullBackOff   0          23s</span><br></pre></td></tr></table></figure>

<ul>
<li>Pod にログイン</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl exec -it pod-hubot-1713414922-b2dkq &#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>

<ul>
<li>service の状態確認</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl get service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NAME         CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes   10.23.240.1   &lt;none&gt;        443&#x2F;TCP   22m</span><br></pre></td></tr></table></figure>

<p><code>EXTERNAL-IP: &lt;none&gt;</code> … 外部へ開いているIPがない。という状態<br>Private IP は付与されたが Public IP がない、外部のネットワークからアクセスできない状態です。</p>
<h2><span id="コンテナ公開">コンテナ公開</span></h2><ul>
<li>Service にロードバランサ付与し公開</li>
</ul>
<p>※ ロードバランサを追加すると課金の桁が跳ね上がります。。<br>（2000円/月くらい。念の為、設定した予算アラートでわかりました。）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl expose deployment pod-hubot --type&#x3D;&quot;LoadBalancer&quot;</span><br><span class="line">service &quot;pod-hubot&quot; exposed</span><br></pre></td></tr></table></figure>

<ul>
<li>Service 確認</li>
</ul>
<p><code>EXTERNAL-IP: &lt;pending&gt;</code> となっており、作成途中であることがわかります。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl get service</span><br><span class="line"></span><br><span class="line">NAME         CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">kubernetes   10.23.240.1     &lt;none&gt;        443&#x2F;TCP          25m</span><br><span class="line">pod-hubot    10.23.244.214   &lt;pending&gt;     8080:30453&#x2F;TCP   8s</span><br></pre></td></tr></table></figure>

<ul>
<li>再度 Service 確認</li>
</ul>
<p>無事付与されているのがわかりました。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl get service</span><br><span class="line">NAME         CLUSTER-IP      EXTERNAL-IP     PORT(S)          AGE</span><br><span class="line">kubernetes   10.23.240.1     &lt;none&gt;          443&#x2F;TCP          27m</span><br><span class="line">pod-hubot    10.23.244.214   104.xxx.x.xxx   8080:30453&#x2F;TCP   1m</span><br></pre></td></tr></table></figure>

<h2><span id="テスト">テスト</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ curl \</span><br><span class="line">-X POST \</span><br><span class="line">-H &quot;Content-Type: application&#x2F;json&quot; \</span><br><span class="line">-d \</span><br><span class="line">&#39;&#123;</span><br><span class="line"> &quot;webhookEvent&quot;:&quot;jira:issue_updated&quot;,</span><br><span class="line"> &quot;comment&quot;:&#123;</span><br><span class="line">   &quot;author&quot;:&#123;</span><br><span class="line">     &quot;name&quot;:&quot;himuko&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;body&quot;:&quot;[~kenzo.tanaka] 東京03 秋山 ケンコバ 劇団ひとり&quot;</span><br><span class="line"> &#125;,</span><br><span class="line"> &quot;issue&quot;: &#123;</span><br><span class="line">   &quot;key&quot;:&quot;key&quot;,</span><br><span class="line">   &quot;fields&quot;:&#123;</span><br><span class="line">     &quot;summary&quot;:&quot;summary&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#39; \</span><br><span class="line">http:&#x2F;&#x2F;104.xxx.x.xxx:8080&#x2F;hubot&#x2F;jira-comment-dm</span><br></pre></td></tr></table></figure>

<p><img src="http://i.imgur.com/8FOYcyI.png" alt="Imgur"></p>
<h2><span id="後始末">後始末</span></h2><p>掃除しときたい場合に以下実行してください。</p>
<ul>
<li>service 削除</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl delete service pod-hubot</span><br><span class="line">service &quot;pod-hubot&quot; deleted</span><br></pre></td></tr></table></figure>

<ul>
<li>pod 削除</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl delete pod pod-hubot-729436916-htw3r</span><br><span class="line">service &quot;pod-hubot&quot; deleted</span><br></pre></td></tr></table></figure>

<ul>
<li>deployments 削除</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ kubectl delete deployments pod-hubot</span><br></pre></td></tr></table></figure>

<ul>
<li>container clusters 削除<br>container cluster を削除すれば紐付く deployments, service, pod も削除されます。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ gcloud container clusters delete hubot-cluster-free</span><br></pre></td></tr></table></figure>

<p>以上です。</p>
<h2><span id="総評">総評</span></h2><p>GKEは概念が多く、一概に deployment, pod, service, kubernetes 等覚えることが多いですが<br>動かしつつ学ぶのは楽しいです。</p>
<p>ほぼ手元の Mac で設定できました！<br>手元で済むから <code>macOS%$</code> は不要だった。。</p>
<p>今回作成した service だと外部に 8080 ポート全開です。</p>
<p><a href="http://kenzo0107.hatenablog.com/entry/2017/05/16/222815">次回</a>はアクセス元を制限したポートアクセスやコンテナのアップデートについてまとめます。</p>
<p>[<a href="http://kenzo0107.hatenablog.com/entry/2017/05/16/222815:embed:cite]">http://kenzo0107.hatenablog.com/entry/2017/05/16/222815:embed:cite]</a></p>
</div></article></div><div class="card"><div class="card-image"><a class="image" href="/2017/04/30/2017-05-01-nginx-prometheus-nodeexporter-grafana-cadvisor-on-raspi3/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170430/20170430235153.png" alt="Raspberry PI3 Model B に docker-compose で Nginx で認証かけて Prometheus + Node Exporter + Grafana + cAdvisor構築"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-04-30T15:00:00.000Z" title="2017-04-30T15:00:00.000Z">$2017-05-01</time></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/30/2017-05-01-nginx-prometheus-nodeexporter-grafana-cadvisor-on-raspi3/">Raspberry PI3 Model B に docker-compose で Nginx で認証かけて Prometheus + Node Exporter + Grafana + cAdvisor構築</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>Raspi3に docker-compose で Prometheus による監視機構を作成しました。</p>
<a href="https://github.com/kenzo0107/vagrant-docker/tree/master/docker/prometheus-grafana-on-raspi3" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://avatars0.githubusercontent.com/u/6197906?s=400&v=4"></div><div class="descriptions"><div class="og-title">kenzo0107/vagrant-docker</div><div class="og-description">Docker on Vagrant(ubuntu). Contribute to kenzo0107/vagrant-docker development by creating an account on GitHub.</div></div></div></a>

<h2><span id="環境">環境</span></h2><ul>
<li>Raspberry Pi 3 Model B (Raspbian GNU/Linux 8) arm7l</li>
<li>Docker version 17.04.0-ce, build 4845c56</li>
<li>docker-compose version 1.9.0, build 2585387</li>
</ul>
<h2><span id="raspi-に-docker-インストール">Raspi に docker インストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">raspi%$ wget -qO- https:&#x2F;&#x2F;get.docker.com&#x2F; | sh</span><br><span class="line">raspi%$ sudo usermod -aG docker pi</span><br><span class="line">raspi%$ sudo gpasswd -a $USER docker</span><br></pre></td></tr></table></figure>

<h2><span id="raspi-に-docker-compose-インストール">Raspi に docker-compose インストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">raspi%$ sudo apt-get update</span><br><span class="line">raspi%$ sudo apt-get install -y apt-transport-https</span><br><span class="line">raspi%$ echo &quot;deb https:&#x2F;&#x2F;packagecloud.io&#x2F;Hypriot&#x2F;Schatzkiste&#x2F;debian&#x2F; jessie main&quot; | raspi%sudo tee &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;hypriot.list</span><br><span class="line">raspi%$ sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 37BBEE3F7AD95B3F</span><br><span class="line">raspi%$ sudo apt-get update</span><br><span class="line">raspi%$ sudo apt-get install docker-compose</span><br></pre></td></tr></table></figure>

<ul>
<li>version 確認</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">raspi%$ docker-compose --version</span><br><span class="line">docker-compose version 1.9.0, build 2585387</span><br></pre></td></tr></table></figure>

<h2><span id="docker-compose-のプロジェクト設定">docker-compose のプロジェクト設定</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">raspi%$ cd ~</span><br><span class="line">raspi%$ git clone https:&#x2F;&#x2F;github.com&#x2F;kenzo0107&#x2F;vagrant-docker</span><br><span class="line">raspi%$ cd vagrant-docker&#x2F;docker&#x2F;prometheus-grafana-on-raspi3</span><br></pre></td></tr></table></figure>

<h2><span id="nginx-basic-認証設定">Nginx Basic 認証設定</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.htpasswd 作成時のユーザ&#x2F;パス &#x3D;&#x3D; GF_SECURITY_ADMIN_USER&#x2F;GF_SECURITY_ADMIN_PASSWORD</span><br></pre></td></tr></table></figure>
<p>である必要があります。</p>
<p>Grafana の認証機能により設定した Basic 認証でログインできる仕組みがあり、<br>一致しない場合、ログインできず、失敗します。</p>
<ul>
<li><p>grafana/env</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GF_SECURITY_ADMIN_USER&#x3D;admin-user</span><br><span class="line">GF_SECURITY_ADMIN_PASSWORD&#x3D;admin-pass</span><br></pre></td></tr></table></figure>
</li>
<li><p>.htpasswd</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">raspi%$ htpasswd -c nginx&#x2F;conf&#x2F;conf.d&#x2F;.htpasswd admin-user</span><br><span class="line">New password: (「admin-pass」と入力しEnter)</span><br><span class="line">Re-type new password: (「admin-pass」と入力しEnter)</span><br><span class="line">Adding password for user admin-user</span><br><span class="line"></span><br><span class="line">raspi%$ cat nginx&#x2F;conf&#x2F;conf.d&#x2F;.htpasswd</span><br><span class="line">admin-user:$apr1$JLxC83lt$uO7aEn9Z59fZtba4EA7C6&#x2F;</span><br></pre></td></tr></table></figure>

<h2><span id="cron設定">Cron設定</span></h2><p>Raspi の温度や電圧を定期取得し Prometheus に読み込ませるファイル(*.prom)作成します。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*&#x2F;5 * * * * &lt;home&#x2F;to&#x2F;path&gt;&#x2F;vagrant-docker&#x2F;docker&#x2F;prometheus-grafana-on-raspi3&#x2F;node-exporter&#x2F;collector&#x2F;raspi.sh</span><br></pre></td></tr></table></figure>

<h2><span id="docker-compose-により-docker-起動">docker-compose により Docker 起動</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">raspi%$ docker-compose up -d</span><br></pre></td></tr></table></figure>

<h2><span id="grafana-にアクセスしてみる">Grafana にアクセスしてみる</span></h2><p><code>http://&lt;your_server_ip&gt;:13000</code> にアクセスすると .htpasswd で指定したユーザ/パスを求められるので入力します</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170430/20170430235949.png" width="100%">
</div>

<p>その後、Grafana のページが表示されれば成功です。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170501/20170501002430.png" width="100%">
</div>

<p>「Add data Source」をクリックします。</p>
<h2><span id="data-source-設定">Data Source 設定</span></h2><p>以下の様に設定し「Save &amp; Test」をクリックししSuccessすることを確認します。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170501/20170501002606.png" width="100%">
</div>


<h2><span id="dashboardjson-インポート">Dashboard.json インポート</span></h2><p>左上のアイコンから Dashboards &gt; Import 選択し DockerDashboard.json をインポートします。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170501/20170501003915.png" width="100%">
</div>

<h2><span id="dashboard-表示">Dashboard 表示</span></h2><div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170501/20170501003051.png" width="100%">
</div>


<h2><span id="ポイント">ポイント !</span></h2><h3><span id="セキュリティ上の観点から外から直接-grafana-を参照させない様にしました">セキュリティ上の観点から外から直接 Grafana を参照させない様にしました。</span></h3><p>nginx/conf/conf.d/default.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        auth_basic &quot;Restricted&quot;;</span><br><span class="line">        auth_basic_user_file &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;.htpasswd;</span><br><span class="line"></span><br><span class="line">        proxy_pass                          http:&#x2F;&#x2F;grafana:3000&#x2F;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3><span id="image-選びは慎重に">image 選びは慎重に。</span></h3><p>以下の点で非常にハマりました。</p>
<ol>
<li>Raspberry Pi3 Model B (今回はarm7l)上で動作するか</li>
<li>Nginx で Proxy 機能が正しく動作するか</li>
</ol>
<p>nginx のproxy機能で grafana に繋げても 以下の様に表示されてしまうケースにぶつかりまくりました。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;alert.title&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2><span id="総評">総評</span></h2><p>イメージ探しについ時間取ってしまいましたが<br>自作した方が早かったかもと反省。</p>
<p>今回は自身を監視するという仕組みにしましたが外部から監視し相互に監視し合う体制が必要です。<br>家庭内稟議が通ればもう一台getしよう！</p>
<p>そして、家庭の為になるものを作ろう！</p>
</div></article></div><div class="card"><div class="card-image"><a class="image" href="/2017/04/26/2017-04-27-peco/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170427/20170427172718.jpg" alt="peco 小技シリーズ  〜多段ssh + peco, ghq + peco + atom〜"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-04-26T15:00:00.000Z" title="2017-04-26T15:00:00.000Z">$2017-04-27</time><span class="level-item"><a class="link-muted" href="/categories/Go/">Go</a></span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/26/2017-04-27-peco/">peco 小技シリーズ  〜多段ssh + peco, ghq + peco + atom〜</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>本当に小技です。<br>が、割と使ってみると作業時間の短縮となって便利という声を頂き<br>peco 関連でよく使うものを記事にしました。</p>
<h2><span id="peco-インストール">peco インストール</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS %$ brew install peco</span><br></pre></td></tr></table></figure>

<h2><span id="ssh-ログインする-host-を検索して選択">ssh ログインする Host を検索して選択</span></h2><p>前提条件として <code>~/.ssh/config</code> で接続ホストを管理しています。</p>
<script src="//gist.github.com/kenzo0107/06b3b1e202f36b70815cfe0207292a66.js"></script>

<p>上記を <code>~/.bashrc</code> などに貼り付けて <code>source ~/.bashrc</code> すれば使えます♪</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">macOS %$ git clone https:&#x2F;&#x2F;gist.github.com&#x2F;kenzo0107&#x2F;06b3b1e202f36b70815cfe0207292a66</span><br><span class="line">macOS %$ cd 06b3b1e202f36b70815cfe0207292a66</span><br><span class="line">macOS %$ cat peco-sshconfig-ssh.sh &gt;&gt; ~&#x2F;.bashrc</span><br><span class="line">macOS %$ source ~&#x2F;.bashrc</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; sshc 実行！</span><br><span class="line">macOS %$ sshc</span><br></pre></td></tr></table></figure>

<p>上記の様に順調に進むと候補がリストされます。<br>モザイクしかなくすいません (&gt;_&lt;)</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170427/20170427171121.png" width="100%">
</div>

<h2><span id="ghq-で管理している-repository-を検索して選択し-atom-で開く">ghq で管理している repository を検索して選択し atom で開く</span></h2><script src="//gist.github.com/kenzo0107/e460e31ae2478341cc7a39859ad7fefd.js"></script>

<p>こちらも同様、</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">macOS %$ git clone https:&#x2F;&#x2F;gist.github.com&#x2F;kenzo0107&#x2F;e460e31ae2478341cc7a39859ad7fefd</span><br><span class="line">macOS %$ cd e460e31ae2478341cc7a39859ad7fefd</span><br><span class="line">macOS %$ cat peco-git-atom.sh &gt;&gt; ~&#x2F;.bashrc</span><br><span class="line">macOS %$ source ~&#x2F;.bashrc</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; opg 実行！</span><br><span class="line">macOS %$ opg</span><br></pre></td></tr></table></figure>

<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170427/20170427171728.png" width="100%">
</div>

<p>他にも様々な箇所で peco を利用させて頂いてます。<br>こんな peco の使い所あるよーという方、是非教えてください♪</p>
<h2><span id="参照">参照</span></h2><p>zsh ですが dotfile をまとめてます。</p>
<a href="https://github.com/kenzo0107/dotfiles" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://avatars0.githubusercontent.com/u/6197906?s=400&v=4"></div><div class="descriptions"><div class="og-title">kenzo0107/dotfiles</div><div class="og-description">dotfile setting. Contribute to kenzo0107/dotfiles development by creating an account on GitHub.</div></div></div></a>
</div></article></div><div class="card"><div class="card-image"><a class="image" href="/2017/04/20/2017-04-21-fke-on-docker-compose/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170421/20170421221055.png" alt="docker-compose で開発環境構築 〜Nginx アクセスログ(ltsv) を fluentd + elasticsearch + kibana で可視化〜"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-04-20T15:00:00.000Z" title="2017-04-20T15:00:00.000Z">$2017-04-21</time></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/20/2017-04-21-fke-on-docker-compose/">docker-compose で開発環境構築 〜Nginx アクセスログ(ltsv) を fluentd + elasticsearch + kibana で可視化〜</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>前回構築した Vagrant 環境上で docker-compose による開発環境構築をします。</p>
<a href="http://kenzo0107.hatenablog.com/entry/2017/04/13/225610" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170413/20170413222957.png"></div><div class="descriptions"><div class="og-title">Vagrant (Ubuntu) に Docker, Docker Compose インストール - 長生村本郷Engineers&#39;Blog</div><div class="og-description">概要 開発環境構築用に作成した、 Vagrant (Ubuntu) に Docker と Docker Compose をインストールする手順をまとめました。 Vagrantfile 作成 かなりシンプルにしてます。 Vagrantfile # -*- mode: ruby -*…</div></div></div></a>

<p>今回は前回の続きで Nginx のアクセスログを Elasticsearch + Fluentd + Kibana で可視化してみます。<br>アプリ</p>
<h2><span id="簡単構築手順">簡単構築手順</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">macOS% $ git clone https:&#x2F;&#x2F;github.com&#x2F;kenzo0107&#x2F;vagrant-docker</span><br><span class="line">macOS% $ cd vagrant-docker</span><br><span class="line">macOS% $ vagrant up</span><br><span class="line">macOS% $ vagrant ssh</span><br><span class="line">vagrant% $ cd &#x2F;vagrant&#x2F;nginx-efk</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; -d デタッチモードでないのは各コンテナの起動状況がログで見える為です。</span><br><span class="line">vagrant% $ docker-compose up</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2><span id="docker-compose-構成">docker-compose 構成</span></h2><p>Git にまとめています。</p>
<a href="https://github.com/kenzo0107/vagrant-docker/tree/master/docker/nginx-efk" class="link-preview" target="_blank"><div class="link-area"><div class="og-image"><img src="https://avatars0.githubusercontent.com/u/6197906?s=400&v=4"></div><div class="descriptions"><div class="og-title">kenzo0107/vagrant-docker</div><div class="og-description">Docker on Vagrant(ubuntu). Contribute to kenzo0107/vagrant-docker development by creating an account on GitHub.</div></div></div></a>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">├── docker-compose.yml</span><br><span class="line">├── fluentd</span><br><span class="line">│   ├── conf</span><br><span class="line">│   │   ├── conf.d</span><br><span class="line">│   │   │   └── nginx.log.conf</span><br><span class="line">│   │   └── fluent.conf</span><br><span class="line">│   └── Dockerfile</span><br><span class="line">└── nginx</span><br><span class="line">    └── conf</span><br><span class="line">        └── nginx.conf</span><br></pre></td></tr></table></figure>

<h3><span id="ポイント">ポイント</span></h3><ul>
<li>nginx のログ格納場所を <code>volume</code> 指定しホスト側とシンク。 それを fluentd 側でも <code>volume</code> 指定し tail するようにしました。</li>
</ul>
<p>以下のようなイメージです。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170421/20170421221055.png" width="100%">
</div>

<h2><span id="ブラウザから-nginx-起動確認">ブラウザから Nginx 起動確認</span></h2><p>ブラウザから <code>http://192.168.35.101/</code> にアクセスすると<br>Nginx の Welcome ページが確認できます。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170421/20170421222343.png" width="100%">
</div>


<p>先程の <code>docker-compose up</code> 後に以下のようなログが見え<br>fluentd が Nginx アクセスログを捕まえているのがわかります。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170421/20170421222937.png" width="100%">
</div>

<h2><span id="kibana-にアクセス">Kibana にアクセス</span></h2><p>ブラウザから <code>http://192.168.35.101:5601</code> にアクセスすると<br>Kibana ページが表示されます。</p>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170421/20170421223008.png" width="100%">
</div>

<ol>
<li><p>Index name or pattern</p>
<ul>
<li>fluentd-* 指定</li>
</ul>
</li>
<li><p>Time-field name</p>
<ul>
<li>@timestamp 指定</li>
</ul>
</li>
<li><p>Create ボタン押下</p>
</li>
<li><p>レフトメニューから <code>Discover</code> クリック</p>
</li>
</ol>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170421/20170421223626.png" width="100%">
</div>

<h2><span id="macos-からログ確認">macOS からログ確認</span></h2><p>当然ながら macOS と vagrant とシンクしているので<br>macOS 上からもログが tail できます。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macOS%$ tail -f &lt;path&#x2F;to&#x2F;vagrant-docker&gt;&#x2F;docker&#x2F;nginx-efk&#x2F;_log&#x2F;nginx&#x2F;access.log</span><br></pre></td></tr></table></figure>

<p>以上です。<br>参考になれば幸いです。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image" href="/2017/04/17/2017-04-18-aws-retairement-notification/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170418/20170418105821.png" alt="AWS [Retirement Notification] 対応"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-04-17T15:00:00.000Z" title="2017-04-17T15:00:00.000Z">$2017-04-18</time></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/17/2017-04-18-aws-retairement-notification/">AWS [Retirement Notification] 対応</a></h1><div class="content"><h2><span id="概要">概要</span></h2><p>とある日、AWS よりこんなメール通知が来ました。</p>
<p>要約すると<br>ホストしている基盤のハードウェアで回復不可能な障害が検知されたので<br>指定期限までに対応しないとインスタンスが停止する、とのこと。</p>
<p>今回こちらの対応をまとめました。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Dear Amazon EC2 Customer,</span><br><span class="line"></span><br><span class="line">We have important news about your account (AWS Account ID: xxxxxxxxxxxx). EC2 has detected degradation of the underlying hardware hosting your Amazon EC2 instance (instance-ID: i-xxxxxxxx) in the ap-northeast-1 region. Due to this degradation, your instance could already be unreachable. After 2017-04-25 04:00 UTC your instance, which has an EBS volume as the root device, will be stopped.</span><br><span class="line"></span><br><span class="line">You can see more information on your instances that are scheduled for retirement in the AWS Management Console (https:&#x2F;&#x2F;console.aws.amazon.com&#x2F;ec2&#x2F;v2&#x2F;home?region&#x3D;ap-northeast-1#Events)</span><br><span class="line"></span><br><span class="line">* How does this affect you?</span><br><span class="line">Your instance&#39;s root device is an EBS volume and the instance will be stopped after the specified retirement date. You can start it again at any time. Note that if you have EC2 instance store volumes attached to the instance, any data on these volumes will be lost when the instance is stopped or terminated as these volumes are physically attached to the host computer</span><br><span class="line"></span><br><span class="line">* What do you need to do?</span><br><span class="line">You may still be able to access the instance. We recommend that you replace the instance by creating an AMI of your instance and launch a new instance from the AMI. For more information please see Amazon Machine Images (http:&#x2F;&#x2F;docs.aws.amazon.com&#x2F;AWSEC2&#x2F;latest&#x2F;UserGuide&#x2F;AMIs.html) in the EC2 User Guide. In case of difficulties stopping your EBS-backed instance, please see the Instance FAQ (http:&#x2F;&#x2F;aws.amazon.com&#x2F;instance-help&#x2F;#ebs-stuck-stopping).</span><br><span class="line"></span><br><span class="line">* Why retirement?</span><br><span class="line">AWS may schedule instances for retirement in cases where there is an unrecoverable issue with the underlying hardware. For more information about scheduled retirement events please see the EC2 user guide (http:&#x2F;&#x2F;docs.aws.amazon.com&#x2F;AWSEC2&#x2F;latest&#x2F;UserGuide&#x2F;instance-retirement.html). To avoid single points of failure within critical applications, please refer to our architecture center for more information on implementing fault-tolerant architectures: http:&#x2F;&#x2F;aws.amazon.com&#x2F;architecture</span><br><span class="line"></span><br><span class="line">If you have any questions or concerns, you can contact the AWS Support Team on the community forums and via AWS Premium Support at: http:&#x2F;&#x2F;aws.amazon.com&#x2F;support</span><br><span class="line"></span><br><span class="line">Sincerely,</span><br><span class="line">Amazon Web Services</span><br></pre></td></tr></table></figure>



<ul>
<li>AWS Console イベントを見ると一覧で表示されている。</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170418/20170418095219.png" width="100%">
</div>

<ul>
<li>AWS Console 詳細を見ると Notice が出ている。</li>
</ul>
<div style="text-align:center;">
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170411/20170411215054.png" width="100%">
</div>

<h2><span id="todo">ToDO</span></h2><p>ボリュームタイプによって異なります。</p>
<ul>
<li>EBSボリューム<ul>
<li>インスタンスの停止後、起動 (Reboot は ×)</li>
</ul>
</li>
</ul>
<ul>
<li>インスタンスストアボリューム<ul>
<li>AMI からインスタンス再作成、データ移行</li>
</ul>
</li>
</ul>
<p>今回は EBS ボリューム対応について記載してます。</p>
<h2><span id="対応">対応</span></h2><p>対象インスタンスが多かったのでローカルPC (macOS) から awscli でインスタンス停止→起動するシェル作成しました。<br>本番環境で利用されるインスタンスも含まれていた為、1件ずつ実行することとしました。</p>
<h2><span id="事前準備">事前準備</span></h2><ul>
<li>awscli, jq インストール</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install awscli jq</span><br></pre></td></tr></table></figure>

<ul>
<li>各アカウント毎のアクセスキー、シークレットキー等設定</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ aws configure --profile &lt;profile&gt;</span><br><span class="line">$ grep &#39;profile&#39; ~&#x2F;.aws&#x2F;config</span><br></pre></td></tr></table></figure>

<h3><span id="インスタンスの停止再起動シェル">インスタンスの停止・再起動シェル</span></h3><script src="//gist.github.com/kenzo0107/b841bfad242e87da3625e5d980845529.js"></script>

<p>以下のように実行すると<br>インスタンスが起動(running)していれば<br>停止後、再び起動し、ステータスチェックをするようにしました。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sh stop_and_start_ec2_instance.sh &quot;&lt;profile&gt;&quot; &quot;&lt;instance id&gt;&quot;</span><br></pre></td></tr></table></figure>

<h3><span id="イベント情報取得シェル">イベント情報取得シェル</span></h3><p>.aws/config で設定されている profile を全てチェックし<br>未対応インスタンスのみ表示する様修正しました。</p>
<script src="//gist.github.com/kenzo0107/b79e05f6fc6692a1d631fd874ccb3e6b.js"></script>

<h2><span id="結果確認">結果確認</span></h2><p>大体 1インスタンス 5分程度で完了。<br>問題なく停止起動でき、対象イベントが一覧から消えたことを確認しました♪</p>
<h2><span id="所感">所感</span></h2><p>メンテ対象インスタンスの Region が northeast に集中していたのが気になる点でした。<br>このインスタンス何に使ってるんだっけ？とならない様に、インスタンスやprivate key の命名ルール必須と感じました。</p>
<p>以上です。</p>
</div></article></div><div class="card"><div class="card-image"><a class="image" href="/2017/04/13/2017-04-14-teat-docker/"><img class="thumbnail" src="https://cdn-ak.f.st-hatena.com/images/fotolife/k/kenzo0107/20170414/20170414222435.png" alt="Docker コマンド早見表"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2017-04-13T15:00:00.000Z" title="2017-04-13T15:00:00.000Z">$2017-04-14</time></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/04/13/2017-04-14-teat-docker/">Docker コマンド早見表</a></h1><div class="content"><h2><span id="バージョン">バージョン</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker --version</span><br><span class="line"></span><br><span class="line">Docker version 17.04.0-ce, build 4845c56</span><br></pre></td></tr></table></figure>

<h2><span id="コンテナ">コンテナ</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker ps                     # running コンテナ一覧</span><br><span class="line">docker ps -a                  # 全コンテナ一覧表示</span><br><span class="line">docker start &lt;CONTAINER ID&gt;   # コンテナ起動</span><br><span class="line">docker restart &lt;CONTAINER ID&gt; # コンテナ再起動</span><br><span class="line">docker stop &lt;CONTAINER ID&gt;    # コンテナ終了</span><br><span class="line">docker kill &lt;CONTAINER ID&gt;    # コンテナ強制終了</span><br><span class="line">docker attach &lt;CONTAINER ID&gt;  # コンテナへアタッチ</span><br><span class="line">docker top &lt;CONTAINER ID&gt;     # コンテナプロセスを表示</span><br><span class="line">docker logs -f &lt;CONTAINER ID&gt; # コンテナログ表示</span><br><span class="line">docker inspect &lt;CONTAINER ID&gt; # コンテナ情報表示</span><br><span class="line">docker rm &lt;CONTAINER ID&gt;      # コンテナID指定でコンテナ削除</span><br><span class="line">dockre rm &lt;CONTAINER NAME...&gt; # コンテナ名(複数)指定でコンテナ削除</span><br><span class="line">docker container prune        # 停止コンテナを削除</span><br><span class="line"></span><br><span class="line">dockr run -it -h &lt;host name&gt; &lt;IMAGE&gt;[:TAG] &lt;command&gt;  # イメージよりコンテナ起動 command 実施</span><br></pre></td></tr></table></figure>

<h2><span id="イメージ">イメージ</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker pull &lt;IMAGE NAME&gt;[:tag]     # イメージダウンロード</span><br><span class="line">docker images ls              # イメージ一覧</span><br><span class="line">docker inspect &lt;IMAGE ID&gt;     # イメージ情報表示</span><br><span class="line">docker rmi &lt;IMAGE ID&gt;         # イメージ削除</span><br></pre></td></tr></table></figure>

<h2><span id="イメージ作成">イメージ作成</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build -t NAME[:TAG]</span><br><span class="line">docker commit -m &quot;&lt;comment here&gt;&quot; &lt;CONTAINER ID&gt; &lt;IMAGE NAME&gt;[:TAG]</span><br></pre></td></tr></table></figure>

<h2><span id="docker-compose">Docker Compose</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d    # デタッチモードでイメージよりコンテナ起動</span><br><span class="line">docker-compose ps       # コンテナ一覧表示</span><br><span class="line">docker-compose stop     # docker compose 管理下全てのコンテナ停止</span><br><span class="line">docker-compose start    # docker compose 管理下全てのコンテナ起動</span><br><span class="line">docker-compose rm       # docker compose 管理下全ての停止コンテナ削除</span><br></pre></td></tr></table></figure>
</div></article></div><nav class="pagination is-centered mt-4" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/13/">前</a></div><div class="pagination-next"><a href="/page/15/">次</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/13/">13</a></li><li><a class="pagination-link is-current" href="/page/14/">14</a></li><li><a class="pagination-link" href="/page/15/">15</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/32/">32</a></li></ul></nav></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="kenzo0107"></figure><p class="title is-size-4 is-block line-height-inherit">kenzo0107</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">投稿</p><a href="/archives"><p class="title">320</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">カテゴリ</p><a href="/categories"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">タグ</p><a href="/tags"><p class="title">88</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/kenzo0107" target="_blank" rel="noopener">フォローする</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/kenzo0107"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/kenzo0107"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">カテゴリ</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/AWS/"><span class="level-start"><span class="level-item">AWS</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/DIY/"><span class="level-start"><span class="level-item">DIY</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Go/"><span class="level-start"><span class="level-item">Go</span></span><span class="level-end"><span class="level-item tag">26</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/RaspberryPI/"><span class="level-start"><span class="level-item">RaspberryPI</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Terraform/"><span class="level-start"><span class="level-item">Terraform</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最近の記事</h3><article class="media"><a class="media-left" href="/2022/10/30/2022-10-31-js-get-a-last-month/"><p class="image is-64x64"><img class="thumbnail" src="https://i.imgur.com/VbLapz4.png" alt="JavaScript で日付計算の妙"></p></a><div class="media-content size-small"><p><time dateTime="2022-10-30T15:00:00.000Z">2022-10-31</time></p><p class="title is-6"><a class="link-muted" href="/2022/10/30/2022-10-31-js-get-a-last-month/">JavaScript で日付計算の妙</a></p><p class="is-uppercase"></p></div></article><article class="media"><a class="media-left" href="/2022/10/25/2022-10-26-terraform-sort-map/"><p class="image is-64x64"><img class="thumbnail" src="https://i.imgur.com/8cuKRz1.png" alt="terraform で map 型の値を key 順にソートした上で value のリストを取得する"></p></a><div class="media-content size-small"><p><time dateTime="2022-10-25T15:00:00.000Z">2022-10-26</time></p><p class="title is-6"><a class="link-muted" href="/2022/10/25/2022-10-26-terraform-sort-map/">terraform で map 型の値を key 順にソートした上で value のリストを取得する</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Terraform/">Terraform</a></p></div></article><article class="media"><a class="media-left" href="/2022/09/28/2022-09-29-upgrade_elasticache_redis/"><p class="image is-64x64"><img class="thumbnail" src="https://i.imgur.com/6PU8EYE.png" alt="AWS ElastiCache Redis バージョンアップ&amp;ノードタイプ変更時の注意点"></p></a><div class="media-content size-small"><p><time dateTime="2022-09-28T15:00:00.000Z">2022-09-29</time></p><p class="title is-6"><a class="link-muted" href="/2022/09/28/2022-09-29-upgrade_elasticache_redis/">AWS ElastiCache Redis バージョンアップ&amp;ノードタイプ変更時の注意点</a></p><p class="is-uppercase"></p></div></article><article class="media"><a class="media-left" href="/2022/09/12/2022-09-13-setup-tfsec/"><p class="image is-64x64"><img class="thumbnail" src="https://aquasecurity.github.io/tfsec/v0.63.1/imgs/homelogo.png" alt="tfsec で terraform 管理リソースのセキュリティ強化"></p></a><div class="media-content size-small"><p><time dateTime="2022-09-12T15:00:00.000Z">2022-09-13</time></p><p class="title is-6"><a class="link-muted" href="/2022/09/12/2022-09-13-setup-tfsec/">tfsec で terraform 管理リソースのセキュリティ強化</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2022-08-23T15:00:00.000Z">2022-08-24</time></p><p class="title is-6"><a class="link-muted" href="/2022/08/23/2022-08-24-setup-nodejs-on-alpine/">マルチステージビルドで alpine イメージに nodejs をセットアップする</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">タグ</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/htaccess/"><span class="tag">.htaccess</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ALB/"><span class="tag">ALB</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AWS/"><span class="tag">AWS</span><span class="tag is-grey-lightest">43</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ansible/"><span class="tag">Ansible</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AntiVirus/"><span class="tag">AntiVirus</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Apache/"><span class="tag">Apache</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Chef/"><span class="tag">Chef</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CodeBuild/"><span class="tag">CodeBuild</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cookie/"><span class="tag">Cookie</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Corosync/"><span class="tag">Corosync</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Datadog/"><span class="tag">Datadog</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ECR/"><span class="tag">ECR</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ECS/"><span class="tag">ECS</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ElastiCache/"><span class="tag">ElastiCache</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Elasticsearch/"><span class="tag">Elasticsearch</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Email/"><span class="tag">Email</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FTPS/"><span class="tag">FTPS</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Fluentd/"><span class="tag">Fluentd</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GKE/"><span class="tag">GKE</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GitHub-Actions/"><span class="tag">GitHub Actions</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go/"><span class="tag">Go</span><span class="tag is-grey-lightest">24</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GooglePlay/"><span class="tag">GooglePlay</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hubot/"><span class="tag">Hubot</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Jenkins/"><span class="tag">Jenkins</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kibana/"><span class="tag">Kibana</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LINE-Notify/"><span class="tag">LINE Notify</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Lambda/"><span class="tag">Lambda</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Let-s-encrypt/"><span class="tag">Let&#039;s encrypt</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MachineLearning/"><span class="tag">MachineLearning</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Monitoring/"><span class="tag">Monitoring</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MySQL/"><span class="tag">MySQL</span><span class="tag is-grey-lightest">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nginx/"><span class="tag">Nginx</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenSSL/"><span class="tag">OpenSSL</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Outlook/"><span class="tag">Outlook</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PHP/"><span class="tag">PHP</span><span class="tag is-grey-lightest">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Pacemaker/"><span class="tag">Pacemaker</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Prometheus/"><span class="tag">Prometheus</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ProxySQL/"><span class="tag">ProxySQL</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Puppeteer/"><span class="tag">Puppeteer</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag is-grey-lightest">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Rails/"><span class="tag">Rails</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RaspberryPI/"><span class="tag">RaspberryPI</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reactio/"><span class="tag">Reactio</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ruby/"><span class="tag">Ruby</span><span class="tag is-grey-lightest">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/S3/"><span class="tag">S3</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSL/"><span class="tag">SSL</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Security/"><span class="tag">Security</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SendGrid/"><span class="tag">SendGrid</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Slack/"><span class="tag">Slack</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SonarQube/"><span class="tag">SonarQube</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/StatsBot/"><span class="tag">StatsBot</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Swift/"><span class="tag">Swift</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Terraform/"><span class="tag">Terraform</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Twilio/"><span class="tag">Twilio</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Unity/"><span class="tag">Unity</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vagrant/"><span class="tag">Vagrant</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vault/"><span class="tag">Vault</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WAF/"><span class="tag">WAF</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Zabbix/"><span class="tag">Zabbix</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/awk/"><span class="tag">awk</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/casperjs/"><span class="tag">casperjs</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cpu/"><span class="tag">cpu</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csv/"><span class="tag">csv</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/flask/"><span class="tag">flask</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/i-node/"><span class="tag">i-node</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iftop/"><span class="tag">iftop</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ipinfo/"><span class="tag">ipinfo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/iptable/"><span class="tag">iptable</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kibana/"><span class="tag">kibana</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macos/"><span class="tag">macos</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nginx/"><span class="tag">nginx</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/no-ip/"><span class="tag">no-ip</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ping/"><span class="tag">ping</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pip/"><span class="tag">pip</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/reCAPTCHA/"><span class="tag">reCAPTCHA</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sftp/"><span class="tag">sftp</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spam/"><span class="tag">spam</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vim/"><span class="tag">vim</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wget/"><span class="tag">wget</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/yum/"><span class="tag">yum</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/zsh/"><span class="tag">zsh</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6265337967545472" data-ad-slot="9975280607" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="長生村本郷Engineers&#039;Blog" height="28"></a><p class="size-small"><span>&copy; 2022 Kenzo Tanaka</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("ja");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://kenzo0107.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: ''
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="Zurück nach oben" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"投稿","pages":"Pages","categories":"カテゴリ","tags":"タグ"});
        });</script></body></html>